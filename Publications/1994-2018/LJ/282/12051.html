<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Cool Project: Create a CAPTCHA for Your Website
</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;Jim's CAPTCHA uses photos of his cats, so&#10;only friends and family are allowed to view his personal website. You&#10;could modify the CAPTCHA to use other photos, like pictures of doors or trees,&#10;but I think everyone agrees that the internet needs more photos&#10;of cats. Note, this method works for dogs as well. &#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x1368580.0x145fac0"></a>
Cool Project: Create a CAPTCHA for Your Website
</h1></div><div><div class="author"><h3 class="author">
Jim
 
Hall
</h3></div><div class="issuemoyr">Issue #282, October 2017</div></div><div><p>
Jim's CAPTCHA uses photos of his cats, so
only friends and family are allowed to view his personal website. You
could modify the CAPTCHA to use other photos, like pictures of doors or trees,
but I think everyone agrees that the internet needs more photos
of cats. Note, this method works for dogs as well. 
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x14601f8"></a></h2></div></div><p>
I run a personal web server that I use for various projects and
experiments. Over time, it's also become a convenient place for me to
post other information to share with friends and family. For example,
after much prompting by my family, I finally put up a &ldquo;wish list&rdquo; page
for Christmas and birthday gift ideas.
</p><p>
Most of what I share on this personal website is intended for friends
and family only, not for the general public. It's not sensitive information or
private data, but I'd rather not put it out there for just anyone to see.
</p><p>
For a while, I considered protecting my web pages using a proper login
system, but I didn't want to manage user names and passwords for all my
friends and family who wanted to access my personal website. I might have
implemented OpenID or some other decentralized authentication protocol
to allow visitors to log in using another service. And although that would
be the technically correct thing to do, I thought it was overkill to
require a user name and password just for my friends and family to view
my wish-list page.
</p><p>
So instead, I wrote a simple web system that asks visitors to demonstrate
that they know me. This isn't a formal login system; rather, it's a
form of CAPTCHA.
</p><p>
The concept of any CAPTCHA is to present some simple test for an
<span   class="emphasis"><em>intended</em></span>
audience to answer, but that's difficult for anyone else. Most CAPTCHAs try to
present a trivial puzzle, such as clicking on any photos that contain
water (like fountains or lakes). These CAPTCHAs often are used in
online comment systems to verify that the person leaving the comment
is a real person and not a bot.
</p><p>
In my case, I wanted to create a CAPTCHA that was simple for friends and
family to answer, but difficult for others to figure out. And I decided to do it
in a totally adorable way&mdash;by using photos of my cats.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x1460618"></a>
My CAPTCHA</h2></div></div><p>
My CAPTCHA asks visitors to click on the photo of one our cats against a
&ldquo;forest&rdquo; of other cats that don't belong to me. If you know me pretty
well, this is easy. Obviously, my friends and family know what my cats look
like. Selecting the photo of my cat is a simple demonstration that
you know me; strangers would be unlikely to
select the correct image.
</p><p>
Using photos of my cat isn't a perfect solution. It's entirely possible
that attackers could use a brute-force method and keep clicking on photos of cats
until they recognize which cats are mine. But this isn't a proper login
system; it's just a CAPTCHA. I'm not protecting sensitive information
like social security numbers. I merely want to prevent some random Joe
User from seeing what books and t-shirts I'm asking for at
Christmas.
</p><p>
In the simplest case, creating a cat CAPTCHA involves creating a random
&ldquo;forest&rdquo; of cat photos, where only one of the cats belongs to you. You
can create this &ldquo;forest&rdquo; in any number of ways. One easy way to do it
in PHP is to create two lists: all images of my cats and all images
of other people's cats. Pick one photo of my cat at random from the
&ldquo;my cat&rdquo; list and several photos at random from the &ldquo;not
my cat&rdquo; list,
then shuffle the result.
</p><p>
So, you need to get started with photos of cats. This is the easiest step. Go
through your photo collection and find pictures of your cats: contented
cats lying in the sun, sleepy cats napping on cushions, playful cats
prowling the backyard, confused cats wondering why you're always pointing
a camera at them.
</p><p>
Then, crop and resize your cat photos to the appropriate dimensions. So
you can use the photos more easily in the CAPTCHA, crop the photos to
be square, with the cat taking up most of the photo. In GIMP, this is
easily done if you set the Crop tool to use a fixed aspect ratio of
&ldquo;1:1&rdquo;. At this stage, don't worry about the size of the cat photos;
I'll describe how to set that in a later step. 
</p><div       class="mediaobject"><a href="12051f1.large.jpg"><img src="12051f1.jpg"></a><div class="caption"><p>
Figure 1. Jim's Cat
</p></div></div><div       class="mediaobject"><img src="12051f2.jpg"><div class="caption"><p>
Figure 2. Jim's Other Cat
</p></div></div><p>
Next, you need photos of other cats. You can find those from a variety
of online photos, but I went on Facebook and looked for any cat photos
posted by my friends. I found about 50 other cat photos this way. Just
make sure the other cats don't look too much like your cats, and same as
the previous step, crop the other cat photos so they are square.
</p><p>
To use these cat photos in a CAPTCHA, you want to ensure that the
visitor cannot guess which cat is yours based on the photo's filenames. 
Photos named something like mycat_1.jpg can provide clear clues
that the cat might belong to you. Instead, name all your photos in the
same generic way. I prefer to rename my cat CAPTCHA photos according to
the MD5 signature of the photo. This provides suitable non-predictability;
you can't guess which photos are my cats and which are not simply based
on the photo filename.
</p><p>
To make your pictures more alike, strip your cat photos of any EXIF
data. While humans won't see the EXIF data, a bot might. EXIF data could
provide a telltale hint that a photo is or isn't your cat. So make them
all the same and omit EXIF data.
</p><p>
Note: if your CAPTCHA photos don't change over time, attackers
could use a brute-force method to try all of the photos until they guess
the MD5 signatures of the correct images. To protect against this, I
add some random noise to the photos. I'm sure you can do this in GIMP,
but I found it was easiest to use ImageMagick's Convert tool to add noise
while I resized the cat photos:

<pre     class="programlisting">
convert large_photo.jpg -strip -resize 250x250 +noise 
 &#8618;Laplacian small_photo.jpg
</pre>
</p><p>
ImageMagick has several random noise generators, but I find the Laplacian
method doesn't disturb the image too much.
</p><p>
You easily can automate ImageMagick with a script, and that's what I do.
A
simple Bash script processes all of my image files every day to resize
them and add noise while renaming them to something random. This also
merges the photos into a single directory and creates the lists of
&ldquo;my cats&rdquo;
and &ldquo;not my cats&rdquo;. Put the list files in a separate directory, preferably
outside the document root. On my personal web server, my document root
is under /var/www/html, but I keep my list files in /var/www/etc/cats.
</p><p>
This script runs on my personal web server every day:

<pre     class="programlisting">
#!/bin/sh
etcdir=/var/www/etc/cats/
cachedir=/var/www/html/captcha/cache/
catsdir=$HOME/cats
tempimg=/tmp/cat.jpg


for d in mycats notmycats ; do
 ( cd $catsdir/$d
 &gt;$etcdir/$d.list
 for img in *.jpg ; do
  convert $img -strip -resize 250x250 +noise Laplacian $tempimg
  hashval=$( md5sum $tempimg | awk '{print $1}' )
  mv $tempimg $cachedir/$hashval.jpg
  echo $hashval.jpg &gt;&gt; $etcdir/$d.list
 done )
done
</pre>
</p><p>
This script adds all cat photos saved in $HOME/cats/mycats to the &ldquo;my
cats&rdquo; list and all cat photos saved in $HOME/cats/notmycats to the
&ldquo;not
my cats&rdquo; list. ImageMagick removes all <tt  >EXIF</tt>
data (<tt  >-strip</tt>), resizes all
photos to the same size (<tt  >-resize 250x250</tt>) and adds some random noise
(<tt  >+noise Laplacian</tt>). At the same time, all cat photos are mixed together
with random filenames in the /var/www/html/captcha/cache directory.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x14614e0"></a>
Writing the PHP Code</h2></div></div><p>
Once you have the cat images, you need to write some PHP code that displays
the cat images as a CAPTCHA. For my CAPTCHA, I prefer to display nine
cat images in a 3x3 grid. One photo is my cat, and the other eight
cats are not.
</p><p>
The first step is for the PHP script to know which cats are mine and
which cats are not. That's where the mycats.list and notmycats.list
files come in.
</p><p>
The <tt  >file()</tt> function in PHP reads an entire file into
an array&mdash;for
example:

<pre     class="programlisting">

&lt;?php
    $myCats = file('/var/www/etc/cats/mycats.list');
    $notMyCats = file('/var/www/etc/cats/notmycats.list');
?&gt;

</pre>
</p><p>
The <tt  >file()</tt> function will include the newline characters at the end of
each line, plus any empty lines that might be in the file. So you need
to provide a few options to read the list files without the extra stuff:


<pre     class="programlisting">
&lt;?php
    $myCats = file('/var/www/etc/cats/mycats.list', 
     &#8618;FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
    $notMyCats = file('/var/www/etc/cats/notmycats.list', 
     &#8618;FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
?&gt;
</pre>
</p><p>
PHP has a handy function <tt  >array_rand()</tt> that picks random entries out of
an array. This function returns the indices of random entries, which are
easily used as array references. In the simplest case, you can 
select one cat randomly from the $myCats array like this:

<pre     class="programlisting">

&lt;?php
    $myCats[ array_rand($myCats) ]
?&gt;

</pre>
</p><p>
Then build a new array of eight cats selected at random from the
<tt  >$notMyCats</tt> array and one random cat from the
<tt  >$myCats</tt> array by stacking
the elements in the <tt  >array()</tt> function. This builds a
new array <tt  >$randCats</tt> from
the elements provided. As you can see, the new
<tt  >$randCats</tt> array is in a
predictable order, with the correct cat always in the last position. So
after building the array, randomize the order of the array elements with
the <tt  >shuffle()</tt> function:

<pre     class="programlisting">

&lt;?php
    $notMyCatsIdx = array_rand($notMyCats, 8);
    $randCats = array(
            $notMyCats[ $notMyCatsIdx[0] ],
            $notMyCats[ $notMyCatsIdx[1] ],
            $notMyCats[ $notMyCatsIdx[2] ],
            $notMyCats[ $notMyCatsIdx[3] ],
            $notMyCats[ $notMyCatsIdx[4] ],
            $notMyCats[ $notMyCatsIdx[5] ],
            $notMyCats[ $notMyCatsIdx[6] ],
            $notMyCats[ $notMyCatsIdx[7] ],
            $myCats[ array_rand($myCats) ]
    );
    shuffle($randCats);
?&gt;

</pre>
</p><p>
Once you have randomly selected eight incorrect cats and one correct
cat in the $randCats array, you can display the nine cat photos on a
CAPTCHA web page. You'll use HTML styles later to ensure the photos are
displayed as a 3x3 grid. In my CAPTCHA implementation, each cat photo is
a separate Submit button in a web form. On the captcha/index.php CAPTCHA
page, iterate through the <tt  >$randCats</tt> array using the
<tt  >foreach()</tt> method:

<pre     class="programlisting">

&lt;form method="POST"&gt;
&lt;?php
    foreach ( $randCats as $cat ) {
            echo&lt;&lt;&lt;EOF
&lt;button type="submit" name="cat" value="$cat"&gt;
&lt;img src="$cat" alt="image of a cat" /&gt;
&lt;/button&gt;
EOF;
    }
?&gt;
&lt;input type="hidden" name="captcha" value="catCAPTCHA" /&gt;
&lt;/form&gt;

</pre>
</p><p>
The hidden input &ldquo;captcha&rdquo; with the value
&ldquo;catCAPTCHA&rdquo; will be used
later to detect that the user submitted the web form and not simply
visited the web page.
</p><p>
Validating the CAPTCHA is fairly straightforward: read the POST data
to the web form and search for the cat CAPTCHA value in the
<tt  >$myCats</tt>
array. PHP's <tt  >in_array()</tt> function checks whether a value is in an array,
so you can use this function to simplify the lookup. At the top of the
captcha/index.php page, add code to detect the posting of the cat CAPTCHA,
then search for the cat CAPTCHA value:


<pre     class="programlisting">

&lt;?php
 /* test if the visitor guessed the correct cat */


 if (strcmp( $_POST['captcha'], 'catCAPTCHA' ) == 0) {
  $cat = $_POST['cat'];


  if (in_array($cat, $myCats) === TRUE) {
   /* success */
  }
  else {
   /* failure */
  }
 }
?&gt;

</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x14588c8"></a>
The Completed Captcha</h2></div></div><p>
With these pieces, it's pretty simple to complete the CAPTCHA page.
</p><p>
I've parameterized the cookie information via the cookie-conf.php
file. The parameter file retrieves the cookie value from a separate
/var/www/etc/cats/catCAPTCHA.cookie file. Also, cookie-conf.php defines
a standard cookie name, path and domain, and sets the cookie expiry to
one day.
</p><p>
This CAPTCHA page is just an example. You can improve the system by
checking the value of the <tt  >redir=</tt> URL parameter before redirecting the
user there to prevent cross-site attacks. And, you might add further
checks to detect multiple CAPTCHA attempts from the same user within
too short a time frame.
</p><p>
Listing 1 shows the completed CAPTCHA page.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x1458b88"></a></h2></div></div><div class="sidebar"><p class="title"><b>Listing 1. Completed CAPTCHA Page</b></p><pre     class="programlisting">
&lt;?php
 require ('/var/www/etc/cats/cookie-conf.php');


 /* initialize values */


 $myCats = file('/var/www/etc/cats/mycats.list', 
  &#8618;FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);
 $notMyCats = file('/var/www/etc/cats/notmycats.list', 
  &#8618;FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES);


 $CAPTCHAsuccess = FALSE;
 $CAPTCHAmessage = '&lt;p&gt;Hi there!&lt;/p&gt;';


 /* test if the visitor guessed the correct cat */


 if (strcmp( $_POST['captcha'], 'catCAPTCHA' ) == 0) {
  $cat = $_POST['cat'];


  if (in_array($cat, $myCats) === TRUE) {
   $CAPTCHAsuccess = TRUE;
   $CAPTCHAmessage = '&lt;p class="success"&gt;Success!&lt;/p&gt;';
   setcookie($cookieName, $cookieValue, $cookieExpire, 
    &#8618;$cookiePath, $cookieDomain);


   $redir = $_GET['redir'];
  }
  else {
   $CAPTCHAsuccess = FALSE;
   $CAPTCHAmessage = '&lt;p class="error"&gt;No, that is not 
    &#8618;our cat. Try again?&lt;/p&gt;';
  }
 }
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
 &lt;title&gt;Which one is our cat?&lt;/title&gt;
 &lt;link rel="shortcut icon" href="/favicon.png" /&gt;
 &lt;meta charset="UTF-8"&gt;
 &lt;meta name="theme-color" content="firebrick"&gt;
 &lt;meta name="viewport" content="width=device-width" /&gt;
&lt;?php
 /* if CAPTCHA was correct, and there is a redirect URL, 
    then redirect */


 if ( ($CAPTCHAsuccess) &amp;&amp; (strlen($redir) &gt; 0) ) {
  echo "&lt;meta http-equiv='refresh' content='0;URL=$redir' /&gt;";
 }
?&gt;
 &lt;style&gt;
body {
 background-color: white;
 color: black;
 font-family: sans-serif;
 margin: 0;
}
header {
 background-color: firebrick;
 border-bottom: .5em solid darkred;
 color: white;
}
 header h1 {
 font-size: 1em;
 margin: 0;
 padding: 2em 0;
 text-align: center;
 text-transform: uppercase;
 }
main {
 border-bottom: 1em solid gray;
}
main section {
 border-left: 1px dotted lightgray;
 border-right: 1px dotted lightgray;
 margin: 0 auto;
 padding: 2em 1em;
 max-width: 900px;
}
 main h2 {
 border-bottom: 1px solid darkred;
 color: darkred;
 font-family: serif;
 font-size: 1.1em;
 margin: 2em 0;
 }
 p.success {
 color: green;
 }
 p.error {
 color: red;
 }
 form {
 margin: 1em auto;
 max-width: 800px;
 }
 form button {
 border: 1px solid #333;
 margin: 2px;
 padding: 0;
 -moz-appearance: none;
 -webkit-appearance: none;
 }
 &lt;/style&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;header&gt;
 &lt;h1&gt;Login&lt;/h1&gt;
&lt;/header&gt;
&lt;main&gt;
 &lt;section&gt;
&lt;?php
 echo $CAPTCHAmessage;


 if ( ! $CAPTCHAsuccess ) {
  echo&lt;&lt;&lt;EOF
&lt;p&gt;The stuff on this website isn't private information, but 
I'd rather not put it out there for just anyone to see. I prefer 
to keep this just for friends and family.&lt;/p&gt;


&lt;p&gt;So to prove that you know me, I'm giving you 
this little quiz:&lt;/p&gt;


&lt;h2&gt;Which one is our cat?&lt;/h2&gt;


&lt;p&gt;We have several cats, but only one of them is shown here. 
Click on the picture of our cat.&lt;/p&gt;


&lt;form method="POST"&gt;
EOF;


  $notMyCatsIdx = array_rand($notMyCats, 8);
  $randCats = array(
   $notMyCats[ $notMyCatsIdx[0] ],
   $notMyCats[ $notMyCatsIdx[1] ],
   $notMyCats[ $notMyCatsIdx[2] ],
   $notMyCats[ $notMyCatsIdx[3] ],
   $notMyCats[ $notMyCatsIdx[4] ],
   $notMyCats[ $notMyCatsIdx[5] ],
   $notMyCats[ $notMyCatsIdx[6] ],
   $notMyCats[ $notMyCatsIdx[7] ],
   $myCats[ array_rand($myCats) ]
  );
  shuffle($randCats);


  foreach ( $randCats as $cat ) {
   echo&lt;&lt;&lt;EOF
&lt;button type="submit" name="cat" value="$cat"&gt;
&lt;img src="cache/$cat" alt="image of a cat" /&gt;
&lt;/button&gt;
EOF;
  }


  echo&lt;&lt;&lt;EOF
&lt;input type="hidden" name="captcha" value="catCAPTCHA" /&gt;
&lt;/form&gt;
EOF;
 }
?&gt;
 &lt;/section&gt;
&lt;/main&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div><p>
This CAPTCHA page defines a few styles, both to make the page content
look nice and to ensure that the CAPTCHA images are displayed in a 3x3
grid. Since each cat photo is 200x200 pixels, setting the page width
to 700 pixels forces the CAPTCHA images to wrap to the next line after
three photos. This effectively presents them as a 3x3 grid.
</p><p>
The <tt  >-moz-appearance: none;</tt> and
<tt  >-webkit-appearance: none;</tt> styles for the
form buttons erase any extra decoration from Mozilla and Safari web
browsers. Without those styles, an iPad will add rounded edges to the
buttons, which would ruin the effect of the CAPTCHA.
</p><p>
The other styles provide a pleasant viewing experience. For example, the
styles apply a red banner at the top of the page as well as different
styling for text and headings.
</p><div       class="mediaobject"><a href="12051f3.large.jpg"><img src="12051f3.jpg"></a><div class="caption"><p>
Figure 3. Cats CAPTCHA
</p></div></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x1459108"></a>
Rotating the CAPTCHA Cookie</h2></div></div><p>
One final improvement remains. Remember, when the visitor correctly
selects the right cat, the CAPTCHA page sets a cookie with a value read
from a file. But, why read the cookie value from a file rather than set
a static value?
</p><p>
The answer is security. If you keep the cookie value in a separate
file, you can change the contents of cookie file whenever you want to
&ldquo;invalidate&rdquo; the old cookie value. On my personal web server, I set
up a daily job that writes a random value to the cookie value. Even I
couldn't tell you what the new cookie value will be.
</p><p>
Any web cookie is really just a long string of random letters and
numbers. So on my web server, I want to set a different long string
every day. I do this in two steps:
</p><div class="orderedlist"><ol type="1"><li><p>
Create a random file using <tt  >dd</tt> and /dev/urand.
</p></li><li><p>
Generate a hash of that random file using <tt  >sha256sum</tt>.
</p></li></ol></div><p>
The value of the SHA256 checksum on the random file becomes the new
CAPTCHA cookie value. That's 64 letters and numbers to
&ldquo;describe&rdquo; a
random file, which makes a pretty good CAPTCHA cookie value. I run this
simple Bash script via cron to overwrite the cookie file with a random
value every day:

<pre     class="programlisting">
#!/bin/sh
cookiefile=/var/www/etc/cats/catCAPTCHA.cookie
dd if=/dev/urandom bs=1M count=4 of=/tmp/urandom.tmp 2&gt; /dev/null
sha256sum /tmp/urandom.tmp | awk '{print $1}' &gt; $cookiefile
</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x1459688"></a>
Testing for the CAPTCHA</h2></div></div><p>
Once you've put the CAPTCHA page in place, your other web pages need to
recognize when a visitor has &ldquo;passed&rdquo; the CAPTCHA test. You easily
can test for the CAPTCHA by examining cookies.
</p><p>
Referring back to the completed CAPTCHA page, when the visitor correctly
selects the right cat, the CAPTCHA page sets a cookie with a specific
value. So if the cookie exists and contains that value, any PHP page
can determine if the visitor &ldquo;passed&rdquo; the CAPTCHA. I define a function
to do this for me in the cookie-conf.php page:

<pre     class="programlisting">

&lt;?php
 $cookieName = 'catCAPTCHA';
 $cookieValue = file_get_contents('/var/www/etc/cats/catCAPTCHA.cookie');
 $cookieExpire = time() + 86400; /* 86400 = (3600 * 24) = 1 day */
 $cookiePath = '/';
 $cookieDomain = 'freedos.org';


 function is_catCAPTCHA_ok()
 {
 /* shortcut to determine if a login is successful .. 
    uses the cookie value */


  global $cookieName, $cookieValue;


  if ( (isset($_COOKIE)) &amp;&amp;
       (isset($_COOKIE[$cookieName])) &amp;&amp;
       (strcmp($_COOKIE[$cookieName], $cookieValue) == 0) ) {
   return TRUE;
  }
  else {
   return FALSE;
  }
 }
?&gt;

</pre>
</p><p>
In any PHP page that I want to protect with the cat CAPTCHA, I simply
include the cookie-conf.php file and call
<tt  >is_catCAPTCHA_ok()</tt> to test the
CAPTCHA. In a more complete implementation, you might instead redirect
non-validated visitors to the CAPTCHA page, setting the
<tt  >redir=</tt> parameter
so that users automatically return to the correct page. Here's a simple
example to test the CAPTCHA:


<pre     class="programlisting">

&lt;?php
 require ('/var/www/etc/cats/cookie-conf.php');
?&gt;
&lt;!DOCTYPE html&gt;
&lt;html&gt;
&lt;head&gt;
 &lt;title&gt;Test page&lt;/title&gt;
 &lt;meta charset="UTF-8"&gt;
 &lt;meta name="viewport" content="width=device-width" /&gt;
&lt;/head&gt;
&lt;body&gt;


&lt;?php
 if ( is_catCAPTCHA_ok() ) {
  echo 'cat CAPTCHA is set';
 }
 else {
  echo 'cat CAPTCHA is &lt;b&gt;not&lt;/b&gt; set';
 }
?&gt;


&lt;/body&gt;
&lt;/html&gt;

</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x1459aa8"></a>
CAPTCHAs Are Easy</h2></div></div><p>
If you aren't protecting very sensitive information, consider a simple
CAPTCHA. In my case, I wanted to keep random strangers from seeing
my Christmas wish list. That's not exactly &ldquo;Fort Knox&rdquo; material. So a
straightforward CAPTCHA does the job.
</p><p>
A good CAPTCHA is easy for certain people to solve and difficult
for others to solve. For my web pages, I wanted to let in friends and
family, and it's easy enough to do that with a CAPTCHA that uses photos
of my cats.
</p><p>
Every time visitors load the CAPTCHA page, they see a different set of
nine cats. Eight of these cats do not belong to me; only one of them is
the correct cat. The correct cat is different each time and appears
in a random location. The first time you load the page, my cat might
be in the upper-left position. The next time, you might find my cat in
the lower-right or somewhere else. This is a &ldquo;good enough&rdquo; test to
demonstrate that you know me. Only my friends and family should know
what my cats look like.
</p><p>
In practice, it takes me about a second to find my cat among the
&ldquo;forest&rdquo;
of other cats. And my friends and family say they like seeing the cats
whenever they access my personal website. They say it's just adorable,
and I agree.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1368580.0x1459dc0"></a></h2></div></div><div class="sidebar"><p class="title"><b></b></p><p>Send comments or feedback via <a href="http://www.linuxjournal.com/contact" target="_self">www.linuxjournal.com/contact</a> or to
<a href="mailto:info@linuxjournal.com">info@linuxjournal.com</a>.
</p></div></div></div>
<div class="authorblurb"><p>
Jim Hall is an advocate for free and open-source software, best known 
for his work on the FreeDOS Project. Jim earned his MS in Scientific and
Technical Communication from the University of Minnesota, focusing on the
usability of open-source software. At work, Jim is the Chief Information
Officer for Ramsey County, Minnesota.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../282/toc282.html">Issue Table of Contents</a>
    <a class="link3" href="../282/12051.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>