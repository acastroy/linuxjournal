<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Getting Started with Qtopia</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;From the horse's mouth (Trolltech) come instructions on how to get&#10;started writing applications for Qtopia.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0xac2580.0xbb9ab0"></a>
Getting Started with Qtopia</h1></div><div><div class="author"><h3 class="author">
Lorn
 
Potter
</h3></div><div class="issuemoyr">Issue #142, February 2006</div></div><div><p>
From the horse's mouth (Trolltech) come instructions on how to get
started writing applications for Qtopia.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbba298"></a></h2></div></div><p>
Trolltech's Qtopia is an embedded application framework designed to give
vendors maximum customization and third-party developers the choice of
developing commercial applications or free GPL applications. Qtopia is
available under dual licenses. Developing for Qtopia is as easy as any
Qt/KDE desktop development, except for a few extra steps and tools needed.
</p><p>
I started developing my program Gutenbrowser, which is a reader/downloader
for the thousands of free etexts available from Project Gutenberg. It
started out as a Linux-only application and soon made its way to
Windows, Qtopia and then to the Open Palmtop Integrated Environment
(Opie). Opie is based on Qtopia GPL and is community developed.
</p><p>
Qtopia is built on Qt Embedded, so an application that is created with
Qt easily can be made to run in the Qtopia environment. It took about
two weeks part-time/open-source-developer time to get Gutenbrowser
running on the Sharp Zaurus, and that includes learning Qtopia API and
cross-platform compilation as well!
</p><p>
If you want to port a Qt 4 application to Qtopia, it would be best to wait
for Qtopia 4 to be released, as there are significant changes between Qt
Embedded 2.3 and Qt Embedded 4. Qt 3, KDE and even Gtk+ applications
have been ported to Qtopia versions 1 and 2 but require back-porting,
class substitution and the use of microkde sources for the KDE programs.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbba4a8"></a>
Tools You Need</h2></div></div><p>
To get started developing for Qtopia, you need a few tools. Qtopia is
Linux-only currently, so you need a Linux desktop on which to develop. You
also obviously need an editor, such as emacs or vi. For this project,
I chose KDevelop as it comes with a simple Qtopia application template.
</p><p>
If you are developing for a device, you need a cross-compiler. Our
target device, the Archos PMA430 uses arm-linux-gcc version 2.95 for
Qtopia. Although gcc 3 produces better optimized code, we want to run on
and be compatible with software currently existing on hardware, so 2.95,
as old as it is, will do. You can get ARM cross-toolchains from various
sites on the Internet. In this case, Archos has a toolchain available
at <a href="http://www.archos.com/products/overview/pma_400_sdk.html" target="_self">www.archos.com/products/overview/pma_400_sdk.html</a> and links
are also available from <a href="http://qtopia.net" target="_self">qtopia.net</a>.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbba6b8"></a>
Source Code or SDK?</h2></div></div><p>
Of course, you also need Qtopia, but you have the choice of
downloading the source code or using a ready-made Qtopia SDK. The SDK for
the PMA430 is available in commercial and GPL versions, just like Qtopia
itself. The commercial SDK can be purchased for a reasonable sum from
<a href="http://www.trolltech.com/products/qtopia/pricing.html" target="_self">www.trolltech.com/products/qtopia/pricing.html</a>, and the free,
GPL version can be downloaded from <a href="ftp://ftp.trolltech.com/qtopia/sdk" target="_self">ftp.trolltech.com/qtopia/sdk</a>.
These install to /opt/Qtopia. Then from a command prompt do:

<pre     class="programlisting">
# ln -s /opt/Qtopia/sharp /opt/Qtopia/arm
</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbba8c8"></a></h2></div></div><p>
if there is no /opt/Qtopia/arm directory.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbba9d0"></a>
KDevelop Project</h2></div></div><p>
Start KDevelop, and from the Project menu choose New Project. Open the C++
directory icon, under the directory Embedded. Click the file called
Qtopia Application to start a new Qtopia project. I could name
this anything, like hippopotamus, but instead I will name my project
skizzy. See Figure 1 for an example dialog for creating this
project.
</p><div       class="mediaobject"><a href="8691f1.large.jpg"><img src="8691f1.jpg"></a><div class="caption"><p>
Figure 1. Creating the skizzy Project
</p></div></div><p>
Once you have a project, you can start editing it to suit your needs. You
need to be sure to use Designer from Qt 2 when you edit .ui (user
interface) files for Qtopia, as .ui files generated from later versions
of Qt are not compatible. I do this by setting up a custom external tool
and then opening my .ui file from within Designer 2.
</p><p>
Note: do <span   class="emphasis"><em>not</em></span> open by clicking on the .ui file, because Designer 3 will
open up within KDevelop, and you can mangle your .ui file. Because of
this, you have to run KDevelop from a command line, after exporting
a few variables:

<pre     class="programlisting">
export PATH=/opt/Qtopia/bin:$PATH
export LD_LIBRARY_PATH=/opt/Qtopia/lib:$LD_LIBRARY_PATH
</pre>
</p><p>
You also want to set up the Qt Virtual framebuffer tool by the name
of QVFb, pointing to /opt/Qtopia/bin/qvfb, in which the application
will run on the desktop. Qtopia displays directly to the framebuffer,
and therefore it does not need the overhead of the X-11 display server.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbbae48"></a>
Setting Up the Development Environment</h2></div></div><p>
We need to set some environmental variables for our KDevelop project. Run
KDevelop, and then click on Project&rarr;Project Options&rarr;Run Options. Add
these variables:

<pre     class="programlisting">
Name: QTDIR Value: /opt/Qtopia
Name: QPEDIR Value: /opt/Qtopia
Name PATH Value: /opt/Qtopia/bin:$PATH
Name LD_LIBRARY_PATH Value: /opt/Qtopia/lib:$LD_LIBRARY_PATH
</pre>
</p><p>
Similarly, add to the Make Options, for desktop development:

<pre     class="programlisting">
Name: QTDIR Value: /opt/Qtopia
Name: QPEDIR Value: /opt/Qtopia
Name PATH Value: /opt/Qtopia/bin:/opt/Qtopia/tmake/bin:$PATH
Name LD_LIBRARY_PATH Value: /opt/Qtopia/lib:$LD_LIBRARY_PATH
Name TMAKEPATH Value:/opt/Qtopia/tmake/lib/qws/linux-generic-g++
</pre>
</p><p>
Add <tt  >-lqtopia</tt> to the LIBS line in skizzy.pro, as
Qtopia 1.7 adds a new
library.
</p><p>
At this point, you need to generate a Makefile manually, as KDevelop
does not use tmake correctly:

<pre     class="programlisting">
# export TMAKEPATH=/opt/Qtopia/tmake/lib/qws/linux-generic-g++
# tmake -o Makefile skizzy.pro
</pre>
</p><p>
Then you can build the project (F8) from within KDevelop. This little
glitch will be resolved in newer versions of Qtopia that use qmake to
generate Makefiles.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbbb210"></a>
Getting Gritty</h2></div></div><p>
Let's add some functionality to skizzy.
</p><p>
Start the Designer 2 application and open skizzybase.ui, and delete the
QLabel. Add a QTabWidget with a QComboBox on the first tab, a QListBox
on the second tab and a QMultiLineEdit on the third tab, for example
(Figure 2).
</p><div       class="mediaobject"><img src="8691f2.jpg"><div class="caption"><p>
Figure 2. If you use QLayouts, it allows your application to resize
depending on the display resolution or screen rotation.
</p></div></div><p>
Save the .ui file.
</p><p>
Open the file skizzy.cpp with KDevelop. You will see our application is
derived from skizzyBase:

<pre     class="programlisting">
skizzy::skizzy( QWidget* parent,  const char* name, WFlags fl )
    : skizzyBase( parent, name, fl )
</pre>
</p><p>
I want to change main.cpp to a better method of constructing the
application that was added since the time that the Qtopia templates
for KDevelop were created.
</p><p>
We change the usual main() function:

<pre     class="programlisting">

int main( int argc, char ** argv )
{
    QPEApplication a( argc, argv );
    skizzy mw;
    a.showMainWidget( &amp;mw );
    return a.exec();
}

</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbbb738"></a></h2></div></div><p>
to Qtopia's application macro:

<pre     class="programlisting">
QTOPIA_ADD_APPLICATION("skizzy",skizzy);
QTOPIA_MAIN
</pre>
</p><p>
This allows us to create a quicklaunch application, which helps speed
up startup time, by using the common application constructor that is
already in memory.
</p><p>
My application skizzy doesn't do anything yet, so include:

<pre     class="programlisting">

#include &lt;qpe/fontdatabase.h&gt;

</pre>
</p><p>
Add a private member:

<pre     class="programlisting">
FontDatabase fdb;
</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbbba50"></a></h2></div></div><p>
and some functions as private slots:

<pre     class="programlisting">

private slots:
void fillCombo();
void comboSelected(const QString &amp;);
void showFont( QListBoxItem *);

</pre>
</p><p>
We need to add a few lines in skizzy.cpp here for things we will use:

<pre     class="programlisting">

#include &lt;qstringlist.h&gt;
#include &lt;qcombobox.h&gt;
#include &lt;qtabwidget.h&gt;
#include &lt;qlistbox.h&gt;
#include &lt;qmultilineedit.h&gt;
#include &lt;qfont.h&gt;
#include &lt;qfontinfo.h&gt;

#include &lt;qpe/fontdatabase.h&gt;

</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbbbc60"></a></h2></div></div><p>
and then add the implementations, to which we will connect our widgets
signals:

<pre     class="programlisting">

/*
This function uses Qtopia's FontDatabase to
fill the combobox with a list of font names.*/
void skizzy::fillCombo()
{
	QStringList families = fontdb.families();
  	for ( QStringList::Iterator f = families.begin(); f != families.end();++f ) {
      	QString family = *f;
		ComboBox1-&gt;insertItem( family);
	}
}

/*
This gets called when the combobox is selected, and
fills the listbox on the second tab with the name,
style and point size for the family of fonts
selected, and raises it. */
void skizzy::comboSelected(const QString &amp;selectedFont)
{
ListBox1-&gt;clear();

 QStringList styles = fdb.styles( selectedFont );
  	for ( QStringList::Iterator s = styles.begin(); s != styles.end();++s ) {
              QString style = *s;
              QValueList&lt;int&gt; smoothies = fdb.smoothSizes( selectedFont, style );
               for ( QValueList&lt;int&gt;::Iterator points = smoothies.begin(); points != smoothies.end(); ++points ) {
                   QString pointSize = selectedFont + " "+ style +" "+QString::number( *points ) + " ";
                  ListBox1 -&gt;insertItem( pointSize);
               }
           }
    TabWidget2-&gt;showPage(tab2);
}

/*
This shows example text of the selected font in
the QMultiLineWidget on the 3rd tab, and raises it.*/
void skizzy::showFont( QListBoxItem *item)
{
	QStringList fontItemString = QStringList::split(' ',item-&gt;text());
	QString family, style, point;

    family = fontItemString[0];
    style = fontItemString[1];
    point = fontItemString[2];
    bool ok;
    int i_size = point.toInt(&amp;ok,10);

    if (!ok) {
        style += " "+fontItemString[2];
        point = fontItemString[3];
        i_size = point.toInt(&amp;ok,10);
    }

    QFont selectedFont( family);
    selectedFont.setPointSize(i_size);

     if(style.find("Italic",0,TRUE) != -1) {
          selectedFont.setItalic(TRUE);
     }

     if(style.find("Bold",0,TRUE) != -1) {
        selectedFont.setWeight(QFont::Bold);
     }

     if(style.find("Light",0,TRUE) != -1) {
        selectedFont.setWeight(QFont::Light);
    }

    MultiLineEdit1-&gt;setFont( selectedFont);
    MultiLineEdit1-&gt;setText( tr( "The Quick Brown Fox Jumps Over The Lazy Dog" ) );
    MultiLineEdit1-&gt;setWordWrap( QMultiLineEdit::WidgetWidth);

	TabWidget2-&gt;showPage(tab3);
}

</pre>
</p><p>
Qt and Qtopia use signals for sending messages between widgets. Every
widget has some kind of signal it emits, and we can use the connect
macros to link up functionality.
</p><p>
Connect ComboBox1's activated signal, and ListBox1's clicked signal to
our slots, like this:

<pre     class="programlisting">

skizzy::skizzy( QWidget* parent,  const char* name, WFlags fl )
    : skizzyBase( parent, name, fl )
{
    connect(bye, SIGNAL(clicked()), this, SLOT(goodBye()));
    connect(ComboBox1, SIGNAL(activated(const QString &amp;)), this, SLOT(comboSelected(const QString &amp;)));
    connect(ListBox1, SIGNAL( clicked ( QListBoxItem * )), this, SLOT(showFont( QListBoxItem*)));
    fillCombo();
}

</pre>
</p><p>
Notice how the slot function takes an argument of the exact same type
as the signal.
</p><p>
In KDevelop, either press F8, or in the menu, select Build&rarr;Build Project.
</p><p>
It should now compile, using the native compiler. To run it, start up
QVFb, and simply select Build&rarr;Execute Main Program. The skizzy application
should show up in QVFb.
</p><div       class="mediaobject"><img src="8691f3.jpg"><div class="caption"><p>
Figure 3. Skizzy with real, if not useful features.
</p></div></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xac2580.0xbb2a18"></a>
Cross-Compiling</h2></div></div><p>
So, now that we have a reasonably working program, we need to
cross-compile this for the Archos device. We have to change the project
settings to find the proper libraries.
</p><p>
We are now ready to cross-compile, so clean the project by selecting
Build&rarr;Clean Project from the menu.
</p><p>
You need to change the Make Options, using the Project Options&rarr;Make
Options dialog:

<pre     class="programlisting">
Name: QTDIR Value: /opt/Qtopia/arm
Name: QPEDIR Value: /opt/Qtopia/arm
Name PATH Value: /usr/local/arm/bin:/opt/Qtopia/tmake/bin:$PATH
Name TMAKEPATH Value:/opt/Qtopia/tmake/lib/qws/linux-arm-g++
</pre>
</p><p>
Delete the Makefile, and run the following command from the command line to
create the Makefile for compiling using the arm-linux compiler:

<pre     class="programlisting">
# export TMAKEPATH=/opt/Qtopia/tmake/lib/qws/linux-arm-g++
# tmake -o Makefile skizzy.pro
</pre>
</p><p>
Press F8 to build the project. You can now take the resulting binary,
transfer it to the Archos device using USB, and run it from there!
</p><p>
If you want to create an installable package, Qtopia uses the Itsy Package
Management (ipkg) available from handhelds.org, to install things using the
Software Packages application. More information about ipkg and Qtopia
development are available from Trolltech's Qtopia.net Web site.
</p></div></div>
<div class="authorblurb"><p>
Lorn Potter works for Trolltech as the Qtopia Community Manager. He is an
American who lives in sunny Brisbane, Australia, with his Australian
wife and son. He is a self-taught open-source programmer who is a core
developer for the Opie (Open Palmtop Integrated Environment) Project. He
also has worked as a musician, sound engineer and snow ski bum.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../142/toc142.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>