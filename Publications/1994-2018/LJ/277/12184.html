<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Work the Shell
</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;A fun and simple script to make YouTube work for you. &#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x2398580.0x248fac0"></a>
Work the Shell
</h1></div><div><h3 class="subtitle"><i>
Working with YouTube and Extracting Audio
</i></h3></div><div><div class="author"><h3 class="author">
Dave
 
Taylor
</h3></div><div class="issuemoyr">Issue #277, May 2017</div></div><div><p>
A fun and simple script to make YouTube work for you. 
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2398580.0x24903b0"></a></h2></div></div><p>
In my last few articles, I've been exploring the capabilities of ImageMagick,
showing that just because you're working on a command line
doesn't mean you're stuck processing only text. As I explained,
ImageMagick makes it easy to work with images, adding watermarks and analyzing
content far more accurately than with the standard Linux
<tt  >file</tt> command,
and much, much more.
</p><p>
Continuing in a similar vein, I want to look at audio and video in this
article.
Well, maybe &ldquo;listen&rdquo; to audio and &ldquo;look&rdquo; at video, but
again, I'm still focusing on the command line, so in both instances,
player/viewer apps are required.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2398580.0x24906c8"></a>
YouTube to MP3 Audio</h2></div></div><p>
As someone who watches a lot of lectures online, I'm also intrigued by
the online services that can extract just the audio portion of a YouTube or
Vimeo video and save it as an MP3. Listening to a lecture while driving is
far safer than trying not to watch a video on the move, for example. 
</p><p>
Since there are so many live concert performances online, many people also
like to use a video-to-MP3 service to add those songs to their music libraries.
</p><p>
<span   class="emphasis"><em>Note: be leery of copyright issues with any download and conversion of content.
Just because it's on Vimeo, YouTube or other online service,
doesn't mean you have permission to extract the audio or even download
it and save it on your computer.</em></span>
</p><p>
Let's start with the most basic functionality: downloading a video from
YouTube so you can watch it on your Linux system. There are a lot of
browser plugins and even websites devoted to this task, but who wants to
risk malware or be plagued by porn site ads? Yech.
</p><p>
Fortunately, there's a terrific public domain program called youtube-dl
on GitHub that covers all your needs. At its most basic, it lets you
download video content from YouTube and a variety of other online video
repositories, but as you'll learn, it can do quite a bit more.
</p><p>
You can grab a copy for your system at
<a href="https://github.com/rg3/youtube-dl/blob/master/README.md" target="_self">https://github.com/rg3/youtube-dl/blob/master/README.md</a>.
</p><p>
Let's start by downloading a copy of one of my own YouTube videos.
It's a review of the splendid 1More quad-driver headphones, and its URL
is <a href="https://www.youtube.com/watch?v=BFL1E77hTHQ" target="_self">https://www.youtube.com/watch?v=BFL1E77hTHQ</a>.
</p><p>
<span   class="emphasis"><em>As an aside: I have a YouTube channel where I review consumer electronics
and gadgets. You should subscribe! Find all my videos at
<a href="http://youtube.com/askdavetaylor" target="_self">youtube.com/askdavetaylor</a>.</em></span>
</p><p>
YouTube has a bunch of ways it can assemble a URL, however, including using
its URL-shortener youtu.be, but fortunately, youtube-dl can handle the
variations.
</p><p>
Downloading a copy of the video to the current working directory is now as
simple as:
    
<pre     class="programlisting">
youtube-dl 'https://www.youtube.com/watch?v=BFL1E77hTHQ'
</pre>
</p><p>
The full output of the command is a bit, um, hairy, however:

<pre     class="programlisting">
$  youtube-dl 'https://www.youtube.com/watch?v=BFL1E77hTHQ'
[youtube] BFL1E77hTHQ: Downloading webpage
[youtube] BFL1E77hTHQ: Downloading video info webpage
[youtube] BFL1E77hTHQ: Extracting video information
[youtube] BFL1E77hTHQ: Downloading MPD manifest
WARNING: Requested formats are incompatible for merge and 
will be merged into mkv.
[download] Destination: 1More Quad Driver In-Ear Headphones
Reviewed-BFL1E77hTHQ.f137.mp4
[download] 100% of 118.74MiB in 02:49
[download] Destination: 1More Quad Driver In-Ear Headphones
Reviewed-BFL1E77hTHQ.f251.webm
[download] 100% of 4.81MiB in 00:03
[ffmpeg] Merging formats into "1More Quad Driver In-Ear 
Headphones Reviewed-BFL1E77hTHQ.mkv"
Deleting original file 1More Quad Driver In-Ear Headphones
Reviewed-BFL1E77hTHQ.f137.mp4 (pass -k to keep)
Deleting original file 1More Quad Driver In-Ear Headphones
Reviewed-BFL1E77hTHQ.f251.webm (pass -k to keep)
$
</pre>
</p><p>
You can wade through the output messages, but it's the message from
companion open-source program ffmpeg that's most important:
<tt  >merging formats into ... mkv</tt>.
</p><p>
In other words, the download format of the video is MKV by default. MKV is
part of the increasingly popular Matroska Multimedia Container format, and
it works with a lot of video players (including VideoLan, aka VLC, my favorite
cross-platform video player). 
</p><p>
A quick <tt  >ls</tt> reveals the result and that the default filename is taken from
the title of the video, something that might not be particularly desirable:

<pre     class="programlisting">
$ ls -lh *mkv
-rw-r--r--  1 taylor  staff   124M Jan 31 16:56 1More Quad 
Driver In-Ear Headphones Reviewed-BFL1E77hTHQ.mkv
</pre>
</p><p>
Do you prefer to specify the output name and have the output file in MP4 (MPEG4)
format instead? That's doable:

<pre     class="programlisting">
$ youtube-dl -o 1more-review.mp4 -f mp4 \
    'https://www.youtube.com/watch?v=BFL1E77hTHQ'
[youtube] BFL1E77hTHQ: Downloading webpage
[youtube] BFL1E77hTHQ: Downloading video info webpage
[youtube] BFL1E77hTHQ: Extracting video information
[youtube] BFL1E77hTHQ: Downloading MPD manifest
[download] Destination: 1more-review.mp4
[download] 100% of 57.63MiB in 00:27
</pre>
</p><p>
As a bonus, you get less ominous informational messages from the program
too, so it's cleaner. And the output, sure enough, is in MP4 format:

<pre     class="programlisting">
$ ls -lh *mp4
-rw-r--r--@ 1 taylor  staff  58M Jan 31 16:57 1more-review.mp4
</pre>
</p><p>
As a second bonus, it's also more efficient in its video encoding, so
the MP4 version of the downloaded video is only 58M as opposed to the 124M
of the MKV-merged version.
</p><p>
So how do you watch it? Most likely, do a double-click and it'll be up and
running, as shown in Figure 1.
</p><div       class="mediaobject"><a href="12184f1.large.jpg"><img src="12184f1.jpg"></a><div class="caption"><p>
Figure 1. Downloaded YouTube Video Playing in Ubuntu Player 
</p></div></div><p>
That's easy enough, but the original goal was to be able to extract just the audio
component of a YouTube video, so let's look at that task.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2398580.0x2491430"></a>
Downloading Just the Audio Track</h2></div></div><p>
Since I've already started to delve into the command-line options for
the youtube-dl program, it's not a leap to find out that there's
yet another command-line option that lets you save just the audio portion
of a video:

<pre     class="programlisting">
$ youtube-dl -x --audio-format mp3 \
    'https://www.youtube.com/watch?v=BFL1E77hTHQ'
[youtube] BFL1E77hTHQ: Downloading webpage
[youtube] BFL1E77hTHQ: Downloading video info webpage
[youtube] BFL1E77hTHQ: Extracting video information
[youtube] BFL1E77hTHQ: Downloading MPD manifest
[download] Destination: 1More Quad Driver In-Ear Headphones
Reviewed-BFL1E77hTHQ.webm
[download] 100% of 4.81MiB in 00:07
[ffmpeg] Destination: 1More Quad Driver In-Ear Headphones
Reviewed-BFL1E77hTHQ.mp3
Deleting original file 1More Quad Driver In-Ear Headphones
Reviewed-BFL1E77hTHQ.webm (pass -k to keep)
$ ls -lh *mp3
-rw-r--r--  1 taylor  staff   4.0M Jan 31 18:22 1More Quad 
Driver In-Ear Headphones Reviewed-BFL1E77hTHQ.mp3
</pre>
</p><p>
That's easy enough, and the output is delightfully small: 4MB total. The problem is,
there's the same awkward naming issue, so the addition of <tt  >-o
output-filename</tt> definitely will be a win. But, really, youtube-dl makes
these tasks trivially easy, as long as you're willing to figure out all
of its command-line options. 
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2398580.0x2491640"></a>
Writing a Wrapper Script</h2></div></div><p>
Instead of worrying about the obscure command-line flag notation, let's
just write a script that does the heavy lifting for you. I'm going to
call it ytdl for &ldquo;youtube download&rdquo;, and by default, it'll accept
just a URL and output an MP4 format video file that has the same name as
the YouTube shortcut (for example, the above video would become BFL1E77hTHQ.mp4). 
</p><p>
Add a second parameter, and that becomes the output filename. Specify the
<tt  >-a</tt> flag, and it saves audio output only, in MP3 format instead.
</p><p>
Let's start with a usage block if the user forgets to specify anything
or just needs a simple reminder:

<pre     class="programlisting">
if [ $# -eq 0 ] ; then
  echo "Usage: $(basename $0) {-a} YouTubeURL {outputfile}"
  echo "   where -a extracts the audio portion in MP3 format"
  exit 1
fi
</pre>
</p><p>
That's easy enough. The script is also going to use some predefined combinations
of flags to make it easier to write:

<pre     class="programlisting">
youtubedl="/usr/local/bin/youtube-dl"
audioflags="-x --audio-format mp3"
videoflags="-f mp4"
flags=$videoflags       # default set of command flags
audioonly=0             # default is audio + video
</pre>
</p><p>
If the user specifies the <tt  >-a</tt> flag,
<tt  >audioonly</tt> will be set to true (that is, 1),
and the default flags will switch from video to audio:

<pre     class="programlisting">
if [ "$1" = "-a" ] ; then
  audioonly=1
  flags=$audioflags
  shift
fi
</pre>
</p><p>
You'll recall that the <tt  >shift</tt> command moves all the parameters
&ldquo;down&rdquo; one to the left, so <tt  >$2</tt> becomes
<tt  >$1</tt> and so on. It's an easy way to
process and discard parameters in a script, of course.
</p><p>
The biggest block of code creates a default output filename from the
YouTube URL:

<pre     class="programlisting">
if [ $# -eq 1 ] ; then
  # no output filename specified
  outfile=$(echo "$1" | cut -d= -f2)
  if [ $audioonly -eq 1 ] ; then
    outfile="$outfile.mp3"
  else
    outfile="$outfile.mp4"
  fi
else
  outfile="$2"
fi
</pre>
</p><p>
This isn't the most robust code, because it assumes that the URL
specified is in a format like the examples used herein,
<tt  >youtube-yadda-yadaa?value=shortcode</tt>. It extracts the shortcode and simply
appends an appropriate filename suffix. There are better ways to do this,
but that's okay, this'll work for now. Just realize that your
output format might be a bit weird if you have a very different type of
YouTube URL or a URL from another site.
</p><p>
And, finally, the actual invocation of the
<tt  >youtube-dl</tt> command:

<pre     class="programlisting">
$youtubedl $flags -o "$outfile" "$1" 
</pre>
</p><p>
That's it! Now you can download a video as simply as:

<pre     class="programlisting">
$ ytdl 'https://www.youtube.com/watch?v=5yXDzg_QDGw' wiper.mp4
</pre>
</p><p>
And an audio portion with:

<pre     class="programlisting">
$ ytdl -a 'https://www.youtube.com/watch?v=5yXDzg_QDGw'
</pre>
</p><p>
Nice, eh?
</p><p>
I've way overrun my space for this column, but this is such a fun and
simple script atop a terrific, powerful program, that it's worth it,
right? And now you know how to make YouTube work for you, rather than
vice versa! 
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2398580.0x288a3e8"></a></h2></div></div><div class="sidebar"><p class="title"><b></b></p><p>Send comments or feedback via <a href="http://www.linuxjournal.com/contact" target="_self">www.linuxjournal.com/contact</a> or to
<a href="mailto:info@linuxjournal.com">info@linuxjournal.com</a>.
</p></div></div></div>
<div class="authorblurb"><p>
Dave Taylor has been hacking shell scripts on UNIX and Linux systems for a
really
long time. He's the author of <span   class="emphasis"><em>Learning Unix for Mac OS
X</em></span> and
<span   class="emphasis"><em>Wicked Cool Shell Scripts</em></span>. You can find him on Twitter
as @DaveTaylor
or
reach him through his tech Q&amp;A site: <a href="http://www.AskDaveTaylor.com" target="_self">www.AskDaveTaylor.com</a>.

</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../277/toc277.html">Issue Table of Contents</a>
    <a class="link3" href="../277/12184.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>