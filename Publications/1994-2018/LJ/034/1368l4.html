<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 3.2//EN">

<html>
<head>
  <title>Writing CGI Scripts in Python</title>
<link rel="stylesheet" href="../../css/archive.css" type="text/css" />
</head>

<body>
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <pre>
#!/usr/local/bin/python
#
# CGI count - Uses a gdbm database
#

from string import atoi, zfill
import gdbm
import cgi


DIGITS = 4


hex_bytes = [
     [ "0xff,0xff,", "0xff,0xff,", "0xff,0xff,", "0xff,0xff,",
"0xff,0xff,", "0xff,0xff,", "0xff,0xff,", "0xff,0xff,",
"0xff,0xff,", "0xff,0xff," ],
     [ "0x01,0xc0,",     "0x01,0xc0,", "0x01,0xc0,",
"0x01,0xc0,", "0x01,0xc0,", "0x01,0xc0,", "0x01,0xc0,",
"0x01,0xc0,", "0x01,0xc0,", "0x01,0xc0," ],
     [ "0xfd,0xdf,",     "0xfd,0xdf,", "0xfd,0xdf,",
"0xfd,0xdf,", "0xfd,0xdf,", "0xfd,0xdf,", "0xfd,0xdf,",
"0xfd,0xdf,", "0xfd,0xdf,", "0xfd,0xdf," ],
     [ "0x3d,0xde,",     "0x7d,0xde,", "0x1d,0xde,",
"0x3d,0xdc,", "0xfd,0xdd,", "0x7d,0xd0,", "0xfd,0xd1,",
"0x0d,0xd0,", "0x1d,0xdc,", "0x1d,0xde," ],
     [ "0xdd,0xdd,",     "0x1d,0xde,", "0x0d,0xdc,",
"0xdd,0xd8,", "0xfd,0xdc,", "0x3d,0xd8,", "0x7d,0xde,",
"0x0d,0xd8,", "0xcd,0xd9,", "0xcd,0xd9," ],
     [ "0xcd,0xd9,",     "0x7d,0xde,", "0xe5,0xd8,",
"0xed,0xd9,", "0x7d,0xdc,", "0xbd,0xdf,", "0x3d,0xdf,",
"0xf5,0xdb,", "0xe5,0xd3,", "0xed,0xd9," ],
     [ "0xed,0xdb,",     "0x7d,0xde,", "0xf5,0xd9,",
"0xfd,0xd9,", "0xbd,0xdc,", "0x1d,0xdf,", "0x9d,0xdf,",
"0xfd,0xdb,", "0xe5,0xd3,", "0xe5,0xd3," ],
     [ "0xe5,0xd3,",     "0x7d,0xde,", "0xfd,0xd9,",
"0xfd,0xdd,", "0xdd,0xdc,", "0x1d,0xdc,", "0xcd,0xdf,",
"0xfd,0xdd,", "0xc5,0xd3,", "0xe5,0xd3," ],
     [ "0xe5,0xd3,",     "0x7d,0xde,", "0xfd,0xd9,",
"0x7d,0xde,", "0xdd,0xdc,", "0x7d,0xd8,", "0x2d,0xdc,",
"0xfd,0xdd,", "0x8d,0xd9,", "0xe5,0xd3," ],
     [ "0xe5,0xd3,",     "0x7d,0xde,", "0xfd,0xdd,",
"0x3d,0xdc,", "0xed,0xdc,", "0xfd,0xd1,", "0xc5,0xd9,",
"0xfd,0xdd,", "0x1d,0xde,", "0xc5,0xd3," ],
     [ "0xe5,0xd3,",     "0x7d,0xde,", "0xfd,0xde,",
"0xfd,0xd8,", "0xf5,0xdc,", "0xfd,0xd3,", "0xe5,0xd1,",
"0xfd,0xde,", "0x3d,0xdc,", "0xcd,0xd3," ],
     [ "0xe5,0xd3,",     "0x7d,0xde,", "0xfd,0xde,",
"0xfd,0xd1,", "0xf5,0xdc,", "0xfd,0xd3,", "0xe5,0xd3,",
"0xfd,0xde,", "0xcd,0xd8,", "0x1d,0xd8," ],
     [ "0xe5,0xd3,",     "0x7d,0xde,", "0x7d,0xdf,",
"0xfd,0xd3,", "0x05,0xd0,", "0xfd,0xd7,", "0xe5,0xd3,",
"0xfd,0xde,", "0xe5,0xd1,", "0xfd,0xd9," ],
     [ "0xed,0xdb,",     "0x7d,0xde,", "0xbd,0xdf,",
"0xfd,0xd3,", "0xfd,0xdc,", "0xfd,0xd7,", "0xe5,0xd3,",
"0x7d,0xdf,", "0xe5,0xd3,", "0xfd,0xdd," ],
     [ "0xcd,0xd9,",     "0x7d,0xde,", "0xdd,0xd7,",
"0xfd,0xdb,", "0xfd,0xdc,", "0xfd,0xdb,", "0xcd,0xdb,",
"0x7d,0xdf,", "0xe5,0xd3,", "0x7d,0xde," ],
     [ "0xdd,0xdd,",     "0x7d,0xde,", "0x0d,0xd0,",
"0xcd,0xd9,", "0xfd,0xdc,", "0xcd,0xdd,", "0xcd,0xd9,",
"0x7d,0xdf,", "0xcd,0xd9,", "0x3d,0xdf," ],
     [ "0x3d,0xde,",     "0x1d,0xd8,", "0x05,0xd8,",
"0x0d,0xde,", "0xfd,0xdc,", "0x0d,0xde,", "0x3d,0xdc,",
"0xbd,0xdf,", "0x1d,0xdc,", "0xc5,0xdf," ],
     [ "0xfd,0xdf,",     "0xfd,0xdf,", "0xfd,0xdf,",
"0xfd,0xdf,", "0xfd,0xdf,", "0xfd,0xdf,", "0xfd,0xdf,",
"0xfd,0xdf,", "0xfd,0xdf,", "0xfd,0xdf," ],
     [ "0x01,0xc0,",     "0x01,0xc0,", "0x01,0xc0,",
"0x01,0xc0,", "0x01,0xc0,", "0x01,0xc0,", "0x01,0xc0,",
"0x01,0xc0,", "0x01,0xc0,", "0x01,0xc0," ],
     [ "0xff,0xff,",     "0xff,0xff,", "0xff,0xff,",
"0xff,0xff,", "0xff,0xff,", "0xff,0xff,", "0xff,0xff,",
"0xff,0xff,", "0xff,0xff,", "0xff,0xff," ]
]

def print_header() :
    ############
     print "Content-type: image/x-bitmap"
     print
     print "#define counter_width", DIGITS * 16
     print "#define counter_height 20"
     print "static char counter_bits[] = {"


def print_footer() :
    ############
     print "0x00 } ;"
     print


def print_digits_values( s ) :
    ###################
     i = 0
     while i &lt; 20 :
          for d in s :
               print hex_bytes[ i ][ atoi( d ) ],
          print
          i = i + 1


def inc_counter( s ) :
    ###########
     val = atoi( s ) + 1
     return zfill( str( val ), DIGITS )


def get_put_counter( url ) :
    ###############
     db = gdbm.open( "counters.gdbm", "w", 0644 )
     if db.has_key( url ) :
          s = db[ url ]
     else :
          s = zfill( '0', DIGITS )
     s = inc_counter( s )
     db[ url ] = s
     return s


def CGImain() :
    #######
     list = cgi.SvFormContentDict()
     if list.has_key( "url" ) :
          url = list[ "url" ]
          counter = get_put_counter( url )
          print_header()
          print_digits_values( counter )
          print_footer()


CGImain()

</pre>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../034/toc034.html">Issue Table of Contents</a>
    <a class="link3" href="../034/1368.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body>
</html>
<!--
## vim: tabstop=2: shiftwidth=2: expandtab:
## kate: tab-width 2; indent-width 2; replace-tabs true;
-->
