<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Serial Terminal as Console</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;    Complete instructions for setting up a cheap headless Linux box.&#10;    "><meta name="keywords" content="administration, programming, development, console"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x18a0580.0x1997ab0"></a>Serial Terminal as Console</h1></div><div><div class="author"><h3 class="author">Francesco Conti</h3></div><div class="issuemoyr">Issue #36, April 1997</div></div><div><p>
    Complete instructions for setting up a cheap headless Linux box.
    </p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x18a0580.0x19983a0"></a></h2></div></div><p>A frequently asked, but never completely
answered, question in the comp.os.linux.* newsgroups and other
Linux mailing lists, is the one about cheap, headless Linux boxes.
It seems that many people need to install Linux boxes without a
video card, a monitor or a keyboard.
</p><p>A cheap response to this problem is to use a serial terminal
(Wyse or Ampex, for example) as the main Linux console. This cuts
the cost of a keyboard, a video card and a monitor. I've done this
very thing on my second computer, an old 486 VLB, by using a Wyse
60 terminal.</p><p>Linking a terminal to your computer's serial port is not at
all difficult. You can easily follow the instructions in the
Serial-HOWTO and in the inittab(5) and agetty(8) man pages. Here's
a short summary.</p><p>First, you must use a null modem cable.</p><p>Second, insert the following line in your /etc/inittab file,
if you're using agetty. Other getty programs, like getty_ps, use a
different syntax.</p><pre     class="programlisting">
ID:RUNLEVELS:respawn:/sbin/agetty -L SPEED TTY TERM
</pre><p>where:
<div class="itemizedlist"><ul type="disc"><li><p>ID = a two character identifier, e.g., s1 or
s2</p></li><li><p>RUNLEVELS = Runlevels in which the terminal must be
active</p></li><li><p>SPEED = serial port speed</p></li><li><p>TTY = tty port name relative to the /dev
directory</p></li><li><p>TERM = value to be used for the TERM environment
variable</p></li></ul></div>

</p><p>My machine's /etc/inittab has the following line:</p><pre     class="programlisting">
s2:12345:respawn:/sbin/agetty -L 9600 ttyS1 vt100
</pre><p>for a serial terminal on the /dev/ttyS1 port (COM2 for DOS
users), with a port speed of 9600 BPS and vt100 terminal emulation
(which seems to run better than native Wyse 60 mode).
</p><p>Finally, restart init with the command <b  >init
q</b>.</p><p>If you correctly followed these three simple steps, you
should see the login prompt on your terminal screen. You can log in
and work on your machine in the same way you can when you're
actually on the console or telneting from a remote host.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x18a0580.0x1998c90"></a>Kernel Messages</h2></div></div><p>The messages the kernel shows at boot time are always
directed to your main console (tty1). If you turn on your headless
box, you can only wait for the login on the terminal, which means
losing those precious messages. You can see them by using the dmesg
command, but usually you need them before the login shell comes
up.</p><p>There are other messages on your console: those generated by
the scripts in the /etc/rc.d directory, and from scripts run at
boot and shutdown time. How can you really know that &ldquo;the system
is halted&rdquo; if you can't read it on a monitor?</p><p>You must patch the /usr/src/linux/drivers/char/console.c
program in your kernel source tree. It's not a complex kernel hack.
You can follow these three simple steps.</p><p>First, define the CONFIG_SERIAL_ECHO symbol at program
start:</p><pre     class="programlisting">
#define CONFIG_SERIAL_ECHO
</pre><p>Second, modify the address of the terminal serial port (only
if you're using a port different from that defined by default)
looking for the following line:
<pre     class="programlisting">
#define SERIAL_ECHO_PORT        0x3f8   /* COM1 */
</pre>


In my machine I've changed that line to:
<pre     class="programlisting">
#define SERIAL_ECHO_PORT        0x2f8   /* COM2 */
</pre>


Third, rebuild your kernel and reboot: you should see on your
terminal screen the kernel messages during your system's hardware
devices probe.
</p><p>Please note that these steps work for a 2.0.0 kernel, not on
1.2.13. I haven't yet had time to try other kernels. The console.c
patch is necessary for all Linux ports except the one for Alpha,
which contains it in the <b  >make config</b> with the
following option:</p><pre     class="programlisting">
Echo console messages on /dev/ttyS1
</pre></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x18a0580.0x1999108"></a>Messages from /etc/rc.d/rc.*</h2></div></div><p>To show these messages on your terminal, you can append
<b  >&gt; TTY</b> to every line of these files that
contains the command <b  >echo</b>. TTY is the terminal
serial port (the same one used in /etc/inittab serial terminal
line).</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x18a0580.0x19992c0"></a>LILO Configuration</h2></div></div><p>If you want to choose among more than two kernel images, you
have to modif the LILO configuration file, /etc/lilo.conf.</p><p>Complete instructions for seeing the LILO prompt on serial
terminals can be found in the /usr/doc/lilo/README file (look for
the SERIAL option). Here are two steps to do that correctly.</p><p>First, edit the /etc/lilo.conf file and insert a SERIAL
option line after the BOOT option line:</p><pre     class="programlisting">
serial=SERIAL_LINE,SPEED PARITY BITS
</pre><p>where:
<pre     class="programlisting">
SERIAL_LINE = 0 (com1)
              1 (com2)
              2 (com3)
              3 (com4)
SPEED = serial port speed
PARITY = n (= none)
         o (= odd)
         e (= even)
BITS = bits in a character (8 or 7)
</pre>


Please note that there are no spaces between the
<b  >SPEED</b>, <b  >PARITY</b> and
<b  >BITS</b> parameters. These must be equal to the ones
defined in your terminal setup. Here's the line used by my
machine's LILO:
<pre     class="programlisting">
serial=1,9600n8
</pre>


This line means COM2 at 9600 BPS, no parity, 8 bits per character.
</p><p>Second, execute the <b  >lilo</b> command to update
your system's configuration.</p><p>Using the SERIAL option, LILO sets a two second delay (the
same as when you put a <b  >delay = 20</b> line in the
lilo.conf file) before booting the default kernel image. During
this pause, you can interrupt the boot process and get the LILO
prompt by sending a break to the terminal as you press the SHIFT
key on your main console.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x18a0580.0x1999840"></a>Conclusion</h2></div></div><p>At last, your serial terminal can be used as a real system
console. I think that the only thing you can't do is the
CTRL-ALT-DEL reset&mdash;except, perhaps, with certain terminal
emulations. If you're lucky, you can find one of these terminals
cheaply, maybe even free, from a company upgrading its
hardware.</p></div></div>
<div class="authorblurb"><p>Franceso Conti can be reached by e-mail at
      fconti@iper.net.</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../036/toc036.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>