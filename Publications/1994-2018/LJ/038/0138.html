<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Consistent Keyboard Configuration</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;    Eliminate inconsistent behavior from your keyboard by following the&#10;    instructions in this article.&#10;    "><meta name="keywords" content="keyboard"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x2a61580.0x2b58ab0"></a>Consistent Keyboard Configuration</h1></div><div><div class="author"><h3 class="author">John F. Bunch</h3></div><div class="issuemoyr">Issue #38, June 1997</div></div><div><p>
    Eliminate inconsistent behavior from your keyboard by following the
    instructions in this article.
    </p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x2b592f0"></a></h2></div></div><p>One of the convenient features of Linux
is that the keyboard can be completely reconfigured to suit
personal tastes. This feature can be a blessing or a curse when
keys do not perform the same actions in all applications, but with
a little work you can program any key to perform almost any task.
Inconsistent keyboard behavior can be eliminated, and applications
customized as desired.
</p><p>In this article, you learn how to achieve consistent behavior
for the <b  >BACKSPACE</b>, <b  >DELETE</b> and
<b  >ALT</b> keys. The Caps Lock key is switched with the
left <b  >CTRL</b> key to make the typing of control
characters easier. The keys of the editing keypad are configured to
perform as labeled. Function keys, and some keys of the numeric
keypad, are programmed to perform arbitrary tasks. A shutdown key
is also configured.</p><p>The keyboard configuration techniques will be demonstrated by
a wide range of examples, one program at a time. Where practical,
these techniques will be demonstrated for bash, less, Netscape,
minicom and Emacs. Furthermore, the keyboard will be made to work
as desired, regardless of whether the application is running in an
xterm window, in a virtual console, or in an X11 window manager.
However, it is assumed that the user has an IBM PC-compatible
keyboard.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x2b59608"></a>Definitions</h2></div></div><p>An IBM PC-compatible keyboard is divided into five blocks of
keys. The alphabetic keys and those surrounding them form the main
keypad. To the immediate right of the main keypad are two small
sets of keys. The upper six keys are the editing keys; the lower
four keys are the arrow keys, which are also called cursor control
keys. At the far right is the numeric keypad. Finally, the function
keys stretch in a single line across the top of the
keyboard.</p><p>When a function key or an arrow key is pressed, an escape
sequence is normally transmitted by the key. An escape sequence is
a string of a few characters, the first of which is an
<b  >ESCAPE</b> control code. The rest of the string is
used to distinguish one key from another.</p><p>The VT100 family is a set line of text-only display terminals
once manufactured by Digital Equipment Corporation. The VT100 has
become the de facto standard for ASCII terminals. Its successor,
the VT200, is compatible with the VT100 family. However, VT200s
also have a row of twenty function keys and six editing keys that
the VT100s did not have. The VT200 keyboard is somewhat similar to
the IBM PC-style keyboard that is now in general use.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x2b59818"></a>Keypress Events</h2></div></div><p>A keypress event occurs when the user presses any key on the
keyboard. The event passes through various software programs,
eventually resulting in some sort of action (see Figure 1).
Ideally, the same keypress will result in a similar action in all
programs, thus reducing the user's confusion.</p><p>For example, suppose a user is running Emacs inside an xterm
under the X Window System and presses the up arrow key. Referring
again to Figure 1, the up arrow is pressed, resulting in an event
keycode of 98 being generated, which uniquely identifies that key.
The X Window System translates this keycode into the &ldquo;Up&rdquo; keysym,
which is received by the xterm. The xterm then translates the
&ldquo;Up&rdquo; keysym into the three-character escape sequence &ldquo;\\eOA&rdquo;
(&ldquo;\\e&rdquo; represents the ASCII ESCAPE control code). Emacs receives
&ldquo;\\eOA&rdquo; as a series of three input events, which are then
translated by the function-key-map into the vector [up]. The vector
[up] passes unchanged through the key-translation-map. Finally, the
global-map maps [up] to the previous-line command, which moves the
cursor up one line in the buffer.</p><p><a href="0138f1.html" target="_self">Figure 1. Keypress Event
Flowchart</a></p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x2b59a28"></a><b  >BACKSPACE</b>,
<b  >DELETE</b> and <b  >ALT</b></h2></div></div><p>One way to approach configuring the
<b  >BACKSPACE</b> and <b  >DELETE</b> keys is
to let them act as they do in DOS and MS Windows. That is,
<b  >BACKSPACE</b> erases the character to the left of
the cursor, and <b  >DELETE</b> erases the character
under the cursor. This is a very convenient arrangement.</p><p>It is also a good idea to decide what control codes should be
transmitted when these keys are pressed. Based on the key labels,
let the <b  >BACKSPACE</b> key transmit a
<b  >BACKSPACE</b> (ASCII code 8, 010 in octal, 0x08 in
hexadecimal, <b  >CTRL-H</b>), and let the
<b  >DELETE</b> key transmit a <b  >DELETE</b>
(ASCII code 127, 177 in octal, 7F in hexadecimal). Simple solutions
are usually the best.</p><p>The ALT key, which acts somewhat like a shift key, can be
configured in one of two ways. Either it can set the eighth bit of
the key being pressed with it, or it can cause an
<b  >ESCAPE</b> to be transmitted just before the key
being pressed with it. Both methods will be used at different
times. Sometimes it is simpler to configure the
<b  >ALT</b> key to transmit an
<b  >ESCAPE</b>. For example, holding down
<b  >ALT</b> while pressing A would cause the string
&ldquo;\\eA&rdquo; to be transmitted. However, at other times it will be
configured to set the eighth bit of the character being pressed,
thus adding 128 to the ASCII code of that character. Meta is a
synonym for <b  >ALT</b>.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x2b5a1b8"></a>Linux Kernel</h2></div></div><p>First, the kernel's keyboard translation tables will be
redefined. Since these tables are not used directly by the X Window
System, use one of the virtual consoles, not a window manager. Log
in as root or use <b  >su</b>. Different distributions of
Linux may load the translation tables in different ways. To
determine which keyboard translation table is in use, type:</p><pre     class="programlisting">
# find /etc -type f | xargs grep loadkeys
</pre><p>You should see output something like:
<pre     class="programlisting">
/etc/init.d/boot:  loadkeys \
        /usr/lib/kbd/keytables/us.map
</pre>


which would indicate that the U.S. translation table is in use.
</p><p>Assuming the U.S. translation table is in use, enter the
following commands to make a copy of it:</p><pre     class="programlisting">
# cd /usr/lib/kbd/keytables
# cp us.map custom.map
</pre><p>The format of keyboard table files is given in keytables(5).
</p><p>Now edit custom.map using any text editor. Find the following
lines:</p><pre     class="programlisting">
keycode 14 = Delete           Delete
        alt     keycode  14 = Meta_Delete
</pre><p>These lines specify that when <span   class="emphasis"><em>keynumber</em></span>
14 is pressed (the <b  >BACKSPACE</b> key), send a
<b  >DELETE</b> to the system, and when
<b  >ALT-BACKSPACE</b> is pressed, send a
Meta_<b  >DELETE</b>. To find out the keynumber of any
key, use the <b  >showkey</b> command.
</p><p>To make the <b  >BACKSPACE</b> key conform to the
design decisions, change these lines to read:</p><pre     class="programlisting">
keycode  14 = BackSpace        BackSpace
         alt     keycode  14 = Meta_BackSpace
</pre><p>However, a delete key is also needed, so replace the
following line:
<pre     class="programlisting">
keycode 111 = Remove
</pre>


with these two lines:
<pre     class="programlisting">
keycode 111 = Delete           Delete
        alt             keycode 111 = Meta_Delete
</pre>


Keynumber 111 is the DELETE key on the editing keypad, just below
the INSERT key.
</p><p>Now, to swap Caps_Lock with the left CTRL key, redefine
keycodes 29 and 58 as follows:</p><pre     class="programlisting">
keycode  29 = Caps_Lock    # Left Control key.
keycode  58 = Control      # Caps Lock key.
</pre><p>Configuring the numeric keypad presents a special challenge.
In <b  >us.map</b>, several of the keys transmit the same
escape sequences as an editing key. This makes it impossible, for
example, for a program to distinguish between the PAGE UP key on
the editing keypad and the 9/Pg Up key on the numeric keypad.
Furthermore, the NUM LOCK, /, *, - and + keys do not even transmit
escape sequences.
</p><p>To alleviate these problems, the virtual console's numeric
keypad will be configured somewhat like a VT100 numeric keypad.
Since xterm already emulates a VT102, this will save work by making
the virtual consoles more compatible with xterm. Note that this
technique could cause incompatibilities with software programs that
expect the keys to behave as defined by us.map. If this becomes a
problem, the keys can always be switched back.</p><p>To be able to configure the keys of the numeric keypad
independently, they will have to be changed into function keys.
Since the kernel supports up to 246 function keys, F1 through F246,
this is not a problem. Redefine the following keycodes as
shown:</p><pre     class="programlisting">
keycode  55 = F112    # Numeric keypad *.
keycode  69 = F110    # NumLock.
keycode  71 = F107    # Numeric keypad 7.
keycode  72 = F108    # Numeric keypad 8.
keycode  73 = F109    # Numeric keypad 9.
keycode  74 = F113    # Numeric keypad -.
keycode  75 = F104    # Numeric keypad 4.
keycode  76 = F105    # Numeric keypad 5.
keycode  77 = F106    # Numeric keypad 6.
keycode  78 = F114    # Numeric keypad +.
keycode  79 = F101    # Numeric keypad 1.
keycode  80 = F102    # Numeric keypad 2.
keycode  81 = F103    # Numeric keypad 3.
keycode  82 = F100    # Numeric keypad 0.
keycode  83 = F116    # Numeric keypad ..
keycode  96 = F115    # Numeric keypad Enter.
keycode  98 = F111    # Numeric keypad /.
</pre><p>Furthermore, it is necessary to define the escape sequences
that these keys transmit, so add these lines to the end of the
file:
<pre     class="programlisting">
string F100 = "\\033Op"
string F101 = "\\033Oq"
string F102 = "\\033Or"
string F103 = "\\033Os"
string F104 = "\\033Ot"
string F105 = "\\033Ou"
string F106 = "\\033Ov"
string F107 = "\\033Ow"
string F108 = "\\033Ox"
string F109 = "\\033Oy"
string F110 = "\\033OP"
string F111 = "\\033Oo"
string F112 = "\\033Oj"
string F113 = "\\033Om"
string F114 = "\\033Ok"
string F115 = "\\033OM"
string F116 = "\\033On"
</pre>


<b  >"\\033"</b> is the octal representation of
<b  >ESCAPE</b>. These are the same escape sequences that
will be transmitted by these keys when running xterm, after
following the remaining steps.
</p><p>Although function keys F6 through F12 are compatible with
xterm, F1 through F5 are not. To fix this, add these lines:</p><pre     class="programlisting">
string F1 = "\\033[11~"
string F2 = "\\033[12~"
string F3 = "\\033[13~"
string F4 = "\\033[14~"
string F5 = "\\033[15~"
</pre><p>It is recommended that the following keycodes be defined so
the keysyms (the names following the equals signs) will match the
keycaps. However, this will not change the escape sequences
transmitted, since these keysyms are only synonyms for the original
keysyms:
<pre     class="programlisting">
keycode 102 = Home      # Was Find.
keycode 104 = PageUp    # Was Prior.
keycode 107 = Enc       # Was Select.
keycode 109 = PageDown  # Was Next.
</pre>


One very nice feature is to be able to hold down the
<b  >ALT</b> key while using the arrow keys to pan within
Emacs. Since <b  >ALT</b>-Left and
<b  >ALT</b>-Right were previously used to switch virtual
consoles, those functions will be remapped to
<b  >CTRL</b>-Left and <b  >CTRL</b>-Right.
</p><p>Change these two lines as shown:</p><pre     class="programlisting">
# Ctrl-Left (was Alt)
control keycode 105 = Decr_Console
# Ctrl-Right (was Alt)
control keycode 106 = Incr_Console
</pre><p>And add the following lines:
<pre     class="programlisting">
alt     keycode 103 = F117   # Left Alt-Up Arrow
altgr   keycode 103 = F117   # Right Alt-Up Arrow
alt     keycode 105 = F120   # Left Alt-Left Arrow
altgr   keycode 105 = F120   # Right Alt-Left Arrow
alt     keycode 106 = F119   # Left Alt-Right Arrow
altgr   keycode 106 = F119   # Right Alt-Right Arrow
alt     keycode 108 = F118   # Left Alt-Down Arrow
altgr   keycode 108 = F118   # Right Alt-Down Arrow
string F117 = "\\033\\033[A"   # Alt-Up Arrow
string F118 = "\\033\\033[B"   # Alt-Down Arrow
string F119 = "\\033\\033[C"   # Alt-Right Arrow
string F120 = "\\033\\033[D"   # Alt-Left Arrow
</pre>


Note <b  >ALT</b>-arrow transmits an
<b  >ESCAPE</b> followed by the normal escape sequence
for the arrow key.
</p><p>Of course, <b  >CTRL-ALT-DELETE</b> will reboot
Linux, but what if the user is finished for the day and wants a
quick shutdown? To make <b  >CTRL-ALT-H-END</b> shut down
Linux, add the following lines:</p><pre     class="programlisting">
# Numeric keypad End
control alt     keycode  79 = KeyboardSignal
control altgr   keycode  79 = KeyboardSignal
# Editing keypad End
control alt     keycode  107 = KeyboardSignal
control altgr   keycode  107 = KeyboardSignal
</pre><p>Then save the file, and edit <b  >/etc/inittab</b>.
Add or edit the following lines as shown:
<pre     class="programlisting">
# Action on special keypress (CTRL-ALT-END).
kb::kbrequest:/sbin/shutdown -h now
</pre>


Save the file, and everything is ready to be tested. Type:
<pre     class="programlisting">
# loadkeys custom.map
</pre>


and try the new keys. <b  >DELETE</b> should act as
<b  >BACKSPACE</b> did before. Caps Lock has been
switched with the left <b  >CTRL</b> key. Exit all
programs, then try <b  >CTRL-ALT-END</b>. After shutdown,
use the hardware reset button to reboot.
</p><p>If the keyboard passed these basic tests, us.map can be
replaced with custom.map. Regular users may encounter errors when
running loadkeys, because it requires read access to /dev/console.
Furthermore, different users using different maps could cause
confusion. Therefore, it is suggested the new keymap be permanently
installed on the system by root.</p><p>Warning: If these installation instructions are not followed
correctly, it is possible to place the keyboard in an unusable
state, forcing the user to reboot from the installation floppies.
Please take any necessary precautions before proceeding.</p><p>To install custom.map permanently, edit /etc/init.d/boot, or
whichever boot script contains the loadkeys command, and add the
following line to the top of the file:</p><pre     class="programlisting">
custom_keys=/usr/lib/kbd/keytables/custom.map
</pre><p>Then replace the <b  >loadkeys</b> command with:
<pre     class="programlisting">
if [ -f $custom_keys ]  # If custom keys exist,
then                            # then load them.
  loadkeys $custom_keys
else                            # Else use the regular keys.
  loadkeys /usr/lib/kbd/keytables/us.map
fi
</pre>


This way, if <b  >custom.map</b> somehow gets deleted,
the keyboard will still work. Run this script to make sure it is
correct. If it works, the new keymap will be automatically
activated at the next system boot.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x2b522b0"></a>X Window System</h2></div></div><p>Now start X as root. Change the directory to /etc/X11 and
look at the file Xmodmap. Most likely, this file is empty, except
for some comments. If not, rename it to Xmodmap.old, exit the
window manager and restart X.</p><p>Starting with an empty Xmodmap is important, because when X
comes up, it creates its keyboard modifier map and keymap table
based on the kernel's current keyboard translation tables, which
were just reconfigured. X then reads the Xmodmap file, which
overrides the kernel. This could destroy some of the benefits of
the work just completed on the kernel.</p><p>Since the kernel has already been reconfigured, the work of
configuring X will be reduced by the work already done in creating
custom.map. Specifically, <b  >DELETE</b> and
<b  >BACKSPACE</b> will still transmit
<b  >DELETE</b> and <b  >BACKSPACE</b>, because
X got that information from the kernel.</p><p>Now enter the following command to replace Xmodmap with the
current keymap table:</p><pre     class="programlisting">
# xmodmap -pke &gt; /etc/X11/Xmodmap
</pre><p>Edit Xmodmap. It appears similar to the file custom.map, but
do not be misled. The keycodes are different. To find the keycode
number for a given key, run <b  >xev</b> from an xterm,
put the mouse cursor inside the <b  >xev</b> window, and
press the key. Look for the key's &ldquo;keycode&rdquo; in the output. For
more information, see <b  >xev(1)</b> and
<b  >xmodmap(1)</b>.
</p><p>Finally, to switch the Caps Lock and the left
<b  >CTRL</b> key, add these lines to the end of the
file:</p><pre     class="programlisting">
! Recreate the Lock and Control modifier maps.
clear Lock
clear Control
add Lock = Caps_Lock
add Control = Control_L Control_R
</pre><p>To be able to configure keys on the numeric keypad, they must
be given an appropriate <span   class="emphasis"><em>keysym</em></span> following the
equals sign. Therefore, change the following lines as shown:
<pre     class="programlisting">
keycode  63 = KP_Multiply
keycode  77 = KP_F1
keycode  79 = KP_7
keycode  80 = KP_8
keycode  81 = KP_9
keycode  82 = KP_Subtract
keycode  83 = KP_4
keycode  84 = KP_5
keycode  85 = KP_6
keycode  86 = KP_Add
keycode  87 = KP_1
keycode  88 = KP_2
keycode  89 = KP_3
keycode  90 = KP_0
keycode  91 = KP_Decimal
keycode 108 = KP_Enter
keycode 112 = KP_Divide
</pre>


Keycodes 99 and 105 are assigned to the keysyms Prior and Next,
respectively. Just as was done in custom.map, change them to the
following keysyms, which are functionally equivalent, but match the
keycaps:
<pre     class="programlisting">
keycode  99 = Page_Up
keycode 105 = Page_Down
</pre>


Now save the file, then type:
<pre     class="programlisting">
# xmodmap /etc/X11/Xmodmap
</pre>


to activate the new definitions. If your keyboard will not work at
all, use <b  >CTRL-ALT-BACKSPACE</b> to exit X. Then use
a virtual console to fix the problem.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x2b52b48"></a>Xterm</h2></div></div><p>The xterm program receives keysyms from X and converts them
into characters and into escape sequences. Since xterm emulates a
VT102 terminal, it requires little configuration work.</p><p>Edit the /etc/X11/Xresources file, and add the following
line:</p><pre     class="programlisting">
XTerm*ttyModes: erase ^H
</pre><p>This automatically makes <b  >BACKSPACE</b>
(<b  >CTRL-H</b>) delete characters to the left of the
cursor. It is the same as if the user typed:
<pre     class="programlisting">
$ stty erase ^H
</pre>


every time an xterm was started. Also add this line:
<pre     class="programlisting">
XTerm*appkeypadDefault: true
</pre>


This will cause the keys of the numeric keypad to transmit their
escape sequences instead of numbers, operators, etc. It is the same
as if the user pressed <b  >CTRL</b>--MiddleButton and
selected &ldquo;Enable Application Keypad&rdquo; in every xterm window.
</p><p>Unfortunately, Emacs normally resets the numeric keypad when
it exits, so the keys no longer transmit escape sequences. To
correct this behavior, the &ldquo;rmkx&rdquo; capability must be removed from
the terminfo(5) database:</p><pre     class="programlisting">
# cd /etc/terminfo/x
# infocmp xterm &gt; xterm.txt
# emacs xterm.txt
</pre><p>Remove the &ldquo;rmkx&rdquo; entry, save the file, and exit. Then:
<pre     class="programlisting">
# tic xterm.txt
# rm xterm.txt
</pre>


It is also necessary to tell xterm what the ALT-Arrow keys
transmit, and what the <b  >HOME</b> and
<b  >END</b> editing keys transmit. (The default escape
sequences that xterm uses for <b  >HOME</b> and
<b  >END</b> are unconventional.) Type the first seven
lines below. Then cut and paste the remaining lines from the
xterm(1) man page, underneath the heading, &ldquo;The default bindings
in the VT102 window are.&rdquo;
<pre     class="programlisting">
XTerm*VT100*translations:\\
Alt &lt;KeyPress&gt; Up:string(0x1b) string(0x1b) string("OA")
Alt &lt;KeyPress&gt; Down:string(0x1b) string(0x1b) string("OB") \\n\\
Alt &lt;KeyPress&gt; Right:string(0x1b) string(0x1b) string("OC") \\n\\
Alt &lt;KeyPress&gt; Left:string(0x1b) string(0x1b) string("OD") \\n\\
&lt;KeyPress&gt; Home:string(0x1b) string("[1~") \\n\\
&lt;KeyPress&gt; End:string(0x1b) string("[4~") \\n\\
Shift &lt;KeyPress&gt; \
        Prior:scroll-back(1,halfpage) \\n\\
Shift &lt;KeyPress&gt; \
        Next:scroll-forw(1,halfpage) \\n\\
Shift &lt;KeyPress&gt; \
        Select:select-cursor-start() \\n\\
Shift &lt;KeyPress&gt; select-cursor-end(PRIMARY, \
        CUT_BUFFER0) \\n\\
Shift &lt;KeyPress&gt; Insert:insert-selection(PRIMARY,\
        CUT_BUFFER0) \\n\\
~Meta&lt;KeyPress&gt;:insert-seven-bit() \\n\\
Meta&lt;KeyPress&gt;:insert-eight-bit() \\n\\
!Ctrl &lt;Btn1Down&gt;:popup-menu(mainMenu) \\n\\
!Lock Ctrl &lt;Btn1Down&gt;:popup-menu(mainMenu) \\n\\
!Mod2 Ctrl &lt;Btn1Down&gt;:popup-menu(mainMenu) \\n\\
!Mod2 Lock Ctrl \
        &lt;Btn1Down&gt;:popup-menu(mainMenu) \\n\\
~Meta &lt;Btn1Down&gt;:select-start() \\n\\
~Meta &lt;Btn1Motion&gt;:select-extend() \\n\\
!Ctrl &lt;Btn2Down&gt;:popup-menu(vtMenu) \\n\\
!Lock Ctrl &lt;Btn2Down&gt;:popup-menu(vtMenu) \\n\\
!Mod2 Ctrl &lt;Btn2Down&gt;:popup-menu(vtMenu) \\n\\
!Mod2 Lock Ctrl \
        &lt;Btn2Down&gt;:popup-menu(vtMenu) \\n\\
~Ctrl ~Meta &lt;Btn2Down&gt;:ignore() \\n\\
~Ctrl ~Meta &lt;Btn2Up&gt;:insert-selection(PRIMARY, CUT_BUFFER0) \\n\\
!Ctrl &lt;Btn3Down&gt;:popup-menu(fontMenu) \\n\\
!Lock Ctrl &lt;Btn3Down&gt;:popup-menu(fontMenu) \\n\\
!Mod2 Ctrl &lt;Btn3Down&gt;:popup-menu(fontMenu) \\n\\
!Mod2 Lock Ctrl \
        &lt;Btn3Down&gt;:popup-menu(fontMenu) \\n\\
~Ctrl ~Meta &lt;Btn3Down&gt;:start-extend() \\n\\
~Meta &lt;Btn3Motion&gt;:select-extend() \\n\\
&lt;BtnUp&gt;&gt;&gt;&gt;&gt;&gt;&gt;&gt;:select-end(PRIMARY, CUT_BUFFER0) \\n\\
&lt;BtnDown&gt;:bell(0)
</pre>


Make sure each line ends exactly as shown, and there is not even a
blank space after the last backslash on each line. Then change
&ldquo;Prior&rdquo; to &ldquo;Page_Up,&rdquo; change &ldquo;Next&rdquo; to &ldquo;Page_Down,&rdquo; and
change &ldquo;Select&rdquo; to &ldquo;End&rdquo; to match the keycaps.
</p><p><b  >ALT</b>-Arrow transmits an
<b  >ESCAPE</b> (0x1b in hexadecimal) followed by the
escape sequence for the arrow key, but
<b  >ALT</b>-&lt;Keypress&gt; sets the eighth bit of that
key (examine the line that begins with &ldquo;Meta&lt;KeyPress&gt;&rdquo;).
Also, the escape sequences for the ALT-arrow keys are not the same
as were used in custom.map. For a full explanation of this file's
format, see the <span   class="bold"><b>RESOURCES</b></span> heading
under X(1). Save the file. Type:</p><pre     class="programlisting">
# xrdb /etc/X11/Xresources
</pre><p>to activate the definitions. The BACKSPACE key should now
work properly the next time an xterm is started.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x2b53490"></a>Bash</h2></div></div><p>Create a new file, /etc/inputrc for system-wide use or
~/.inputrc for personal use. This will be a readline startup file
(see bash(1)).</p><p>First, make the <b  >DELETE</b> key delete
characters under the cursor, and make <b  >HOME</b> and
<b  >END</b> work by adding:</p><pre     class="programlisting">
DEL: delete-char
# Home.
"\\e[1~": beginning-of-line
# End.
"\\e[4~": end-of-line"
</pre><p><b  >DEL</b> is a special symbol
<b  >bash</b> understands to be
<b  >DELETE</b>. For the <b  >HOME</b> and
<b  >END</b> keys, their escape sequences are given in
quotation marks, followed by a colon, and then the command.
</p><p>To determine the escape sequence transmitted by a key, look
it up in custom.map. Alternately, bring up Emacs, then type
<b  >CTRL-Q</b> followed by the key. That will usually
insert the escape sequence into the buffer. The ESCAPE character
will appear as <b  >^[</b>, i.e., control-left
bracket.</p><p>The readline commands shown thus far are taken from the bash
man page. If you would like to program a key to enter a regular
command when pressed, put the command in quotation marks. For
example, to make the 1 key on the numeric keypad list the current
directory, add these lines:</p><pre     class="programlisting">
# KP_1
"\\eOq": "ls\\C-m"
</pre><p>The <b  >\\C-m</b> is a <b  >CTRL-M</b>,
or a carriage return, which, as we know, is necessary to execute
the command.
</p><p>Other keys may be programmed as desired. Save the
file.</p><p>If a system-wide /etc/inputrc file was created, add the
following line to /etc/profile:</p><pre     class="programlisting">
export INPUTRC=/etc/inputrc
</pre><p>Then type:
<pre     class="programlisting">
# . /etc/profile
</pre>


This will override the default initialization file, ~/.inputrc.
</p><p>Regardless of where the file was created, it may now be
activated by typing <b  >CTRL-XCTRL-R</b>, which is
normally bound to the readline command
&ldquo;re-read-init-file.&rdquo;</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x30e2dc8"></a>Less</h2></div></div><p>Create a new file, /etc/lesskey, for system-wide use. This
will be a lesskey(1) input file. Type these lines exactly as shown
and then save the file:</p><pre     class="programlisting">
#line-edit
\\177    delete
^H      backspace
\\e[1~   home
\\e[4~   end
</pre><p>The control line, <b  >#line-edit</b>, introduces
bindings for line-editing commands. <b  >\\177</b> is the
octal representation of <b  >DELETE</b>, and
<b  >^H</b> represents <b  >CTRL-H</b>, which
is a <b  >BACKSPACE</b>. The escape sequences are those
transmitted by the <b  >HOME</b> and
<b  >END</b> keys.
</p><p>Compile the file as follows:</p><pre     class="programlisting">
# lesskey -o /etc/less /etc/lesskey
</pre><p>Add the following line to /etc/profile:
<pre     class="programlisting">
export LESS="-k/etc/less$"
</pre>


Then type:
<pre     class="programlisting">
# . /etc/profile
</pre>


The next time less is executed, it will read the key definitions
from /etc/less. When entering a command line at the bottom of the
screen (for example, the pattern for a search command), these key
definitions will be active.
</p><p>If a user wants to add personal key definitions to less, they
may be placed in a file, say ~/lesskey, then compiled as
follows:</p><pre     class="programlisting">
# lesskey -o ~/.less ~/lesskey
</pre><p>These personal key definitions will be activated in addition
to those defined system-wide.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x30e3500"></a>Netscape and Minicom</h2></div></div><p>Since Netscape is from the DOS/Windows world, it requires no
special configuration. The designers made
<b  >BACKSPACE</b>, <b  >DELETE</b>,
<b  >HOME</b>, <b  >END</b>, <b  >PAGE
UP</b> and <b  >PAGE DOWN</b> work just as
expected. It simply shows that somebody did a good job, and it
lends credibility to this design.</p><p>If minicom is used, then as root, enter the command:</p><pre     class="programlisting">
# minicom -s
</pre><p>This will activate the configuration menu for minicom. Select
&ldquo;Screen and keyboard&rdquo; from the menu. Type &ldquo;A,&rdquo; then press the
space bar. Use &ldquo;B&rdquo; to determine what <b  >BACKSPACE</b>
should transmit. Since most remote systems will use
<b  >DELETE</b> to delete to the left, &ldquo;DEL&rdquo; is
probably the best choice here. If this creates a problem, change it
to BS. Press <b  >ESC</b> when done.
</p><p>Back at the configuration menu, select &ldquo;Save setup as dfl,&rdquo;
then &ldquo;Exit from Minicom.&rdquo;</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x30e3a80"></a>Emacs</h2></div></div><p>Emacs can be executed in at least three different
environments: in a virtual console, in an xterm, or in an X11
window manager. To run Emacs within an xterm, the
<b  >-nw</b> option must be used. Regardless of the
environment, the keys will be made to perform identical
functions.</p><p>Emacs contains a series of many keymaps that translate input
events into other input events and eventually into commands. Three
of these keymaps are diagrammed in Figure 1. The ellipses indicate
the omission of keymaps beyond the scope of this article.</p><p>As root, change directory to /usr/lib/emacs/XX.XX/lisp/term,
where XX.XX is the version of Emacs installed. This directory
contains initialization files for several types of terminals. Read
the README file for more information.</p><p>Make a backup of xterm.el, then edit this file to look like
<a href="0138l1.html" target="_self">Listing 1</a> This file maps the
escape sequences sent by the keys onto Emacs vectors of length 1. A
vector is a general-purpose Emacs array, and vector values are
enclosed in brackets, e.g.,.</p><p>When Emacs is executed in an xterm or a virtual console, it
reads this file. The function-key-map is then configured such that
when any of these keys are pressed, Emacs automatically translates
the escape sequences into vectors. This makes it easier to
configure Emacs, not only because all of the keys can be referred
to by their names, but also because the programmer never needs to
remember the escape sequences after this file has been created.
Furthermore, these vectors have the same names as the X Window
keysyms, thereby providing consistency among all three execution
environments.</p><p>The <b  >PAGE UP/DOWN</b> keys are now referred to
as prior and next. These definitions provide support for some of
the Emacs commands, such as calendar, which expect these keys to be
available. Also, even though /etc/X11/Xmodmap defines these keys to
transmit the Page_Up and Page_Down keysyms, Emacs sees them as
prior and next when running under X.</p><p>Two sets of definitions are listed for the arrow keys, Reset
or Normal and Set or Application. This is because the VT100 series
of terminals has two modes of operation in which keys transmit
different escape sequences. Notice that in
/usr/lib/kbd/keytables/custom.map, <b  >ALT-UP ARROW</b>
17) transmits <b  >\\e\\e[A</b>, but in
/etc/X11/Xresources, <b  >ALT-UP ARROW</b> transmits
<b  >\\e\\eOA</b>. In both cases, these are an
<b  >ESCAPE</b> followed by the escape sequence
transmitted by the <b  >UP ARROW</b> key. One method of
dealing with this problem is simply to define both sets of escape
sequences, as is shown here.</p><p>The configuration file, xterm.el, needs be compiled for
increased performance, as well as to overwrite the previously
compiled version. After saving the file, enter the following
command:</p><pre     class="programlisting">
# emacs -batch -f batch-byte-compile xterm.el
</pre><p>Since this file is also designed for the virtual consoles,
make links as follows:
<pre     class="programlisting">
# ln -s xterm.el con80x25.el
# ln -s xterm.elc con80x25.elc
trl
</pre>


The .elc files, which are compiled, are the ones used by Emacs.
</p><p>For running Emacs directly under X, some changes need to be
made to x-win.el. Please make a backup copy, then find and change
the following lines as shown:</p><pre     class="programlisting">
(define-key function-key-map [backspace] [?\\b])
(define-key function-key-map [M-backspace] [?\\M-\\b])
(put 'backspace 'ascii-character 8)
</pre><p>Save the file. Compile it with:
<pre     class="programlisting">
# emacs -batch -f batch-byte-compile x-win.el
</pre>


Emacs does not need to know about escape sequences when running
directly under an X11 window manager, because it receives the
keysyms directly and converts them into vectors automatically.
However, since the design states that the
<b  >BACKSPACE</b> key transmits a
<b  >BACKSPACE</b>, not a <b  >DELETE</b>,
three lines had to be changed to make x-win.el comply. Note that
M-backspace is short for Meta-backspace, which is a synonym for
<b  >ALT</b>-backspace.
</p><p>Now it is finally time for the last step, assigning functions
to the Emacs keys. Change the directory to
/usr/lib/emacs/site-lisp, which is where local Emacs Lisp programs
are stored.</p><p>Create a file named &ldquo;ibmkey.el&rdquo; to define the key bindings
for an IBM PC-compatible keyboard. Enter as much of
<a href="0138l2.html" target="_self">Listing 2</a>, ibmkey.el, as
desired.</p><p>The default Emacs key-translation-map is defined in
/usr/lib/emacs/XX.XX/lisp/loaddefs.el. This file is included in the
emacs-el (GNU Emacs LISP files) package of the Debian distribution.
It normally maps the F1 key and the <b  >HELP</b> key (if
present) to <b  >BACKSPACE</b>, because
<b  >BACKSPACE</b> (<b  >CTRL-H</b>) is
normally mapped to the Emacs help-command in the global-map. Refer
to Figure 1.</p><p>However, to accommodate the design presented here, the
key-translation-map will be redefined. Since Emacs is based on the
assumption that <b  >DELETE</b> is to be used to delete
characters to the left of the cursor, and since the design
presented here assumes that the <b  >BACKSPACE</b> key
will perform that function, the key-translation-map will be used to
switch the <b  >BACKSPACE</b> and the
<b  >DELETE</b> keys. After this is done, pressing the
<b  >BACKSPACE</b> key will cause a
<b  >DELETE</b> to come out of the key-translation-map,
and pressing <b  >DELETE</b> will cause a
<b  >BACKSPACE</b> to come out.</p><p>To reduce confusion, the variable &ldquo;BACKSPACE&rdquo; is defined to
hold a <b  >DELETE</b>, and the variable &ldquo;DELETE&rdquo; is
defined to hold a <b  >BACKSPACE</b>. This way, when
<b  >BACKSPACE</b> is pressed, the value of the variable
&ldquo;BACKSPACE&rdquo; will come out of the key-translation-map, and when
<b  >DELETE</b> is pressed, the value of the variable
&ldquo;DELETE&rdquo; will come out, thus eliminating the confusion caused by
the switch.</p><p>Many function keys are defined as examples, using the
global-map. Since <b  >BACKSPACE</b> is no longer
available for help, F1 is now mapped directly to that function,
without the use of the key-translation-map. F4 is mapped to Undo.
The <b  >BACKSPACE</b> key and the editing keys are
defined to perform their labeled functions, except for prior and
next, which are already defined by Emacs (see loaddefs.el). While
holding down ALT, the arrow keys will pan the text in all four
directions. Finally, the keys of the numeric keypad are defined to
perform various functions.</p><p>There are several sources of information for programming
Emacs. Press F1 twice to access the extensive online help facility.
Also, the <span   class="emphasis"><em>GNU Emacs Lisp Reference Manual</em></span>
(800+ pages) is available at
ftp://prep.ai.mit.edu/pub/gnu/elisp-manual-19-2.4.tar.gz for the
truly serious Emacs Lisp programmer. This manual can also be
ordered from the Free Software Foundation. The order forms are
located in /usr/lib/emacs/XX.XX/etc/ORDERS*.</p><p>Now save, and then compile ibmkey.el:</p><pre     class="programlisting">
# emacs -batch -f batch-byte-compile ibmkey.el
</pre><p>Finally, edit /usr/lib/emacs/site-lisp/site-start.el, and add
this line:
<pre     class="programlisting">
(load "ibmkey")
</pre>


This file will automatically load ibmkey.el (or ibmkey.elc, if
ibmkey.el was compiled) when Emacs is started by anyone on the
system. If personal key mappings are desired, place them in
~/.emacs.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2a61580.0x30e7528"></a>Summary</h2></div></div><p>The techniques for configuring and programming the keyboard
for the Linux kernel, the X Window System, xterm, bash, less,
Netscape, minicom and Emacs have been presented.
<a href="0138t1.html" target="_self">Table 1. Configuration Files and
Commands</a> summarizes the configuration files and
commands.</p><p>After following these instructions, the keyboard should be
configured to act more like the keyboard the typical user is
accustomed to. The editing keys will perform as labeled. The Caps
Lock and left <b  >CTRL</b> keys will be switched.
Various other keys will perform useful functions. Furthermore, the
basic techniques discussed here can be applied to other computer
programs which permit configuration of the keyboard.</p></div></div>
<div class="authorblurb"><p>John Bunch, bunch@ro.com, is a member of
      University Baptist Church in Huntsville, Alabama, where he sings in
      the choir. To pay his bills and those of his church, he works as a
      Software Consultant for Intergraph Corporation. He holds a B.S. in
      computer science from the University of Tennessee, Knoxville, and a
      M.S. in computer science from East Tennessee State University,
      Johnson City.</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../038/toc038.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>