<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Raspberry Pi: the Perfect Home Server
</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;Exploit the Raspberry Pi's unique low-power and energy-efficient architecture to build a full-featured home&#10;backup, multimedia and print server.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x26a5580.0x279cac0"></a>
Raspberry Pi: the Perfect Home Server
</h1></div><div><div class="author"><h3 class="author">
Brian
 
Trapp
</h3></div><div class="issuemoyr">Issue #229, May 2013</div></div><div><p>
Exploit the Raspberry Pi's unique low-power and energy-efficient architecture to build a full-featured home
backup, multimedia and print server.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x279d1f8"></a></h2></div></div><p>
Ever since the announcement of the Raspberry Pi, sites all across the
Internet have offered lots of interesting and challenging uses for this
exciting device. Although all of those ideas are great, the most obvious
and perhaps least glamorous use for the Raspberry Pi (RPi) is creating
your perfect home server.
</p><p>
If you've got several different computers in need of a consistent and
automated backup strategy, the RPi can do that. If you have music and
video you'd like to be able to access from almost any screen in the house,
the RPi can make that happen too. Maybe you have a printer or two you'd
like to share with everyone easily? The Raspberry Pi can fill all those
needs with a minimal investment in hardware and time.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x279d3b0"></a>
Raspberry Pi Benefits</h2></div></div><p>
<span   class="emphasis"><em>Low cost:</em></span> for $35, the RPi model B is nearly a complete computer
with 512MB of RAM, 100Mb Ethernet, an SD card slot, two USB ports, audio out and
HDMI or RCA video out. I've seen HDMI cables that cost more than that.
</p><p>
<span   class="emphasis"><em>Energy efficient:</em></span> hardware costs are only one
component of a server's
expense, because you also need to consider the energy cost to keep the
device running constantly. The services needed for home use aren't
going to tax the CPU much, and most of the time it will just be idling,
waiting for something to do. The RPi's ultra-low power components are
a perfect fit for this workload, which helps keep your power bill down.
My model B unit plus external hard drive consume only 8 watts total,
while the old Athlon-based box it replaced drew 54 watts at idle.
Assuming 10 cents per kilowatt hour, that puts the yearly power bill for
an RPi at $7 vs. $47 for an Athlon-based machine. The RPi basically pays
for itself in less than a year!
</p><p>
<span   class="emphasis"><em>Low noise:</em></span> because the RPi doesn't have fans or moving parts, the
only component in your final configuration that generates noise or any
appreciable heat will be the hard disk. If you're concerned about noise,
enthusiast sites like Silent PC Review (<a href="http://www.silentpcreview.com" target="_self">www.silentpcreview.com</a>)
often include noise benchmarks in their storage reviews. My experience is
that any modern drive is quiet enough to avoid detection anywhere there's
something else already running (such as a media center, gaming console
or other computer). If your home doesn't provide a lot of flexibility
for wiring options, the RPi's small size, minimal thermal output and
low-noise footprint may make it possible to sneak in a server where it
was difficult to justify one in the past.
</p><div       class="mediaobject"><a href="11454f1.large.jpg"><img src="11454f1.jpg"></a><div class="caption"><p>
Figure 1. A Compact, but Highly Capable Home Server
</p></div></div><p>
<span   class="emphasis"><em>New opportunities:</em></span> a less tangible benefit is the simple joy of trying
something new! For me, this was my first time really working on a
Debian-based distribution, and it's probably the first time many Linux
enthusiasts will have a chance to try an ARM-based architecture.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x279d930"></a>
Arranging the Hardware</h2></div></div><p>
For a home server, you'll need a medium-size SD Flash card for local
storage. It's possible to use a USB thumbdrive for booting, but that
would use up one of the two precious USB slots. The Flash storage card
doesn't need to be large, but the faster the better. I chose a name-brand
SD card with an 8GB capacity and class 10 speed rating. For backups and
multimedia files, a large hard drive with a USB dock is a must. I chose a
1.5TB hard drive and a Calvary EN-CAHDD-D 2-bay USB 2.0 hard drive dock.
This dock has a feature to run two drives in RAID-0 mode, which could
be useful someday. Finally, the RPi doesn't come with a power supply,
but most smartphone chargers supply the required 5v-over-micro USB.
To see if the RPi was fussy about the power source, I swapped through
three different micro-USB cell-phone chargers for power supplies.
I tried each one for about a week, with no issues on any of the units.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x279da38"></a>
Installing the Operating System</h2></div></div><p>
Installing the RPi operating system is covered in extensive detail
elsewhere, but here are a few home-server-specific tips, roughly in the
order needed.
</p><p>
1) Get the Raspbian &ldquo;Wheezy&rdquo; install image directly from
<a href="http://www.raspberrypi.org/downloads" target="_self">www.raspberrypi.org/downloads</a>, and copy it onto the SD card,
using the steps listed on the site. 
</p><p>
2) When booting the RPi for the first time, attach a keyboard, mouse
and monitor. Don't forget to turn on the monitor before booting the
RPi, so that it can detect the correct HDMI or composite output port.
</p><p>
3) The RPi has a nice &ldquo;raspi-config&rdquo; screen that you'll see on
first boot. For a home server, the following selections will be useful:
</p><div class="itemizedlist"><ul type="disc"><li><p>
expand_rootfs: resizes the default 2GB OS image to fill the rest of the Flash card.
</p></li><li><p>
change_pass: the default password is &ldquo;raspberry&rdquo;, but something more
secure than that would be better.
</p></li><li><p>
Set your locale and timezone.
</p></li><li><p>
memory_split: assign the minimum amount possible (16) to the GPU to leave as much room as possible for services.
</p></li><li><p>
SSH: don't forget to enable the SSH server.
</p></li><li><p>
boot_behaviour: turn off boot to desktop (again, to save memory for your services).
</p></li></ul></div><p>
When finished, you'll be at the <tt  >pi@raspberrypi</tt> prompt. The setup
script can be re-run at any time via <tt  >sudo raspi-config</tt>.
</p><p>
There are just a few more configuration items, and then the operating system is ready
to go.
</p><p>
1) A static IP makes everything easier, so switch the network settings for eth0:

<pre     class="programlisting">
&gt;&gt; sudo nano -w /etc/network/interfaces
</pre>
</p><p>
change the eth0 line <tt  >iface eth0 inet dhcp</tt> to the following
(modify to meet your home network setup):

<pre     class="programlisting">
======/etc/network/interfaces======
...
iface eth0 inet static
address 192.168.1.10
netmask 255.255.255.0
gateway 192.168.1.1
...
======/etc/network/interfaces======
</pre>
</p><p>
2) Create a local user, and put it in the users and sudo group:

<pre     class="programlisting">
&gt;&gt; sudo adduser YOURUSERIDHERE
&gt;&gt; sudo usermod -a -G users YOURUSERIDHERE
&gt;&gt; sudo usermod -a -G sudo YOURUSERIDHERE
</pre>
</p><p>
3) Update the system to ensure that it has the latest and greatest copies of all the
libraries:

<pre     class="programlisting">
&gt;&gt; sudo apt-get update; sudo apt-get upgrade
</pre>
</p><p>
4) At this point, you're ready to go headless! Shut down the PI:

<pre     class="programlisting">
&gt;&gt; sudo /sbin/shutdown -h now
</pre>
</p><p>
Once it's down (monitor the green status LEDs on the RPi circuit board
to know when it has finished shutting down), unplug the monitor, keyboard,
mouse and power cord. Attach the USB storage, then restart the RPi by
plugging the power back in.
</p><p>
5) Once the RPi starts up (again, those green LEDs are the clue to its
state), you can <tt  >ssh</tt> in to the RPi from any other machine on the network
and finish all the configuration remotely from here on out (modify the following for
your static IP):

<pre     class="programlisting">
&gt;&gt; ssh YOURUSERIDHERE@192.168.1.10 
</pre>
</p><p>
Congratulations, you have a working Raspberry Pi! 
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x279e900"></a>
Peripherals</h2></div></div><p>
The first order of business is to get the external storage device mounted.
Use <tt  >dmesg</tt> to look for where the storage device was
found&mdash;it
almost certainly will be /dev/sda. I like using automounter to handle
mounting removable storage devices, as it is more flexible about handing
devices that may not be present or ready at boot time:

<pre     class="programlisting">
&gt;&gt; sudo apt-get install autofs
&gt;&gt; sudo nano -w /etc/auto.master 
======/etc/auto.master======
...
/misc /etc/auto.misc
...
======/etc/auto.master======

&gt;&gt; sudo nano -w /etc/auto.misc
</pre>
</p><p>
Note, my external storage device is formatted with ext4&mdash;modify this for your
needs if required:

<pre     class="programlisting">
======/etc/auto.misc======
...
storage         -fstype=ext4            :/dev/sda1
...
======/etc/auto.misc======
&gt;&gt; sudo /etc/init.d/autofs restart 
&gt;&gt; ls -lat /misc/storage 
</pre>
</p><p>
Optionally, create a symlink to shorten the path a smidgen:

<pre     class="programlisting">
&gt;&gt; ln -s /misc/storage /storage
</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x279ec18"></a>
Backup Repository</h2></div></div><p>
At the top of any home server feature list is providing rock-solid
backups. With the RPi, this is pretty simple, due to the wide range of
network-sharing options in Linux: Samba/CIFS for Windows machines, NFS
for UNIX-based devices and even SFTP for more advanced backup clients
like deja-dup.	Because the RPi has only 100Mb Ethernet, and the storage
device is on USB, it's not going to have super-fast transfer speeds.
On the other hand, good backup clients run automatically and in the
background, so it's unlikely that you'll notice the slightly slower
transfer speeds.
</p><p>
My home network includes one Windows 7 machine. For it, I exported a
backup directory on the RPi's external USB storage device via Samba.
Because the backup utility in the basic version of Windows 7 doesn't
support network drives as a backup destination, I used SyncBack Free
(<a href="http://www.2brightsparks.com/freeware/freeware-hub.html" target="_self">www.2brightsparks.com/freeware/freeware-hub.html</a>) to set up
automated, daily backups.
</p><p>
Configuring Samba is simple.
</p><p>
1) Install the samba and common-bin library (which has the smbpasswd utility):

<pre     class="programlisting">
&gt;&gt; sudo apt-get install samba samba-common-bin
</pre>
</p><p>
2) Use <tt  >smbpasswd</tt> to let your local ID have access:

<pre     class="programlisting">
&gt;&gt; sudo smbpasswd -a YOURUSERIDHERE
</pre>
</p><p>
3) Edit the samba configuration file:

<pre     class="programlisting">
&gt;&gt; sudo nano -w /etc/samba/smb.conf
</pre>
</p><p>
4) Change the <tt  >workgroup = WORKGROUP</tt> line to match your Windows
workgroup name.
</p><p>
5) Comment out or delete the [homes] and [printers] share. (Printer sharing will be
done later via direct CUPS access.)
</p><p>
6) Add an entry for the Windows backup paths. Here's my example, which I placed at the bottom of the file:

<pre     class="programlisting">
======/etc/samba/smb.conf======
...
[win7pc] 
comment=Backup for windows PC
path=/storage/win7pc 
writeable=Yes 
create mask=0777 
directory mask=0777 
browsable=Yes 
public=Yes 
valid users=YOURUSERIDHERE
...
======/etc/samba/smb.conf======
</pre>
</p><p>
7) Restart Samba to implement your edits:

<pre     class="programlisting">
&gt;&gt; sudo /etc/init.d/samba restart
</pre>
</p><p>
8) Test connectivity from the Windows machine by mapping a network drive from the file explorer.
</p><p>
For Linux devices, deja-dup is brilliantly simple
to set up and use.
It's been installed by default on both my Fedora 18 and Ubuntu 12.10
installs. While the package name is &ldquo;deja-dup&rdquo;, the front end is
simply called &ldquo;Backup&rdquo;. Although the RPi easily could support NFS
export, I've found that using deja-dup's SSH option is easier and more
portable, and it eliminates the need for an additional service on the
RPi. Specifying a deja-dup encryption password is probably a good idea,
unless you like the idea of all your files walking off if someone pockets
the storage drive:


<pre     class="programlisting">
&gt;&gt; sudo mkdir /storage/linuxlaptop
&gt;&gt; sudo chown -R YOURUSERIDHERE:YOURUSERIDHERE /storage/linuxlaptop
</pre>
</p><p>
From the client Linux machine, launch the backup utility, choose &ldquo;SSH&rdquo;
as the backup location, and enter the RPi's IP address and the storage
location you just created. The first backup will be slow, but future
runs will be sending only incremental changes, which is significantly faster.
</p><div       class="mediaobject"><a href="11454f2.large.jpg"><img src="11454f2.jpg"></a><div class="caption"><p>
Figure 2. Deja-dup Client Setup
</p></div></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x2b97a18"></a>
Multimedia Server: DLNA</h2></div></div><p>
Now that everyone's files are backed up safely, let's move on to some
fun! A DLNA server will give you a central place to store your movies,
music and pictures. From this central repository, DLNA clients from
every screen in the house can play back this content with ease.
</p><p>
At least, that's the promise. The reality is that the DNLA specs don't
quite nail down many important things like which formats or encodings
are supported. Each client typically has a slightly different idea
of what formats and server features it would like to support. A much
higher-power server might be able to transcode local content to device-supported formats on the fly, but that's not possible on the RPi, and the
on-the-fly transcoding often messes up other features like pause, fast-forward and rewind. In general, higher-powered devices like the PS3,
Xbox and WD TV devices can handle most formats without any transcoding.
Lower-end devices like smart TVs or Blu-ray players support a much more
limited list of codecs.
</p><p>
For the RPi, your best bet is simply to encode to the standards your
primary DLNA device supports and then test your other DLNA clients.
If they won't play nicely, the tips in the next section may help.
In my case, my PlayStation 3 acts as the DLNA client, which plays nicely
with the compact .m4v files generated by Handbrake.
</p><p>
Minidlna is a great choice for the RPi DLNA
server. It's already in the
Raspbian distribution, is quite simple to set up and uses minimal server
resources while running:

<pre     class="programlisting">
&gt;&gt; sudo apt-get install minidlna
&gt;&gt; sudo nano  -w /etc/minidlna.conf
</pre>
</p><p>
Here are the relevant sections of my /etc/minidlna.conf:

<pre     class="programlisting">
...
# I found keeping video + audio in different paths helpful
media_dir=V,/storage/dlna/video 
media_dir=A,/storage/dlna/music 
...
presentation_url=http://192.168.1.10:8200/
...
friendly_name=MyRPi
...
# Since I add new media infrequently, turning off 
# inotify keeps minidlna for polling for 
# content changes. It's simple enough to run 
# sudo /etc/init.d/minidlna force-reload
# when new content is added.
inotify=no
</pre>
</p><p>
Once done editing, tell minidlna to restart and rescan for content:

<pre     class="programlisting">
&gt;&gt; sudo /etc/init.d/minidlna force-reload
</pre>
</p><p>
Minidlna has the ability to provide movie-poster thumbnails for your
movies for devices that support it (like the PS3). It makes finding a
specific movie when scrolling through dozens of movie files much more
convenient. I've found that the most compatible file layout is to have
one directory per movie, containing just the movie file plus the thumbnail
image named &ldquo;Cover.jpg&rdquo;. Using a format like
&ldquo;MovieName.m4v&rdquo;
and &ldquo;MovieName.jpg&rdquo; works fine for the PS3, but it breaks VLC (if you
can convince the VLC uPNP plugin to find the server in the first place).
</p><p>
From the PS3, you can test connectivity by going to &ldquo;Video&rdquo; on the
XMB bar. The &ldquo;friendly_name&rdquo; you set previously should be visible
when scrolling down in the Video section. If you cant find it, test
to ensure that Minidlna is up by going to http://192.168.1.10:8200/ with a
Web browser.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x2b980a0"></a>
Multimedia for Non-DLNA Devices</h2></div></div><p>
Once you get DNLA working with some of your devices, you may find devices
it doesn't want to work with, so a multimedia plan B is a good idea. The
nginx Web server has an MP4 plugin that tries to improve streaming over
plain-old HTTP, but browser playback performance varied widely, and
fast-forwarding within a movie didn't work consistently either. It seems like the lowest common denominator for multimedia sharing across fussy
or non-DLNA devices is a good-old-fashioned Samba share with guest
read-only access.
</p><p>
Here's an sample section from /etc/samba/smb.conf:

<pre     class="programlisting">
[dlna] 
path=/storage/dlna 
read only=yes 
browsable=yes 
public=yes 
</pre>
</p><p>
After defining the share and restarting Samba (<tt  >sudo /etc/init.d/samba
restart</tt>), you can start to test out your clients.
</p><p>
I tested the following clients with a mix of videos encoded with Handbrake
as m4v files:
</p><div class="itemizedlist"><ul type="disc"><li><p>
Android 4.0.4 phone: &ldquo;ES File Explorer&rdquo; with &ldquo;ES Media
Player&rdquo; (player comes with install).
</p></li><li><p>
Android 4.1.2 tablet: &ldquo;ES File Explorer&rdquo; with &ldquo;ES Media
Player&rdquo; (player comes with install).
</p></li><li><p>
Linux devices: automount ://192.168.1.10/dlna, then use VLC or MPlayer.
</p></li><li><p>
Windows: mount //192.168.1.10:/dlna, then use VLC.
</p></li></ul></div><p>
All devices were able to start playing almost instantly and fast-forward with no delays.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x2b98888"></a>
Print Server</h2></div></div><p>
The RPi runs CUPS quite well, so it's easy to share an older printer
that doesn't have native networking features.
</p><p>
Install CUPS and any packages needed by your printer. I needed hplip-cups
since I have an HP inkjet printer:

<pre     class="programlisting">
&gt;&gt;  sudo apt-get install cups hplip-cups
</pre>
</p><p>
Update the &ldquo;Listen&rdquo; line and add the <tt  >Allow @LOCAL</tt> block to
the Location directives as shown below (so you can use other machines
on your LAN to administer CUPS):

<pre     class="programlisting">

======/etc/cups/cupsd.conf======
#Listen localhost:631  #Comment this out
Listen 192.168.1.10:631 #Add this line
...
&lt;Location /&gt; 
  Order allow,deny 
  Allow @LOCAL 
&lt;/Location&gt; 

# Restrict access to the admin pages... 
&lt;Location /admin&gt; 
  Order allow,deny 
  Allow @LOCAL 
&lt;/Location&gt; 

# Restrict access to configuration files... 
&lt;Location /admin/conf&gt; 
  AuthType Default 
  Require user @SYSTEM 
  Order allow,deny 
  Allow @LOCAL 
&lt;/Location&gt; 
======/etc/cups/cupsd.conf======

</pre>
</p><p>
Add your local ID to the lpadmin group so you can administer CUPS:

<pre     class="programlisting">
&gt;&gt; sudo usermod -a -G lpadmin  YOURUSERIDHERE
</pre>
</p><p>
Restart CUPS:

<pre     class="programlisting">
&gt;&gt; sudo /etc/init.d/cups restart
</pre>
</p><p>
Then, go to http://192.168.1.10:631/ and click &ldquo;Adding Printers and
Classes&rdquo; to set up your printer. My printer was auto-discovered
on the USB, so all I had do to was click &ldquo;share&rdquo;. Also access
https://192.168.1.10:631/admin, and make sure to check &ldquo;Share printers
connected to this system&rdquo;.
</p><p>
Once you're done, you can set up your clients the usual way. My Linux
clients auto-discovered the printer and picked the right printer
drivers once I entered the hostname. On my Windows 7 machine,
once I selected &ldquo;Network Printer&rdquo;, I had to click &ldquo;The printer
that I want isn't listed&rdquo;, select &ldquo;Select a shared printer
by name&rdquo; and then enter the URL from the CUPS Web interface:
http://192.168.1.10:631/printers/HP_J4500.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x26a5580.0x2b99018"></a>
Conclusion</h2></div></div><p>
With a minimal amount of additional hardware and configuration, the
Raspberry Pi can be a highly capable, compact home server. It can
bring the wide range of enterprise services offered by Linux into a home
environment with minimal hardware expense.
</p></div></div>
<div class="authorblurb"><p>
Brian Trapp serves up a spicy gumbo of Web-based yield reporting
and analysis tools for hungry semiconductor engineers at one of the
leading semiconductor research and development consortiums. His signature
dish has a Java base with a dash of JavaScript, Perl, Bash and R, and
his kitchen has been powered by Linux ever since 1998. He works from
home in Buffalo, New York, which is a shame only because that doesn't really
fit the whole chef metaphor.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../229/toc229.html">Issue Table of Contents</a>
    <a class="link3" href="../229/11454.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>