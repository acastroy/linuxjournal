<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Netatalk, Linux and the Macintosh</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;    With Netatalk, you can drag and drop files from Linux to Mac&#10;    and back, share system resources and more.&#10;    "><meta name="keywords" content="Netatalk, Macintosh"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0xb8f580.0xc86ab0"></a>Netatalk, Linux and the Macintosh</h1></div><div><div class="author"><h3 class="author">Richard Parry</h3></div><div class="issuemoyr">Issue #45, January 1998</div></div><div><p>
    With Netatalk, you can drag and drop files from Linux to Mac
    and back, share system resources and more.
    </p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xb8f580.0xc87450"></a></h2></div></div><p>Unix workstations, PCs running Windows
3.x/95/NT/Linux, FreeBSD, and other systems must be able to
communicate seamlessly and share data whether they are in an
engineering, business or home environment. More than one type of
computer platform existing on the same network is a fact of life.
Fortunately, with programs such as Netatalk it's easy to get Apple
Macintosh computers and Linux systems to coexist and share
resources. This article describes what Netatalk is, what it does,
where to get it, and how to install, configure and test it. We also
included a short technical description of how Netatalk works.
</p><p>If you have a Mac and want to run Linux, you can use MkLinux
(see <i  >LJ</i> #31, page 55). If you have a PC and
want to run MacOS, you can use Executor (see
<i  >LJ</i> #19, page 40). However, if you have both
machines and want to let each do what it does best, use Netatalk.
Netatalk lets you keep the operating systems separate while
enabling you to transfer files and share printer resources. I paid
my dues to wear a Linux T-shirt&mdash;I love Linux. I also love my
Mac&mdash;for entirely different reasons. Since I use the two systems
for different purposes, it is often necessary for the two to
communicate.</p><p>You can transfer small files with a floppy disk (a.k.a.
SneakerNet). When the file size exceeds the 1.44MB floppy limit,
however, the solution is FTP&mdash;fast and efficient, but cumbersome
when moving multiple directories containing subdirectories. The
ideal solution is to mount the Linux file system on the Mac
desktop, then drag and drop files and directories as you do under
the normal MacOS. This is exactly the solution that Netatalk gives
you. You can also use Netatalk to send print jobs to the Linux
printer from the Mac, thereby sharing other system
resources.</p><div       class="mediaobject"><a href="2033f1.large.jpg"><img src="2033f1.jpg"></a><div class="caption"><p>
Figure 1. Linux Files and Directories on the Macintosh Desktop
</p></div></div><p>At the time of this writing, the most recent version of
Netatalk is 1.4b2. Don't let the beta suffix scare you; Netatalk is
stable, especially for the PC platform. Current development
emphasizes new platforms (see Table 1) such as FreeBSD and
Solaris&mdash;hence the beta appellation. The primary Netatalk host site
and directory is: ftp://terminator.rs.itd.umich.edu/unix/netatalk/.
From that address all you need to do is download the single file
netatalk-1.4b2.tar.gz. You can uncompress and untar Netatalk with
normal Linux commands such as:</p><pre     class="programlisting">
gunzip netatalk-1.4b2.tar.gz
tar xvf netatalk-1.4b2.tar
</pre><p>or:
<pre     class="programlisting">
tar xzvf netatalk-14b2.tar.gz
</pre>


<div       class="mediaobject"><a href="2033f2.large.jpg"><img src="2033f2.jpg"></a><div class="caption"><p>
Figure 2. One of Several Netatalk Web Pages
</p></div></div>

</p><p>Note that prior to the release of Linux 2.x, installation of
Netatalk required that the Datagram Delivery Protocol (DDP)
software be integrated into the kernel. Now that DDP is part of the
Linux kernel, all you need to do is make sure that you turn on
Appletalk during kernel configuration. Do this by specifying the
kernel configuration option as:</p><pre     class="programlisting">
CONFIG_ATALK=y
</pre><p>You should always use the README files that accompany the
Netatalk distribution as the ultimate authority for installation
instructions. Since Netatalk is offered for several platforms, as
shown in <a href="2033t1.html" target="_self">Table 1</a>, there are
actually several different README files. Each operating system has
its own defaults for file locations. For this reason, the Makefile
that comes with Netatalk provides user-defined variables that you
can change to alter the installation and ultimately the file
structure. For the Linux installation, I used the default values
and the installation worked flawlessly.
</p><p>The <b  >DESTDIR</b> variable in the Makefile
points to the directory where binaries are placed. The default for
this directory is /usr/local/atalk and does not need to be altered.
Note that setting <b  >DESTDIR</b> causes all
installation-relative pathnames to be set correctly. The other
important variable is <b  >MANDIR</b>, by which you can
specify the location of the man pages. The default for this
directory is /usr/man, and again does not need to be
changed.</p><p>Installation to make all binaries begins with the ubiquitous
command:</p><pre     class="programlisting">
make
</pre><p>To install the binaries at the root of the source tree, type:
<pre     class="programlisting">
make install
</pre>


Pretty easy! Now let's go on to configuration.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xb8f580.0xc87fa8"></a>Configure Appletalk</h2></div></div><p>First, add the contents of the services.atalk file that
accompanies the Netatalk distribution to your /etc/services
database. The lines to add will look like this:</p><pre     class="programlisting">
rtmp    1/ddp   # Routing Table Main Protocol
nbp     2/ddp   # Name Binding Protocol
echo    4/ddp   # AppleTalk Echo Protocol
zip     6/ddp   # Zone Information Protocol
</pre><p>Next, assuming that your physical connection between Linux
and the Mac is Ethernet, edit the /usr/local/atalk/etc/atalkd.conf
file so that it contains the single line:
<pre     class="programlisting">
eth0
</pre>


This line is automatically changed when the system is placed into
service. In my case, when I actually connected to the network, the
<span   class="bold"><b>eth()</b></span> line (the file
configuration) was changed by the Appletalk daemon to:
<pre     class="programlisting">
eth0 -phase 2 -net 7540-7544 -addr 7544.197 \
        -zone "Outer-Limits"
</pre>


<div       class="mediaobject"><a href="2033f3.large.jpg"><img src="2033f3.jpg"></a><div class="caption"><p>
Figure 3. Your eyes aren't deceiving you&mdash;It's a web site devoted
entirely to Netatalk.
</p></div></div>

</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xb8f580.0xc88420"></a>Exporting Linux</h2></div></div><p>The Netatalk distribution provides three sample configuration
files that need to be configured:</p><div class="orderedlist"><ol type="1"><li><p>AppleVolumes.default</p></li><li><p>atalkd.conf</p></li><li><p>papd.conf</p></li></ol></div><p>These files are normally placed in the /usr/local/atalk/etc
directory, and contain instructions in the form of comments to aid
the user. You can get additional information from the man pages. We
have already discussed the configuration of atalkd.conf during
Appletalk configuration.</p><p>You specify which files and/or directories are made
accessible to the Macintosh by editing the file
/usr/local/atalk/etc/AppleVolumes.system. Here's a sample
configuration is shown in <a href="2033l1.html" target="_self">Listing
1</a>. This configuration shows that the directories /tmp and
/pub are available to the network. On the Macintosh a Linux
directory appears as a folder with a name you assign: in our
example tmp and pub. The directory /home/user/X is also accessible
from the Macintosh under the name XWindows. You specify that an
exported directory will have a different name on the Mac, using a
different second parameter than the Linux directory name, such as
/home/user/X XWindows.</p><p>We advise caution when deciding which directories to export
to the network. The Netatalk daemon
<span   class="bold"><b>afpd</b></span> (Apple Filing Protocol
Daemon) creates additional files for housekeeping. Specifically, in
each of the exported directories, two invisible files (that is,
files beginning with a period character) are created, namely,
.AppleDesktop and .Appledouble. These files are created in all
Linux directories and subdirectories that are exported and
accessed. If you export an entire file tree using the / character,
you will find your Linux system cluttered with .AppleDesktop and
.Appledouble files.</p><p>Also, note that the file
/usr/local/atalk/etc/AppleVolumes.system contains a list of file
extensions. This list is not necessary, but the extensions provide
a means for displaying the appropriate icons on the Macintosh
desktop. For example, in Figure 1 you can see that the files z.mpg,
z.rtf and zz.jpg are displayed with the correct Macintosh
application icon.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xb8f580.0xc889a0"></a>Sharing the Linux Printer</h2></div></div><p>You can make a printer connected to your Linux system
available to the Appletalk network by using
<span   class="bold"><b>papd</b></span> (the Appletalk Printer Access
Protocol Daemon), which is started when booting Linux. The papd
daemon accepts printing requests from the Macintosh and spools the
job to the local line printer. To configure the printer, edit the
file /etc/local/atalk/etc/papd.conf to look like this:</p><pre     class="programlisting">
# Sample papd.conf file to allow
# printing on the Linux printer over
# the Appletalk network.
MyLaserW:\
        :pr=lp:op=cg:
</pre><p>The syntax used in this file is the same as used in the Linux
printcap file that you can find on most Linux systems in
/etc/printcap.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xb8f580.0xc88bb0"></a>Netatalk Startup</h2></div></div><p>The file rc.atalk located in the directory specified by the
variable <b  >ETCDIR</b> (normally /usr/local/atalk/etc)
must be executed at startup. To do this on a Linux system on which
the rc files are to be kept in one place, copy
/usr/local/atalk/etc/rc.atalk to the /etc/rc.d directory or make a
symbolic link. Then, using a text editor, insert the following line
in the rc.local file:</p><pre     class="programlisting">
sh /etc/rc.d/rc.atalk
</pre><p>For more information about this script, consult the Netatalk
man pages.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xb8f580.0xc7f650"></a>Testing</h2></div></div><p>Now for the fun part&mdash;go to the Macintosh Chooser and select
AppleShare as shown in Figure 4. The Linux system host name will
appear on the desktop just like any other Appletalk-compatible
machine on the network. There is an 8-character password limit on
the Mac, so if your Linux password is more than 8 characters,
change it.</p><div       class="mediaobject"><img src="2033f4.jpg"><div class="caption"><p>
Figure 4. Use the Mac Chooser to Mount the Linux File System
</p></div></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xb8f580.0xc7f910"></a>Netatalk Techtalk</h2></div></div><p>Technically speaking, Netatalk is an implementation of the
AppleTalk Protocol Suite. It contains support for EtherTalk Phase I
and II, DDP, RTMP, NBP, ZIP, AEP, ATP, PAP, ASP and AFP, as shown
in Figure 5. DDP is now provided by the new Linux 2.x kernel. The
<span   class="bold"><b>atalkd</b></span> daemon implements RTMP,
NBP, ZIP and AEP, which is the AppleTalk equivalent of Unix
<span   class="bold"><b>routed</b></span> (route daemon). ATP and ASP
are implemented as libraries. The
<span   class="bold"><b>papd</b></span> daemon allows Macs to spool
to <span   class="bold"><b>lpd</b></span> (line printer daemon),
while <span   class="bold"><b>pap</b></span> allows Unix machines to
print to AppleTalk connected printers. Also provided in the suite
is <span   class="bold"><b>psf</b></span>, which is a PostScript
printer filter for lpd designed to use pap. A PostScript reverser,
<span   class="bold"><b>psorder</b></span>, is called by psf to
reverse pages printed to face-up stacking printers. Last and
perhaps most important is the afpd daemon that provides Macs with
an interface to the Unix file system.</p><div       class="mediaobject"><img src="2033f5.jpg"><div class="caption"><p>
Figure 5. The Netatalk Stack
</p></div></div><p>There are extensive and well-written man pages that accompany
Netatalk, such as aecho.1, afpd.8, atalk.4, atalkd.8, atalk_aton.3,
getzones.1, hqx2bin.1, macbinary.1, megatron.1, nbp.1, nbplkup.1,
nbprgstr.1, nbp_name.3, pap.1, papd.8, papstatus.1, psf.8,
psorder.1, single2bin.1, unbin.1, unhex.1 and unsingle.1.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xb8f580.0xc7fe90"></a>Conclusion</h2></div></div><p>Netatalk is a stable program that makes moving files between
the Mac and Linux as easy as drag-and-drop. In fact, you can
install Netatalk on almost any Unix-like platform and take
advantage of the power it provides. Now you really can have the
&ldquo;power to be your best&rdquo; by using both the Mac and Linux.</p><p><a href="2033s1.html" target="_self">Resources</a></p></div></div>
<div class="authorblurb"><p>
        <div       class="mediaobject"><img src="2033aa.jpg"></div>

      <span   class="bold"><b>Richard Parry</b></span>
      (W9IF) is currently attending the
      University of California, San Diego and studying computer science.
      He works as a software engineer at Qualcomm, Inc., known by most as
      the home of Eudora. His wife tells us that he spends entirely too
      much time with his Linux system. He can be reached via e-mail at
      rparry@qualcomm.com or you can visit his home page at
      http://www.qualcomm.com/~rparry.</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../045/toc045.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>