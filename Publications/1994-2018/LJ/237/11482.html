<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Encrypted Backup Solution Home Paranoia Edition
</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;How to safeguard your personal data with TrueCrypt and SpiderOak.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x2120580.0x2217ac0"></a>
Encrypted Backup Solution &ldquo;Home Paranoia Edition&rdquo;
</h1></div><div><div class="author"><h3 class="author">
Tim
 
Cordova
</h3></div><div class="issuemoyr">Issue #237, January 2014</div></div><div><p>
How to safeguard your personal data with TrueCrypt and SpiderOak.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2120580.0x2218250"></a></h2></div></div><p>
There are so many cases of personal identifiable information (PII) or
any type of data exposed on the Internet today. The details provided
in this article may assist in safeguarding your tax information,
social security number or password file. The setup this
article describes will help keep your personal data at home safe and secure
in this &ldquo;cyber-security&rdquo;-connected world. This includes virtual/physical security
compromises&mdash;the only truly secure system is one that is unplugged
and locked in a vault. This solution is not all-encompassing and does
have limitations, but it is sound enough for
safeguarding personal data.
</p><p>
The first step is addressing the physical aspect of security. This is
a critical step, because some notable compromises are a direct result
of someone having physical access to a system. You always should prepare
yourself for the possibility that your beloved electronic devices
could be in hands of someone other than you at any given moment. This
situation could occur on a train, or in a coffee shop, automobile or home, and
you must assume your data is lost when it is outside your control. 
</p><p>
This article describes utilizing whole disk encryption to reduce some of the risks provided
by a great open-source Linux operation system (Ubuntu 12.10). Whole disk
encryption is a key factor, especially when considering all of the recent
events concerning stolen government laptops that contained millions of
social security numbers.
</p><div       class="mediaobject"><img src="11482f1.jpg"><div class="caption"><p>
Figure 1. Setup screen for encrypting your home directory in Ubuntu during
initial operating system installation.
</p></div></div><p>
The next key step in safeguarding your personal information is by
adding another security layer by encrypting home directories during
the initial installation (Figure 1). You may be the only one using
this system; however, if others are able to access your system while
it's running, this may slow them down from trying to access information
contained in a home directory. 
</p><p>
You will need to run the command:

<pre     class="programlisting">
sudo apt-get install ecryptfs-utils cryptsetup
</pre>
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2120580.0x22187d0"></a></h2></div></div><p>
using an advanced packaging
tool-capable distribution. This will install the encrypting utilities
needed to encrypt your home directory. 
</p><p>
The next step is to log in 
or create another user account with root privileges to run the following
command on the user's home
directory (Figure 2):

<pre     class="programlisting">
sudo ecryptfs-migrate-home -u your-user-name
</pre>
</p><p>
Then, you need to log in to the encrypted
home directory account before rebooting the machine (as stated in the
important note screen), providing a roll-back opportunity in the event
of any unexpected complications during the encryption process. 
</p><p>
Use
<tt  >encryptfs-unwrap-passphrase</tt> to record your randomly generated mount
passphrase. Keep this passphrase safe, because you may need it to
recover your encrypted files. Also, ensure that you reboot your system and
remove the un-encrypted backup folder (Figure 3).
</p><div       class="mediaobject"><a href="11482f2.large.jpg"><img src="11482f2.jpg"></a><div class="caption"><p>
Figure 2. If encrypting your home folder was missed during initial
installation, use <tt >encryptft-utils</tt> to encrypt your home
directory.
</p></div></div><div       class="mediaobject"><a href="11482f3.large.jpg"><img src="11482f3.jpg"></a><div class="caption"><p>
Figure 3. This is important feedback information &ldquo;record passphrase as
soon as possible&rdquo; that will be generated from the
<tt >encryptfs-migrate-home</tt> command.
</p></div></div><p>
A third step in the process is to utilize a great open-source application
called TrueCrypt to provide encrypted containers to store personal
information. This easy process includes visiting the TrueCrypt Web site at <a href="http://www.truecrypt.org/downloads" target="_self">www.truecrypt.org/downloads</a>
to download the latest package (truecrypt-7.1a-linux-x86.tar.gz, at the time of this
writing), and run
the following commands and script:

<pre     class="programlisting">
tar -xvf truecrypt-7.1a-linux-x86.tar.gz
sudo ./truecrypt-7.1a-linux-x86
select ? Install TrueCrypt at the gui menu. 
</pre>
</p><div       class="mediaobject"><img src="11482f4.jpg"><div class="caption"><p>
Figure 4. TrueCrypt Installation Button
</p></div></div><p>
The next step is to create an encrypted
container. This container will store personal identifiable information
(PII) or any file that you want to keep safe on your local computer,
and it will create another layer of security. The process for creating
a basic container is by selecting the default options during initial
installation (Figure 4). Once the software is installed, starting the
application is a breeze using the command <tt  >truecrypt &amp;</tt> or via the
GUI menu system by selecting the create volume button.
</p><div       class="mediaobject"><a href="11482f5.large.jpg"><img src="11482f5.jpg"></a><div class="caption"><p>
Figure 5. TrueCrypt Create Volume Button Screen
</p></div></div><div       class="mediaobject"><a href="11482f6.large.jpg"><img src="11482f6.jpg"></a><div class="caption"><p>
Figure 6. After the create volume button is selected, you will be presented
with two options for creating an encrypted file container or creating a
volume within a partition/drive.
</p></div></div><p>
There are two options when creating a volume: choosing an encrypted
file container or a volume within a partition/drive (Figures
5 and 6). You also will have a choice of using a standard
TrueCrypt volume or a hidden TrueCrypt volume (Figure 7). The idea
behind a hidden container is to reveal an outside container
password, and your hidden container encrypted within the outside
container (<a href="http://www.truecrypt.org/docs/hidden-volume" target="_self">www.truecrypt.org/docs/hidden-volume</a>).
</p><div       class="mediaobject"><img src="11482f7.jpg"><div class="caption"><p>
Figure 7. The next menu item gives you the option of creating a standard or hidden
volume.
</p></div></div><p>
On the next menu, simply select an encryption algorithm, hash algorithm
and size of container. Multiple books and papers provide specific
information on the differences between these algorithms and hashes (AES
with a 256/14 rounds and Sha-512 default hashing function). The size of
your container depends on the amount of information you want
to protect (Figure 8).
</p><div       class="mediaobject"><a href="11482f8.large.jpg"><img src="11482f8.jpg"></a><div class="caption"><p>
Figure 8. After the standard volume is selected, the next options are
to select the encryption and hash algorithms, and size of the volume.
</p></div></div><p>
The next step is to select your preferred filesystem type (ext3, ext4 and so on).
Once the volume-creating process is completed, mount your volume
using the TrueCrypt application and start saving your private files to
this encrypted container.
</p><div       class="mediaobject"><img src="11482f9.jpg"><div class="caption"><p>
Figure 9. Select the newly created standard volume to mount an
accessible unencrypted share.
</p></div></div><p>
A safe and secure on-line storage location for your newly created encrypted
container is essential for backing up data in the cloud. 
A couple options are available for an on-line storage location, such as Dropbox,
Evernote, AWS and SpiderOak. The final choice for secure cloud
storage is with the company called SpiderOak, and this is based
on the company's &ldquo;Zero-Knowledge&rdquo; privacy policy that states: &ldquo;we
never have any knowledge of your password and no way to retrieve
or reset it, even in emergencies. It's our way of ensuring that
our customer's data is always completely secure&mdash;even from us!&rdquo;
(<a href="https://spideroak.com/faq/category/privacy_passwords" target="_self">https://spideroak.com/faq/category/privacy_passwords</a>).
</p><p>
The company also provides two-factor authentication for extra protection
of requiring a user name, password and a token. The token will be sent
to your mobile phone whenever you need to log in to a Web site or mobile
device. The majority of big-name providers are offering two-factor
authentication since the traditional password/passphrase does not offer
enough protection. Seeing how this solution is deployed on a dedicated
desktop and requires the token to authenticate, it provides a
true two-channel authentication solution. Of course, using two-factor
authentication does not guarantee safety, but it does require the
attacker to use sophisticated methods, and attackers generally are lazy
and look for easy targets.
</p><p>
Installing SpiderOak is straightforward for all the Debian
users out there. It includes downloading and installing the
spideroak_4.8.4_i386.deb package from 
<a href="https://spideroak.com/opendownload" target="_self">https://spideroak.com/opendownload</a> and using <tt  >sudo dpkg -i
spideroak_4.8.4_i386.deb</tt> to install this package on your favorite Ubuntu
platform. 
</p><p>
Identify a local upload folder as the staging point for your
TrueCrypt container. Once you have a shared location that will host your
TrueCrypt container, simply open your SpiderOak application and select
the backup tab. Then, drill down until you find your TrueCrypt container
location, such as home/username/SpiderO/Upload. 
</p><p>
The next step is
to configure your backup frequency using the overview tab and selecting
the change button (Figures 10 and 11).
</p><div       class="mediaobject"><a href="11482f10.large.jpg"><img src="11482f10.jpg"></a><div class="caption"><p>
Figure 10. The backup tab in the SpiderOak application allows you to
select your encrypted volume.
</p></div></div><div       class="mediaobject"><a href="11482f11.large.jpg"><img src="11482f11.jpg"></a><div class="caption"><p>
Figure 11. A SpiderOak application status and backup menu provides a means to back up
your encrypted volume automatically in specified
intervals.
</p></div></div><p>
Many other configuration options are available using this interface.
For this example, use only these two options for a secure cloud backup.
</p><p>
The last couple steps in this encrypted backup solution are to
move the TrueCrypt container from the working location to the designated
SpiderOak export folder and create a cron job to run the script.
</p><p>
I created a Python script to accomplish the copy function, but I could have
created any type of script. This script is used to ensure that the TrueCrypt
application is not running, verify whether there were changes to the
container and then copy over the container if there were changes. This
script requires a configuration file called FolderandFileLoc to function
and the Python script BackupScript.py. The configuration file parameters
are SpiderOakPath, TrueCryptPath and LogFilepath, a running log
to verify whether a copy was successful and the Safefile filename.

</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2120580.0x26127b0"></a></h2></div></div><div class="sidebar"><p class="title"><b>Listing 1. SpiderOak/TrueCrypt Backup Script</b></p><pre     class="programlisting">
#!/usr/bin/python 
''' 
SpiderOak, TrueCrypt, dis-mount, Backup Script 
@author: Tim 
''' 
import os 
import string 
import datetime 
import hashlib 
FolderandFileLoc = "FolderandFileLoc" 
SpiderOakPath = " " 
TrueCryptPath = " " 
LogFilepath = " " 
safefile = " " 

def readconfigfile(SpiderOakPath,TrueCryptPath,LogFilepath,safefile, 
 &#8618;Setupfileopen): 
    # This will read the configuration and assign path location 
    now = datetime.datetime.now() 
    holdstr = ""  
    for line in Setupfileopen: 
        holdstr = str.split(line) 
        if string.find(line,"SpiderOakPath") &gt; -1: 
            SpiderOakPath = holdstr[1] 
        elif string.find(line,"TrueCryptPath") &gt; - 1: 
            TrueCryptPath = holdstr[1] 
        elif string.find(line, "LogFilepath") &gt; -1: 
            LogFilepath = holdstr[1] 
        elif string.find(line,"safefile") &gt; -1: 
            safefile = holdstr[1] 
            
    fo = open(LogFilepath,"a")  
    try:        
        fo = open(LogFilepath,"a") 
        fo.write (str(now) + "- Path Variable SpiderOakPath 
         &#8618;used -&gt; " + SpiderOakPath + "\n") 
        fo.write (str(now) + "- Path Variable TrueCryptPath 
         &#8618;used -&gt; " + TrueCryptPath + "\n") 
        fo.write (str(now) + "- Path Variable LogFilepath 
         &#8618;used -&gt; " + LogFilepath + "\n") 
        fo.write (str(now) + "- Path Variable hold 
         &#8618;used -&gt; " + safefile + "\n") 
    except: fo.error   
    shutdowntruecrypt(fo,now) 
    copycontainer(fo,SpiderOakPath,TrueCryptPath,
    &#8618;LogFilepath,safefile,now) 
    fo.close    
    
    
def shutdowntruecrypt(fo,now): 
    # Test to see if the truecypt is running 
    # If not then Shut it down 
    foundstring = 0    
    try: 
        f = os.popen( "ps ax" ) 
    except: os.error 
    
    for line in f: 
        if string.find(line, 'truecrypt') &gt; -1: 
            foundstring = 1 
            break             
    
    if foundstring == 1: 
        try: 
            dismount = os.system("truecrypt -d") 
            if dismount == 0: 
                fo.write (str(now) + "- True Crypt0service found 
                 &#8618;and the volume is dis-mounted \n"); 
            else: 
                fo.write (str(now) + "- Failed to 
                 &#8618;dismount service \n "); 
        except: os.error 
    else: 
        fo.write (str(now) + "- mount was not open \n "); 
     
def copycontainer(fo,SpiderOakPath,TrueCryptPath,
&#8618;LogFilepath,safefile,now): 
    #Set Destination and Copy to new location 
         
    Holddestfilesum = TrueCryptPath + safefile 
    Holdorigfilesum = SpiderOakPath + "/" + safefile 
    checksumdest = md5filecheck(Holddestfilesum) 
    checksumorig = md5filecheck(Holdorigfilesum) 
    
    
    runstring = "cp "  # This will only copy over updates 
                       # to this file 
    runstring += TrueCryptPath 
    runstring += safefile       
    runstring += "  " 
    runstring += SpiderOakPath  # This will only send over any 
                                # updates to this file 
    testdiff = os.system("diff " + Holddestfilesum + " 
     &#8618;" + Holdorigfilesum) 
 
    
    if testdiff !=0: 
        try: 
            os.system(runstring) 
            testdiff = os.system("diff " + Holddestfilesum + " 
             &#8618;" + Holdorigfilesum) 
            if testdiff != 0 :	    
                fo.write (str(now) + TrueCryptPath + safefile +  
                 &#8618;" File Copied to " + SpiderOakPath + "\n") 
                fo.write(str(now) +  " ---- Processing Complete ----") 
            else: 
                fo.write(str(now) + TrueCryptPath + safefile + 
                 &#8618;"File failed to copy " + SpiderOakPath + "\n") 
        except: os.error 
         
    else: 
        fo.write (str(now) + " File has not been changed 
         &#8618;no copy was performed\n") 
        
       
         
Setupfileopen = open(FolderandFileLoc,"r") 
readconfigfile(SpiderOakPath,TrueCryptPath,LogFilepath,safefile, 
 &#8618;Setupfileopen) 
Setupfileopen.close() 
</pre></div><p>
The final step is to create a cron job to call the Python script:



<pre     class="programlisting">
0 5 * * * cd /home/t/workspace/BackupScript/src; /usr/bin/python
/home/t/workspace/BackupScript/src/BackupScript.py
</pre>
</p><p>
This personal encrypted solution is something that works great at
home when utilized on a daily basis. Many apps are available on
the Internet for managing passwords and data, but this one is easy to
implement and provides layers of encryption. I am confident that using
the described encrypted containers and storage location provides enough
security for private personal data, but it may not be an ideal solution for
an enterprise with various regulatory agencies. Use the described
methods at your own risk, and ensure that your passwords or passphrases are
safeguarded, because your data will be lost with a forgotten password.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2120580.0x2612b20"></a></h2></div></div><div class="sidebar"><p class="title"><b></b></p><p>Send comments or feedback via <a href="http://www.linuxjournal.com/contact" target="_self">www.linuxjournal.com/contact</a> or to
<a href="mailto:info@linuxjournal.com">info@linuxjournal.com</a>.
</p></div></div></div>
<div class="authorblurb"><p>
Tim Cordova is a computer geek who had a Commodore 64 at age 9, and has a love for
Linux, family, information security and longboard surfing. He currently
works as an information security professional at a large contracting
company and has more than 15 years of experience.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../237/toc237.html">Issue Table of Contents</a>
    <a class="link3" href="../237/11482.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>