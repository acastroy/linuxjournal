@lay:9074l1.qrk
@fig:Listing 1. /etc/drbd.conf
@cx:# Each resource is a configuration section for a <\n># mirrored disk.<\n># The drbd0 is the name we will use to refer <\n># to this disk when starting or stopping it.<\n><\n>resource drbd0 {<\n>  protocol C;<\n>  handlers {<\n>    pri-on-incon-degr "echo 'DRBD: primary requested but inconsistent!' <\n>    <@cont_arrow><\#229><@$p>| wall; /etc/init.d/heartbeat stop"; #"halt -f";<\n>    pri-lost-after-sb "echo 'DRBD: primary requested but lost!' <\n>    <@cont_arrow><\#229><@$p>| wall; /etc/init.d/heartbeat stop"; #"halt -f";<\n>  }<\n><\n>  startup {<\n>    degr-wfc-timeout 120;    # 2 minutes.<\n>  }<\n><\n>  disk {<\n>    on-io-error   detach;<\n>  }<\n># These are the network settings that worked best for me. <\n># If you want to play around with them, go<\n># ahead, but take a look in the man pages of drbd.conf <\n># and drbdadm to see what each does.<\n><\n>  net {<\n>    timeout 120;<\n>    connect-int 20;<\n>    ping-int 20;<\n>    max-buffers     2048;<\n>    max-epoch-size  2048;<\n>    ko-count 30;<\n><\n># Remember to change this shared-secret on both the master <\n># and slave machines.<\n><\n>    cram-hmac-alg "sha1";<\n>    shared-secret "FooFunFactory";<\n>  }<\n><\n>  syncer {<\n>    rate 10M;<\n>    al-extents 257;<\n>  }<\n><\n># This next block defines the settings for the server <\n># labeled as server1. This label should be in your<\n># /etc/hosts file and point to a valid host.<\n><\n>  on server1 {<\n><\n># The following device will be created automatically by <\n># the drbd kernel module when the DRBD<\n># partition is in master mode and ready to write. <\n># If you have more than one DRBD resource, name<\n># this device drbd1, drbd2 and so forth.<\n><\n>    device     /dev/drbd0<\n><\n># Put the partition device name you've prepared here.<\n><\n>    disk	     /dev/sda5;<\n><\n># Now put the IP address of the primary server here.<\n># Note: you will need to use a unique port number for <\n># each resource.<\n><\n>    address   192.168.1.3:7788;<\n>    meta-disk  internal;<\n>  }<\n><\n># This next block is identical to that of server1 but with <\n># the appropriate settings of the server called<\n># server2 in our /etc/hosts file.<\n><\n>  on server2 {<\n>    device    /dev/drbd0;<\n>    disk      /dev/sda5;<\n>    address   192.168.1.2:7788;<\n>    meta-disk internal;<\n>  }<\n>}
