<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Facebook Application Development
</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;Facebook development, for friends and profit.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0xbb0580.0xca7ac0"></a>
Facebook Application Development
</h1></div><div><div class="author"><h3 class="author">
Mike
 
Diehl
</h3></div><div class="issuemoyr">Issue #208, August 2011</div></div><div><p>
Facebook development, for friends and profit.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbb0580.0xca8250"></a></h2></div></div><p>
Do you have a Facebook page? If you do, you are among the 600 million
users who actively use the social-networking service. I'll admit I
initially resisted the temptation to join Facebook. After all, I've got
e-mail, instant messaging and VoIP. What do I need with yet another form of
communication? Eventually, temptation got the better of me, and I gave it a
try. For the record, I also experimented with MySpace and Twitter, but those
sites just didn't seem to do anything for me. These days, every time I go to
my computer, I check my servers, my e-mail and my Facebook.
</p><p>
I never thought it would get to this point, but it turns out that Facebook is
a surprisingly powerful piece of technology. So far, I've connected with
friends from church, college, high school, previous jobs and some of my son's
activities. I've managed to reconnect with my best friend from high school
after 20 years. I've even managed to reconnect with my best friend from the
third grade! Since I'm 43 years old, I think that's quite an accomplishment.
Like I said, it's very powerful technology.
</p><p>
But for me, there's more. I also get links to blogs and news articles from
like-minded friends as well as pointers to breaking news that's of interest to
me. Many times, I've heard about events on Facebook before I saw them on TV
or read about them in the newspaper. Lately, I've been investigating ways to
use Facebook to promote my new business, and I'm sharing some of what
I've found in this article.
</p><p>
First, let's take care of some of the easy stuff. Everyone's probably been to
a Web site and seen a Facebook &ldquo;Like&rdquo; button. When users click on
this
button, they are asked to log in to Facebook, if they're not already. Then, the
button click causes a brief message to be added to users' Facebook pages,
indicating that they like the particular Web site. All of the users' Facebook
friends then can see this message. Assuming that many of one's
friends share the same interests, this is a very simple way to get a message
out to potentially interested people.
</p><p>
Adding a Like button to a Web site is as easy as embedding a little
HTML code
into your page. Facebook even has a wizard to help customize the button:
<a href="https://developers.facebook.com/docs/reference/plugins/like" target="_self">https://developers.facebook.com/docs/reference/plugins/like</a>.
</p><p>
When I played with this wizard, I was given code that looked like the code
shown in Listing 1. This code results in a Web browser displaying something
that resembles Figure 1. 

</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbb0580.0xca8720"></a></h2></div></div><div class="sidebar"><p class="title"><b>
Listing 1. Like Button Code</b></p><pre     class="programlisting">
&lt;iframe src="http://www.facebook.com/plugins/like.php?href=
&#8618;www.linuxjournal.com&amp;amp;send=true&amp;amp;layout=
&#8618;standard&amp;amp;width=450&amp;show_faces=true&amp;action=
&#8618;like&amp;amp;colorscheme=light&amp;amp;font&amp;amp;height=80"
 &#8618;scrolling="no" frameborder="0" style="border:none; 
 &#8618;overflow:hidden; width:450px; height:80px;" 
 &#8618;allowTransparency="true"&gt;&lt;/iframe&gt;
</pre></div><div       class="mediaobject"><img src="11043f1.jpg"><div class="caption"><p>
Figure 1. Like Button
</p></div></div><p>
Facebook also provides methods that allow a Web site to post to users'
Facebook pages as well as adding a person or page to their friends list. These
methods are documented at
<a href="https://developers.facebook.com/docs/reference/dialogs" target="_self">https://developers.facebook.com/docs/reference/dialogs</a>.
</p><p>
Before I go any further, let me pass on a little tidbit of information
I came across while researching this article. Facebook supports a primitive
chat function that allows users to exchange interactive messages with their
friends. This chat function is based on the XMMP protocol, which is the same
protocol that Google Talk and Jabber use. The details are documented at
<a href="https://developers.facebook.com/docs/chat" target="_self">https://developers.facebook.com/docs/chat</a>. Essentially, you need to know
your Facebook user name and password. Then, you prepend your user name to
@chat.facebook.com to form a Jabber ID. When I plugged this information in to
Kopete, I was able to chat with my Facebook friends using Kopete. I also
was able to get real-time updates when my friends logged in and out of Facebook.
</p><p>
Facebook also provides a powerful method of querying its database for
various types of information. Using a language called Facebook Query
Language (FQL), you can ask for all kinds of information about a Facebook user,
subject to access restrictions. The easiest way to do this is to use the HTTP
GET access method. This method allows you to execute a query using a standard
HTTP GET. The results are returned in XML format. All you have to do is
append your query to the end of this URL:
https://api.facebook.com/method/fql.query?query=.
</p><p>
For example, if you had a user ID number and wanted to find the user's full
name, you would use something like this:

<pre     class="programlisting">
select name from user where uid=1690577964
</pre>
</p><p>
The resulting URL would like like this:

<pre     class="programlisting">
https://api.facebook.com/method/fql.query?query=select 
 &#8618;name from user where uid=1690577964
</pre>
</p><p>
Amazingly, your results look like this:

<pre     class="programlisting">

&lt;fql_query_response list="true"&gt;
       &lt;user&gt;
               &lt;name&gt;Mike Diehl&lt;/name&gt;
       &lt;/user&gt;
&lt;/fql_query_response&gt;

</pre>
</p><p>
FQL requires that you specifically list each of the fields in which you are
interested. That means you can't simply use <tt  >select *
from...</tt> as you would
be
tempted to do in a language like SQL. So, it's important to know what tables
and columns are available to you. This is well documented at:
<a href="https://developers.facebook.com/docs/reference/fql" target="_self">https://developers.facebook.com/docs/reference/fql</a>.
</p><p>
At the risk of duplicating what's already on the Web site, here's a list of a few of
the more interesting tables that you can query (from the Web site):
</p><div class="itemizedlist"><ul type="disc"><li><p>
comment: query this table to obtain comments associated with one or more feed
comment XIDs.
</p></li><li><p>
connectioncomment: query this table to return a user's friends and the
Facebook pages to which the user is connected.
</p></li><li><p>
friend: query this table to determine whether two users are linked together as
friends.
</p></li><li><p>
like: query this table to return the user IDs of users who like a given
Facebook object (video, note, link, photo or photo album).
</p></li><li><p>
notification: query this table to get the notifications for the current session
user&mdash;that is, any notification that appears on
http://www.facebook.com/notifications.php.
</p></li><li><p>
profile: query this table to return certain (typically publicly) viewable
information from a user's profile or Facebook page that is displayed in a
story.
</p></li><li><p>
status: query this table to return one or more of a user's statuses.
</p></li><li><p>
stream: query this table to return posts from a user's stream or the user's
profile.
</p></li><li><p>
user: query this table to return detailed information from a user's profile.
</p></li></ul></div><p>
You can query against quite a few other tables, and I've not fully explored
what information is available. I can tell you that e-mail
addresses and phone numbers aren't readily available using this query method.
Also, users are able to set permissions that determine what can be
retrieved.
</p><p>
That said, you could use these methods in a server-side program to get all
kinds of information about a user. But, the real power comes from being able
to perform these queries on the client's computer via JavaScript. (I'll show
you how that's done, shortly.)
</p><p>
Before you can do anything even remotely fun with Facebook's JavaScript API,
you
need to become a developer. Becoming a developer is a simple matter of adding
the &ldquo;developers&rdquo; application to your Facebook profile and filling out a
form, which is available at <a href="https://www.facebook.com/developers" target="_self">https://www.facebook.com/developers</a>. Once you've filled
out the form and agreed to the Facebook terms of service, you can start adding
and configuring your new applications. You'll be issued an application key for
each application you define. (I'll explain how to use that key shortly.)
</p><p>
Facebook has received a lot of bad publicity lately because of its
often-changing and sometimes poorly implemented privacy policies. But, from reading
its terms of service, which all developers have to agree to abide by, it
appears that Facebook is really trying to do the right thing. Some items from
the terms of service, for example, stipulate that you can't spam your users.
That is, you can't create pre-canned messages and blast them out to multiple
users. You always must provide an &ldquo;opt-out&rdquo; for any action your
application
performs. You're not allowed to store personal data for use outside your
application and so on. Facebook's terms of service all seem pretty rational and
are documented at <a href="https://www.facebook.com/terms.php" target="_self">https://www.facebook.com/terms.php</a>.
</p><p>
Now that all the formalities are out of the way, let's define our
first application. Start the process by going to
<a href="https://www.facebook.com/developers/createapp.php" target="_self">https://www.facebook.com/developers/createapp.php</a>, and create a new
application (Figure 2). Once you've created your new application, you
have to configure it.
</p><div       class="mediaobject"><a href="11043f2.large.jpg"><img src="11043f2.jpg"></a><div class="caption"><p>
Figure 2. Create New Application
</p></div></div><p>
There are a half-dozen pages of configurable options, so I won't go into too
much detail with them. Most of them are fairly intuitive and well
documented. As long as you understand the process that Facebook performs when
a user accesses your application, you won't find this very difficult. Because
understanding the process is critical, I'll discuss it a bit before looking
at some more code.
</p><p>
The key concept is that all Facebook applications occupy a space on the
Facebook interface known as a canvas. The canvas is where your
application's content will be rendered and is embedded inside the rest of the
Facebook look and feel. Essentially, a Facebook application developer simply
uses the Facebook JavaScript API and server-side code to perform the
application's function. Thus, you can write your server-side code in any
language you like.
</p><p>
When users access your application, they use a URL that looks like
http://apps.facebook.com/APP_NAME, where APP_NAME is the name given to your
application. So, if I created an application called mikestestpage, it would be
accessible as http://apps.facebook.com/mikestestpage. You'll notice that this
URL points to a Facebook page. When the user's browser loads this page,
Facebook sends a page back to the user, as expected. However, Facebook also
embeds the content of your application's canvas code. The end result is a
seamless integration between the Facebook user experience and your program
code.
</p><p>
To keep this from getting too abstract, let's look at the code shown in Listing 2.

</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbb0580.0x10a2078"></a></h2></div></div><div class="sidebar"><p class="title"><b>Listing 2. Facebook JavaScript Demonstration</b></p><pre     class="programlisting">
 1 #!/usr/bin/perl
 2   
 3   
 4 print &lt;&lt;EOF
 5 Content-Type: text/html; charset=ISO-8859-1
 6   
 7   
 8 &lt;http&gt;
 9 &lt;head&gt;
10 &lt;title&gt;test page&lt;/title&gt;
11 &lt;/head&gt;
12 &lt;body&gt;
13   
14 &lt;script src="http://connect.facebook.net/en_US/all.js"&gt;&lt;/script&gt;
15   
16 &lt;div id="fb-root"&gt;
17 &lt;/div&gt;
18   
19 &lt;hr&gt;&lt;span id="who"&gt;&lt;/span&gt;
20 &lt;/hr&gt;
21 &lt;p&gt;
22 &lt;div id=result&gt;
23 &lt;/div&gt;
24   
25   
26 &lt;script&gt;
27 var user_id;
28   
29 var r;
30   
31 FB.init (
32    {
33   appId  : '206854775749',
34   status : true,
35   cookie : true,
36   xfbml  : true 
37   }
38 );
39   
40 FB.getLoginStatus(t, false);
41   
42 function t (response) {
43   
44   if (response.session) {
45     r = response;
46   
47     var query = FB.Data.query('select name, uid from user 
       &#8618;where uid={0}', r.session.uid);
48   
49     query.wait(
50       function(rows) {
51          document.getElementById("who").innerHTML = 
            &#8618;rows[0].name + "\'s Minions!";
52       }
53     );
54   
55     var query2 = FB.Data.query('select uid1, uid2 from 
       &#8618;friend where uid1={0} order by uid2', r.session.uid);
56     query2.wait(
57       function(rows) {
58          var i = 0;
59          var friends = "";
60   
61          while (rows[i]) {
62              var friend = "&lt;img width='20px' height='20px'
                &#8618;src=http://graph.facebook.com/" + rows[i].uid2 
                &#8618;+ "/picture&gt; ";
63              friends = friends + friend;
64   
65              if ((i%20) == 19) { friends = friends + "&lt;br&gt;"; }
66              i++;
67          }
68   
69          document.getElementById("result").innerHTML = friends;
70       }
71     );
72   
73   } else {
74     FB.login(function(response) {
75       if (response.session) {
76          // user successfully logged in
77       } else {
78          // user canceled login
79       }
80     });
81     r = null;
82   }
83 };
84   
85   
86 &lt;/script&gt;
87   
88 &lt;p&gt;
89 &lt;fb:like href="http://apps.facebook.com/mikestestpage/" 
    &#8618;width="450" height="80"/&gt;
90   
91 &lt;/body&gt;
92 &lt;/http&gt;
93 EOF
94 ;
</pre></div><p>
This is a simple Perl script, but it's meant to be as language-agnostic as
possible. All it does is output some static HTML. Lines 1&ndash;13 are simple
boilerplate that produce a valid HTTP and HTML header. Line 13 loads the
Facebook JavaScript API. I discovered that my application didn't work unless
I included the code in lines 16 and 17; Facebook must use that DOM container
internally. The rest of the code is the fun part.
</p><p>
Lines 19&ndash;23 create the simple application's layout by creating a
<tt  >who</tt> and a
<tt  >result</tt> DOM container. The rest of the code is devoted to populating
those
containers. It's all done in the JavaScript starting on line 27.
</p><p>
Lines 31&ndash;38 are where you initialize the Facebook API by passing it an
object that contains, among other things, your application's unique identifier.
Line 40 calls the getLoginStatus method and passes it two parameters. The
first parameter is a callback function that gets called when this method
returns. The second parameter has to do with authentication caching; I found
that if I set it to True, my callback was called twice, which didn't work
very well.
</p><p>
The main code is in the callback function in lines 42&ndash;83. Line 44
checks to see if the user is logged in. If not, the else statement
block on lines 73&ndash;82 is executed. In this simple application, users will be given the
opportunity to log in and then must reload the page. More sophisticated
applications would reload the page for them, of course.
</p><p>
That leaves lines 45&ndash;71. Line 47 creates an FQL query, as
discussed earlier. All this query does is get the user's name. Lines
49&ndash;53
use the wait method to get the results and process them using a
callback function that you pass implicitly as a parameter. Here, all you're
doing is creating a string value with the query results and placing it inside
the <tt  >who</tt> DOM container. The fact that this method is called
<tt  >wait</tt> is a bit
of a misnomer. This is <span   class="emphasis"><em>not</em></span> a blocking call. This function will be called
asynchronously as the results are returned to the client.
</p><p>
In lines 55 and 56, you set up another query and process the results in another
callback function. Only this time, the query selects all of the current
user's friends by UID number. The callback function, in lines 57&ndash;70 loops
over that result set. Each time through the loop, you build up an IMG tag that
points to the thumbnail picture of each of the user's friends. On line 65,
you
ensure that you start a new row of pictures after every 20 pictures are
rendered. Finally, you send all of the image tags, en masse, to the
<tt  >result</tt>
DOM container. The browser then begins to load the images.
</p><p>
And, that's the bulk of the application, except for that little piece of magic
on line 89. The &lt;fb:like&gt; tag is a tag that Facebook interprets before it
sends the results to your application's canvas. In this case, you're asking
Facebook to provide you with a Like button that your users can press to
indicate to their friends that your program is worth trying. There is an
entire class of such tags, known as the Extensible FaceBook Markup Language
(XFBML), and I've barely scratched the surface of what's available. This
article
was meant as a teaser to let you know that this functionality is available.
</p><p>
Figure 3 shows the results of this simple application.
</p><div       class="mediaobject"><a href="11043f3.large.jpg"><img src="11043f3.jpg"></a><div class="caption"><p>
Figure 3. My Minions
</p></div></div><p>
As you can see, Facebook has a huge user base and provides many powerful ways
to interact with those users. I've demonstrated a couple neat tricks you can use
with your own Web pages, as well as provided an introduction to the Facebook Javascript
API. I've also briefly shown how to integrate your application into the
Facebook framework. I hope this has been fun, and I hope it piques your
interest in Facebook application development.
</p></div></div>
<div class="authorblurb"><p>
Mike Diehl operates Diehlnet Communications, LLC, a small IP phone company.
Mike lives in Albuquerque, New Mexico, with his wife and three sons. He can be reached at
<a href="mailto:mdiehl@diehlnet.com">mdiehl@diehlnet.com</a>.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../208/toc208.html">Issue Table of Contents</a>
    <a class="link3" href="../208/11043.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>