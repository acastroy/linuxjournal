<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>CVS homedir</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;    Joey shows you how to keep track of everything with CVS.&#10;    "><meta name="keywords" content="home, directory, CVS, backup"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0xcb4580.0xdabab0"></a>CVS homedir</h1></div><div><div class="author"><h3 class="author">Joey Hess</h3></div><div class="issuemoyr">Issue #101, September 2002</div></div><div><p>
    Joey shows you how to keep track of everything with CVS.
    </p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xcb4580.0xdac450"></a></h2></div></div><p>I keep my life in a CVS repository. For
the past two years, every file I've created and worked on, every
e-mail I've sent or received and every config file I've tweaked
have all been checked into my CVS archive. When I tell people about
this, they invariably respond, &ldquo;You're crazy!&rdquo;
</p><p>After all, CVS is meant for managing discrete bodies of code,
such as free software programs that are worked on and available to
a lot of people or in-house projects that are collaboratively
developed by several employees. CVS has a reputation of being a
pain to deal with, and it has a lot of crufty bits that regularly
drive users up the wall, like its mistreatment of directories. Why
inflict the pain of CVS on yourself if you don't have to? Why do it
on such a scale that it affects nearly everything you do with your
computer?</p><p>I get three major benefits from keeping my whole home
directory in CVS: home directory replication, history and
distributed backups. The first of these is what originally drove me
to CVS for my whole home directory. At the time, I had a home
desktop machine, two laptops and a desktop machine at work.
Rounding this out were perhaps 20 remote accounts on various
systems around the world and many systems around the workplace that
I might randomly find myself logging in to. I used all of these
accounts for working on the same projects and already was using CVS
for those projects.</p><p>I'm a conservative guy when it comes to my computing
environment (I've used the same wallpaper image for the past five
years), and at the same time I'm always making a lot of little
tweaks to improve things. Whenever I go to work and something
wasn't just like I had tweaked it the night before, I'd feel a
jarring disconnect, and annoyingly copy over whatever the change
was. When I sat down at some other system at work, to burn a CD
perhaps, and found a bare Bash shell instead of the heavily
customized environment I've built up over the past ten years, it
was even worse. The plethora of environments, each imperfectly
customized to my needs by varying degrees, was really getting on my
nerves. So one day I cracked and sat down and began to feed my
whole home directory into CVS.</p><p>It worked astonishingly well. After a few weeks of tweaking
and importing I had everything working and began developing some
new habits. Every morning (er, afternoon) when I came into work,
I'd <b  >cvs up</b> while I read the morning mail. In the
evening, I'd <b  >cvs commit</b> and then update my
laptop for the trip home. When I got home, I'd sync up again, dive
right back into whatever I'd been doing at work and keep on rolling
until late at night&mdash;when I committed, went to bed and began the
cycle all over again. As for the systems I used less frequently,
like the CD burner machine, I'd just update when I got annoyed at
them for being a trifle out of date.</p><p>It only took a few more weeks before the advantage of having
a history of everything I'd done began to show up. It wasn't a real
surprise because having a history of past versions of a project is
one of the reasons to use CVS in the first place, but it's very
cool to have it suddenly apply to every file you own. When I broke
my .zshrc or .procmailrc, I could roll back to the previous day's
or look back and see when I made the change and why. It's very
handy to be able to run <b  >cvs diff</b> on your kernel
config file and see how <b  >make xconfig</b> changed it.
It's great to be able to recover files you deleted or delete files
because they're not relevant and still know you've not really lost
them. For those amateur historians among us, it's very cool to be
able to check out one's system as it looked one full year ago and
poke around and discover how everything has evolved over
time.</p><p>The final major benefit took some time to become clear. Linus
Torvalds once said, &ldquo;Only wimps use tape backup:
<span   class="emphasis"><em>real</em></span> men just upload their important stuff on
FTP and let the rest of the world mirror it.&rdquo; I'm not a real
enough man to upload my confidential documents to
<a href="ftp://ftp.kernel.org" target="_self">ftp.kernel.org</a> though, so
I've been wimping along with backups to tape and CD and so on. But
then it hit me: take, for example, one crucial file, like my .zshrc
or sent-mail archive: I had a copy of that file on my work machine,
and on my home machine, and on my laptop and several other copies
on other accounts. There was another copy encoded in my CVS
repository too.</p><p>I'm told that the best backups are done without effort&mdash;so
you actually do them&mdash;and are widely scattered among many machines
and a lot of area so that a local disaster doesn't knock them out.
They are tested on a regular basis to make sure the backup works. I
was doing all of these things as a mere side effect of keeping it
all in CVS. Then I sobered up and remembered that a dead CVS
repository would be a really, really bad thing and kept those wimpy
backups to CD going. But the automatic distributed backups are what
keep me sleeping quietly at night. Later, when I left that job, the
last thing I did on my work desktop machine was: <b  >cvs
commit ; sudo rm -rf /</b>. And I didn't worry a bit; my life
was still there, secure in CVS.</p><p>A full checkout of my home directory with all the trimmings
often runs about 4GB in size. A lot of that will be temporary trees
in tmp/ and rsynced Ogg Vorbis files (so far, I have not found the
disk space to check all of them into CVS). My CVS repository
currently uses less than 1GB of space, though it is steadily
growing in size. I keep some 13,000 files in CVS, and so a full CVS
update of my home directory is a sight to see and takes a
while.</p><p>These days I'm often stuck behind a dial-up connection, and I
mostly just use one laptop, so I might go days between CVS updates.
Other better-connected systems have automatic CVS updates done via
cron each day. I <b  >cvs commit</b> whenever I want to
make a backup of where I am in a file or when I am at the point of
releasing something. I still also do a full commit of my home
directory every day or so. I confess that some of my CVS commit
messages are less than informative&mdash;&ldquo;foo&rdquo; has been used far too
many times on some classes of files. I even do some automatic CVS
commits; for example, my mailbox archives are committed by a daily
cron job.</p><p>There are other benefits of course. I attend many tradeshows
and other events that require me to sit down at some computer out
of the box, use it for an hour or a day and never see it again. I
can check out the core of my CVS home directory in about five
minutes, and after that it is just as comfortable as if I'd SSH'd
home and was doing everything there. I even get my whole desktop
set up in that five minutes. In a chaotic tradeshow environment,
there is nothing more reassuring than having your familiar computer
setup at your fingertips as you demo things to the hordes of
visitors.</p><p>Keeping your home directory in CVS is not all fun though.
Anyone who's used CVS in a large project probably has had to
resolve conflicts engendered by two people modifying the same file.
At least you can curse the other guy who committed the changes
first while you deal with this annoying task. Most of you have
probably <span   class="emphasis"><em>not</em></span> had to resolve conflicts between
the file you modified at home and at work, then cursing at
yourself.</p><p>Then there are CVS's famous problems: poor handling of
directories and binary files. The nearly nonexistent handling of
permissions, which is not a big deal in most projects but becomes
important when you have a home directory with some public and some
private files and directories in it. A slow, bloated protocol,
hindered even more by the necessity of piping it all over SSH; the
pain of trying to move a file that is already in CVS, or much
worse, a whole directory tree, again hits you especially hard when
you're using CVS for the whole home directory. And those damn CVS
directories are always cluttering up everything. I've developed
means of coping with all of these to varying degrees, but like many
of us, I'm hoping for a better replacement one day (and dreading
the transition).</p><p>Perhaps it's time that I get down to the details of how I
organize my home directory in CVS. I've always managed my home
directory with an iron hand, and CVS has just exacerbated this
tendency. Let's look at the top level:</p><pre     class="programlisting">
joey@silk:~&gt;ls
CVS/  GNUstep/  bin/  debian/  doc/  html/  lib/
mail/  src/  tmp/
</pre><p>Yes, that's it. Well, except for the 100-plus dot files. Most
people use their home directory as a scratch space for files
they're working on, but instead I have a dedicated scratch
directory, the tmp directory, which I clean out irregularly. In
general, when I start a new file or project, I will be checking it
into CVS soon, so I begin working on it in the appropriate
directory. This document, for example, is starting its life in the
html directory and will be checked into CVS soon to live there
forever. Of course, sometimes I goof up and then I have to resort
to the usual tricks to move files in CVS. And so the first rule of
CVS home directories is it pays to think before starting and get
the right filename and location the first time. Don't be too
impatient to check in the file.
</p><p>CVS is a great way to ensure that you have a nice, clean,
well-managed home directory. Every time I <b  >cvs
update</b> it will helpfully complain to me about any files
it doesn't know about. Of course, I make heavy use of .cvsignore
files in some directories (like tmp/).</p><p>If I go to another machine, the home directory looks pretty
much the same, though various things might be missing:</p><pre     class="programlisting">
joeyh@auric:~&gt;ls
CVS/  GNUstep/  bin/  tmp/
</pre><p>I use this machine for occasional specific shell purposes. I
don't administer the system, so I don't want to put private files
there. The result is a much truncated version of my home directory.
It's perfectly usable for everything I normally do on that machine,
and if I want to, say, work on this document there at some point, I
can just type <b  >cvs co html</b> and a password and be
on my way.
</p><p>The way I make this partial-checkouts system work is by using
CVS modules and aliases. I have modules defined for each of the
top-level directories and for the home directory (dot files)
itself. For example, the entry in my CVSROOT/modules file for the
stripped-down version of my home directory looks like this:</p><pre     class="programlisting">
joeyh -u cvsfix -o cvsfix joey-cvs/home &amp;bin
</pre><p>For more complete home directories, I use this instead:
<pre     class="programlisting">
joey -u cvsfix -o cvsfix joey-cvs/home &amp;src &amp;doc
&amp;debian &amp;html &amp;lib &amp;.hide &amp;bin &amp;mail
</pre>


Notice the .hide module. It results in a ~/.hide directory when I
check it out. This directory is where I put the occasional private
file that I don't want to appear in home directories&mdash;like the one
on auric&mdash;that are on systems not administered by me. The files in
.hide get hard-linked to their proper locations if .hide is checked
out, so I can put confidential dot files in there and only check
those dot files out on trusted systems. I also have, for example,
my Mozilla cookies file in .hide.
</p><p>It's important to distinguish between such files that I need
to put in .hide and the entire set of private directories, like my
mail directory. Yes, I keep my mail in CVS (except for just-arrived
spooled mail, which I keep synced up with a neat little program
called isync that is smarter about mail than CVS is). But it's all
in its own mail/ directory, so I can omit checking that directory
out to systems that I don't trust with my mail or that I don't want
to burden with hundreds of megabytes of mail archives.</p><p>While I'm discussing privacy issues, I should mention that I
make some bits of my home directory completely open to the public.
This includes a lot of free software in debian/ and src/, and some
handy little programs in bin/. This is accomplished by permissions.
I have to make sure that most directories in the repository (or at
least the top-level directories like mail/) are mode 700, so only I
can access them. Other top-level directories, like bin/, are opened
up to mode 755. This allows anonymous CVS access and browsing at
<a href="http://cvs.kitenet.net/joey-cvs/bin" target="_self">cvs.kitenet.net/joey-cvs/bin/</a>.</p><p>This leads to the second rule of CVS home directories: don't
import $HOME in one big chunk; break it up into multiple modules.
The structure of your repository need not mirror the structure of
your actual home directory. Modules can be checked out in different
locations to move things around and control access on a per-module
level. There's a layer of indirection there, and such layers always
make things more flexible and more complex.</p><p>Some of the projects I work on have their own CVS
repositories that are unconnected to my big home directory
repository. That's fine too; I simply check them out into logical
places in my home directory tree as needed. CVS can even be tweaked
to recurse into those directories when updating or
committing.</p><p>Another thing to notice in those lines from my modules file
is the use of <b  >-u cvsfix</b> to make the cvsfix
program run after CVS updates. That program does a lot of little
things, including ensuring that permissions are correct, setting up
the hard links to files in .hide and so on.</p><p>One last thing to mention is the issue of heterogeneous
environments and CVS. Most of my accounts are on systems running
varying versions of Debian Linux on a host of different
architectures, but there are accounts on other distributions, on
Solaris and so forth. Trying to make the same dot files work on
everything can be interesting. My .zshrc file, for example, goes to
great pains to detect things like GNU ls, deals with varying zsh
versions, sets up aliases to the best available editor and other
commands and so on. Other programs, like .xinitrc, check the host
they're running on and behave slightly (or completely) differently.
I've even at one point had a .procmailrc that filtered mail
differently depending on hostname, though the trick to doing that
is lost somewhere in one of the innumerable versions stored in my
repository. I've even resorted in a few places to files with names
of the form filename.hostname&mdash;cvsfix finds one matching the
current host and links it to the filename. Branches are also a
possibility, of course, but despite my heavy use of CVS, I still
find some corners of it a black art.</p><p>Well I guess that's it. I'd be happy to hear from anyone else
who keeps their home directory in CVS, especially if you have some
tricks to share. In the future I'd like to try checking /etc into
CVS too, and if you've successfully done this, I'd love to talk
with you. Now I'm off to commit this file.</p></div></div>
<div class="authorblurb"><p><span   class="bold"><b>Joey Hess</b></span>
      (<a href="mailto:joey@kitenet.net">joey@kitenet.net</a>) is
      a longtime Debian developer who lives on a farm in Virginia. He
      enjoys finding new and unlikely places from which to commit code
      wirelessly to CVS.</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../101/toc101.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>