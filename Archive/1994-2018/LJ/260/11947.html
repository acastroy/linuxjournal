<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>The Open-Source Classroom</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;BirdCam 3.0? Check out Shawn's latest improvements to BirdTopia.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x1e4a580.0x1f41ac0"></a>The Open-Source Classroom</h1></div><div><h3 class="subtitle"><i>
BirdCam, Round Three
</i></h3></div><div><div class="author"><h3 class="author">
Shawn
 
Powers
</h3></div><div class="issuemoyr">Issue #260, December 2015</div></div><div><p>
BirdCam 3.0? Check out Shawn's latest improvements to BirdTopia.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x1f42358"></a></h2></div></div><p>
I've been writing for <span   class="emphasis"><em>Linux Journal</em></span> since 2007 when I shared the process I
used to make my own MAME arcade cabinet. Out of all the projects, how-tos,
reviews and silliness I've written, nothing has gotten more feedback
and discussion than my BirdCam. It's been more than a year since I last wrote
about my setup, and since that time, I've moved to a new city and upgraded
my cameras and software significantly. So to answer many of the questions
I get about the current state of BirdCam, I figured I'd write about the
technical details and hopefully inspire similar projects or upgrades
for others. Plus, I get to talk about BirdCam, and that's just pure fun!
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x1f42568"></a>
A Short Refresher</h2></div></div><p>
If you weren't with <span   class="emphasis"><em>LJ</em></span> two years ago when I first wrote about BirdTopia,
I'll quickly catch you up. I have a bunch of bird feeders in my
backyard, right outside my office window (Figure 1). I decided
it would be awesome to put a public Webcam on them, but I didn't want
to pay for LiveStream or anything like that. In fact, I wanted it to
be strictly image-based instead of video. The initial article is at <a href="http://www.linuxjournal.com/content/its-bird-its-another-bird" target="_self">www.linuxjournal.com/content/its-bird-its-another-bird</a>.
Like most folks, I
fiddle with things constantly, and BirdCam changed so much, I followed
up later with an article on my improvements, including how I create a daily
video archive: <a href="http://www.linuxjournal.com/content/birdcam-round-two" target="_self">www.linuxjournal.com/content/birdcam-round-two</a>.
</p><div       class="mediaobject"><a href="11947f1.large.jpg"><img src="11947f1.jpg"></a><div class="caption"><p>
Figure 1. BirdCam now has far less clutter, but way more appeal.
</p></div></div><p>
If you don't want to take the time to read those articles, no worries. The
TL;DR version is that I take periodic snapshots of my bird feeders, and
have an auto-refreshing Web page that shows a 1&ndash;2FPS &ldquo;video&rdquo;, which is
hosted at <a href="http://birds.brainofshawn.com" target="_self">birds.brainofshawn.com</a>. (Don't worry about swamping my
home connection; the feed is scaled to the cloud&mdash;the details of which
are also in the initial article!)
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x1f42a38"></a>
New Hardware</h2></div></div><p>
This is by far the most frustrating development with my BirdCam setup. I
want to move the bulk of the cameras outside so my office window isn't
cluttered with wires, and also so the reflection of my new south-facing
window doesn't cause J.J. Abrams-like lens flare. Unfortunately, finding
an outdoor camera with the same image quality as my repurposed Galaxy
S2 phone is difficult. I'm sure there are $500 Axis-brand cameras that
have great image quality and an ability to pull still images, but that's
way beyond my price range.
</p><p>
I have had decent luck with the $79 Foscam FI9803P camera. It does 720p,
and with a convoluted URL, it's possible to pull still images from
it. It struggles with lens flare much like my cameras pointing through
the window, but it's tolerable. With an outdoor camera, I don't have
the problem of window reflection recording <span   class="emphasis"><em>me</em></span> in my office as evening
approaches. Nobody wants to stare at me in the reflection, but with
window-based cameras, that happens most evenings. I've contacted several
companies selling outdoor-rated cameras, and most of them require the
use of a proprietary app to view images.
</p><p>
I also attempted to use a Dropcam (Nest cam now I guess), and although the
super-wide angle is nice, and it <span   class="emphasis"><em>is</em></span> possible to pull still images, the
cloud-only factor is a showstopper for me. I don't want to use constant
bandwidth to send video to the cloud when all I want is to pull still
images. Perhaps there's a way to hack the firmware, but out of the box,
a Dropcam uses too much bandwidth for my purposes. If anyone knows of an
affordable 720p or 1080p outdoor security camera with optical zoom and
the ability to pull stills via http(s), please let me know. I'm actually
considering building a small heated box with a window in order to put an
old Android phone outside. The photo quality on cell phones is so amazing,
it will be hard to beat an Android device running IP Cam.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x1f42ca0"></a>
HTML Updates</h2></div></div><p>
You may recall one of the problems I had with BirdCam was to get
JavaScript that would regularly refresh the page and work across
multiple browsers and platforms. The code I posted last time did
mostly work, but I managed to come up with JavaScript that is seemingly
foolproof. I also updated the CSS to handle resizing of the main
page better and split BirdCam into three separate pages. The result is clickable
thumbnails that &ldquo;refocus&rdquo; the page. Listing 1 shows the format of each page,
the only difference being that with the other two pages, the links and
images are rearranged. I've added comments to each section explaining
the functionality.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x1f42e58"></a></h2></div></div><div class="sidebar"><p class="title"><b>Listing 1. house.html</b></p><pre     class="programlisting">
&lt;!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" 
 &#8618;"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"&gt;
&lt;html xmlns="http://www.w3.org/1999/xhtml"&gt;

&lt;!-- The above lines officially denote this as the 
type of html file we need --&gt;

&lt;head&gt;
&lt;title&gt;The birds. Or not.&lt;/title&gt;

&lt;!-- All these meta tags are to stop browsers and/or 
servers from caching images. They are largely redundant, 
but all are required because various browsers expect
different meta tags --&gt;

&lt;meta http-equiv="cache-control" content="max-age=0" /&gt;
&lt;meta http-equiv="cache-control" content="no-cache" /&gt;
&lt;meta http-equiv="expires" content="0" /&gt;
&lt;meta http-equiv="expires" content="Tue, 01 Jan 1980 
 &#8618;1:00:00 GMT" /&gt;
&lt;meta http-equiv="pragma" content="no-cache" /&gt;
&lt;meta http-equiv="Content-Type" content="text/html; 
 &#8618;charset=iso-8859-1" /&gt;
&lt;meta name="viewport" content="width=device-width; 
 &#8618;initial-scale=1; minimal-ui"&gt;
&lt;/head&gt;

&lt;!-- The body and div tags specify the web page should 
go edge to edge, and not stretch beyond 1280px --&gt;

&lt;body style="margin:0px;padding:0px;outline:none;border:0px"&gt;
&lt;div style="width:100%;max-width:1280px;position:relative"&gt;

&lt;!-- Each of these are thumbnails placed exactly in the 
corners of the main image, they link to other pages which 
are exactly like this page, but with the images reordered. --&gt;

&lt;a href="window2.html"&gt;
&lt;img style="width:25%;max-width:1280px;z-index:200;position:
&#8618;absolute;top:0px;left:75%" src="window2.jpg?time=" /&gt;
&lt;/a&gt;
&lt;a href="window.html"&gt;
&lt;img style="width:25%;max-width:1280px;z-index:200;position:
&#8618;absolute;top:0px;left:0%" src="window.jpg?time=" /&gt;
&lt;/a&gt;

&lt;!-- This image is the main image for the page. There's a 
note to click the thumbnails to switch --&gt;

&lt;img style="width:100%;max-width:1280px;z-index:100;position:
&#8618;relative;top:0px;left:0%" src="house.jpg?time=" /&gt;
&lt;center&gt;&lt;em&gt;Click on smaller images to switch camera 
 &#8618;views&lt;/em&gt;&lt;/center&gt;
&lt;/div&gt;

&lt;!-- This Javascript is the magic. It basically reloads the 
images every 2 seconds, adding ?time=TIMESTAMP to each image 
so the server fetches it fresh. I can mostly follow its logic, 
but I'm not sure why it works so much more consistently than my 
previous attempts. Nevertheless, it seems perfect. --&gt;

&lt;script&gt;
  setInterval(function() {
      var images = document.images;
      for (var i=0; i&lt;images.length; i++) {
          images[i].src = images[i].src.replace(/\btime=[^&amp;]*/, 
           &#8618;'time=' + new Date().getTime());
      }
  }, 2000); // 10000 milliseconds = 10 seconds
  &lt;/script&gt;
&lt;/body&gt;
&lt;/html&gt;
</pre></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x1f43068"></a>
Image Changes</h2></div></div><p>
If you visit <a href="http://birds.brainofshawn.com" target="_self">birds.brainofshawn.com</a>, you might notice there no
longer are text overlays with sunset info and so on. I might add the temperature
back, but I found the rest to be overkill. Instead, there is a timestamp
on each photo in the corner, and that's it. That means my daily archive
videos have a really nice &ldquo;clock&rdquo; you can watch while they play. If you
head over to the BirdCam YouTube channel, you can see what I'm talking
about (<a href="http://snar.co/windowcam" target="_self">snar.co/windowcam</a>). I've noticed with frustration that
most of the video footage in the new house is &ldquo;DogCam&rdquo;, because my dogs
wander back and forth in front of the cameras constantly. We're planning
to change where the dogs are allowed in the yard, so hopefully that will
end soon.
</p><p>
With the simplification of images, I hope to add two more cameras
eventually, if I find cameras I like. I think adding thumbnails to the
bottom corners will keep the display fairly neat and provide easy access
to more bird action. At least one of the new views will be a hummingbird
camera once spring arrives, so check the feed periodically to see what
happens in the future!
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x1f43380"></a>
YouTube Updates</h2></div></div><p>
If you've tried to create an automated YouTube script based on my last
BirdCam article, you probably noticed it no longer works. In fact, I
didn't pay attention to the warning e-mail messages YouTube sent me, and I ended up
getting locked out of my Google account for using an old API. Thankfully,
I was able to recover my account without too much trouble, but still,
it was scary. The ytu program (a script that uploads video to YouTube)
itself needs to be updated, and the Google authentication process is
different. Also, the command-line options for ytu have changed, and
by default, videos are marked private. So in order to get an automated
process, you'll need to follow these steps:
</p><p>
1) Head over to TASVideos and download YTU version 2:
<a href="http://tasvideos.org/YoutubeUploader.html" target="_self">tasvideos.org/YoutubeUploader.html</a>.
</p><p>
2) Extract the tar.bz2 file and read the &ldquo;Obtaining Credentials.pdf&rdquo;
file. It will walk you through the (<span   class="emphasis"><em>required!</em></span>) process of getting the
credentials that will allow ytu to work. It requires you to create a new
Google developers project. Thankfully, the instructions are easy to follow.
</p><p>
3) Modify (or create!) your scripts to upload the video to YouTube. Here
is what my modified code looks like:

<pre     class="programlisting">

#!/bin/bash
/usr/local/bin/ytu/ytu \
     -permission ap \
     /processed_video/birdvideo.mp4 \
     "Video Title Here" \
     "Tags,comma,separated" \
     1 \
     &lt; /usr/local/etc/description.txt

</pre>
</p><p>
Notice the <tt  >-permission ap</tt>, which makes the video public. Supposedly
videos are public by default, but that wasn't the case for me, and I had
to add that option manually. Also, the <tt  >1</tt> on the line by itself is the
category ID. 1 is film and animation, but ytu will give you a listing
in the documentation if you want something different.
</p><p>
The mencoder stuff is all exactly the same as before. Luckily, turning
thousands and thousands of images into a video is still really easy. Be
sure to read my last BirdCam article for more details.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x1f43850"></a>
Compensating for the Earth's Tilt</h2></div></div><p>
It has annoyed me for a couple years now that I basically had to
guess when to turn the cameras on and off for the night. In fact,
I usually just leave things on overnight, and hope the lack of light
stops the cameras from recording any motion. A few 12-hour videos of my
screensaver reflected in the window caused me to research the problem
a little more. Here's what I came up with.
</p><p>
There's a cool program called sunwait developed by Dan Risacher
in 2004 that calculates sunrise/sunset times based on latitude and
longitude. It's no longer being developed, but it compiles easily and
works well even with modern distributions. You can get the program from
<a href="https://www.risacher.org/sunwait" target="_self">https://www.risacher.org/sunwait</a>.
</p><p>
The program does two things for me:
</p><p>
1) It gives the sunset/sunrise data, which I then can update daily and
store in my /etc folder, which I use as a test to determine whether I should
download images from my cameras.
</p><p>
2) It literally will &ldquo;wait&rdquo; on the command line when invoked until sunrise
or sunset. This is useful because I have it &ldquo;wait&rdquo; for sunset, then kill
off the motion program. Then in the morning, I have it &ldquo;wait&rdquo; for sunrise
and start motion back up.
</p><p>
The simplicity is brilliant, and it has required me to change my scripts a
bit. Here's the script I use to get sunrise and sunset times. Specifically,
I pick &ldquo;Civil&rdquo; sunrise and sunset, which aligns with &ldquo;when you can still
see&rdquo; rather than the actual time the sun sets. For camera purposes, it's
far more useful. I call the program &ldquo;sun&rdquo; in the /usr/local/bin folder:

<pre     class="programlisting">
#!/bin/bash
if [ $1 == "-rise" ]
then
/usr/local/bin/sunwait -p 45.3733N 84.9553W | 
 &#8618;grep Civil | awk -F" " '{print $4}'
elif [ $1 == "-set" ]
then
/usr/local/bin/sunwait -p 45.3733N 84.9553W | 
 &#8618;grep Civil | awk -F" " '{print $7}'
else
echo 'Type either "sun -rise" or "sun -set"'
fi
</pre>
</p><p>
Then in the root user's crontab, I have these two entries:

<pre     class="programlisting">
1 4 * * * /usr/local/bin/sun -rise &gt; /etc/sunrise
2 4 * * * /usr/local/bin/sun -set &gt; /etc/sunset
</pre>
</p><p>
So every morning around 4am, the sunrise and sunset data is updated on
my computer. Then I have two crontab entries as my normal birdcam user,
which starts and stops motion at the proper time:

<pre     class="programlisting">
0 16 * * * /usr/local/bin/sunwait civ down 45.3733N 
 &#8618;84.9553W; pkill motion
0 5 * * * /usr/local/bin/sunwait civ up 45.3733N 84.9553W; 
 &#8618;pkill motion; sleep 10; motion
</pre>
</p><p>
Those lines start sunwait well in advance of any sunset or sunrise, and
start or kill motion accordingly at the right time. (The start script
kills off motion, in case the computer was restarted and motion already
is running.) Finally, the birdcam user has one more cronjob that puts
&ldquo;off-line&rdquo;
photos for the Web server to use:

<pre     class="programlisting">
2 16 * * * /usr/local/bin/sunwait civ down 45.3733N 84.9553W; 
 &#8618;sleep 30; cp /offline.jpg &gt; /dev/shm/house.jpg
</pre>
</p><p>
As far as the script that fetches images from my IP camera, I have a
conditional loop that runs like the following:

<pre     class="programlisting">
#!/bin/bash

#Variables -- change to fit your needs
TEMP_PHOTO=/dev/shm/.housetemp.jpg
SUNRISE=`cat /etc/sunrise`
SUNSET=`cat /etc/sunset`
TIME=`date +%k%M`
# Get Photos, or offline photos if cameras offline

if [ $TIME -gt $SUNRISE -a $TIME -lt $SUNSET ]
then
   if eval "ping -c 1 192.168.1.178 &gt; /dev/null"
   then
     /usr/bin/wget -r --timeout=5 --quiet -O \
     $TEMP_PHOTO \
     "http://192.168.1.178:88/cgi-bin/CGIProxy.fcgi?cmd=
&#8618;snapPicture2&amp;usr=admin&amp;pwd=passwd"
     mv $TEMP_PHOTO /dev/shm/house.jpg
   fi
sleep 2
rm -rf /dev/shm/.house*
fi
</pre>
</p><p>
What does all that do? Well, if you follow the logic in the cronjobs and
scripts, you should find that at sunrise every day, the motion program is
started, and my script for downloading images from the IP camera starts
fetching images. At sunset, motion is killed off, and the off-line image is
put in place. Since this updates every day, my camera follows the pattern
of the sun throughout the year, even honoring Daylight Savings Time!
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x224ef58"></a>
Your Own Project</h2></div></div><p>
It's very unlikely you're as nuts about birds as I am. Thankfully, much of
the stuff I use for BirdCam easily can be adapted to other projects. I'm
absolutely loving the ability to schedule things according to the sunrise
and sunset at my locale. If nothing else, that is a powerful tool for
managing scripts. Hopefully you're able to get as much joy from creating
your own projects as I get from BirdCam! (And really, don't hesitate to
e-mail me about good IP cameras, I'm having a tough time coming up with
decent options.)
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1e4a580.0x224f060"></a></h2></div></div><div class="sidebar"><p class="title"><b></b></p><p>Send comments or feedback via <a href="http://www.linuxjournal.com/contact" target="_self">www.linuxjournal.com/contact</a> or to
<a href="mailto:info@linuxjournal.com">info@linuxjournal.com</a>.
</p></div></div></div>
<div class="authorblurb"><p>
Shawn Powers is the Associate Editor for <span   class="emphasis"><em>Linux
Journal</em></span>. He's also the
Gadget Guy for LinuxJournal.com, and he has an interesting collection
of vintage Garfield coffee mugs. Don't let his silly hairdo fool you,
he's a pretty ordinary guy and can be reached via e-mail at
<a href="mailto:info@linuxjournal.com">info@linuxjournal.com</a>. Or, swing by the #linuxjournal IRC
channel on Freenode.net.

</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../260/toc260.html">Issue Table of Contents</a>
    <a class="link3" href="../260/11947.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>