<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
At the Forge
</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;Want to add real-time collaboration to your Web application? Mozilla's&#10;TogetherJS is worth a look.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x20da580.0x21d1ac0"></a>
At the Forge
</h1></div><div><h3 class="subtitle"><i>
TogetherJS
</i></h3></div><div><div class="author"><h3 class="author">
Reuven
 M. 
Lerner
</h3></div><div class="issuemoyr">Issue #239, March 2014</div></div><div><p>
Want to add real-time collaboration to your Web application? Mozilla's
TogetherJS is worth a look.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x20da580.0x21d2358"></a></h2></div></div><p>
When Tim Berners-Lee invented the World Wide Web more than 20 years
ago, he did it in the hopes that physicists would be able to
collaborate easily with one another over the Internet. Since then,
the Web has grown and morphed into a new medium that handles
everything from newspapers to finance to supermarkets.
</p><p>
And yet, although we can marvel at the large number of things we can
do on the Web nowadays, the original idea that drove it all, of
collaboration, is still a bit of a dream. Sure, we have sites like
GitHub, which provide a Web interface to the Git version-control
system. And of course, we have plenty of writing systems, such as
WordPress, that allow a number of people to create (and publish)
documents. And there's also Facebook, which sometimes can be seen as
collaborative.
</p><p>
But if you really think about it, we still don't have the sort of
seamless collaboration we originally thought might be possible
via the Web. Sure, I can work on something, hand it to others,
and then work on it again when they are done with it, but it's still
relatively rare to have collaborative tools on-line.
</p><p>
Perhaps the most sophisticated and widespread example of real-time,
Web-based collaboration is Google Docs (now known, I think, as Google
Drive). It's true that Google's applications make it possible for
you to store your documents in the cloud, as people now like to say.
And it's certainly convenient to be able to read and write your
documents from anywhere, so long as you have access to a Web browser.
But for me, the real power of Google Docs is in the collaboration.
Many different people can work on the same document, and they even
can do so at the same time. I found this sort of collaboration to be
invaluable when I had to work with several other people to put
together a budget on a project several years ago. The fact that we
could all, from our own computers, edit the same spreadsheet in real
time was quite useful.
</p><p>
There are a number of open-source alternatives to Google's word
processor as well. Etherpad was released as an open-source project
after its authors were acquired by Google several years ago. You can
download and install Etherpad on your own, or you can take advantage
of one of the existing Etherpad servers on-line. Another interesting
application is Ace, a browser-based programming editor with impressive
collaborative abilities.
</p><p>
Now, I never would claim that all collaboration needs to be in real
time. There are many examples in the open-source world of people
communicating and collaborating asynchronously, using e-mail and Git
to work together&mdash;often quite effectively, without the bells and
whistles that real-time collaboration seems to offer.
</p><p>
However, for many of us, collaboration without a real-time component
is always missing something. It would be great for me not only to be
able to talk to someone about a Web site, but also to look at it (and edit
its content) along with them, in real time. Yes, there are
screen-sharing systems, such as VNC, Join.me and ScreenHero, but
they require that you install something on your computer and that you
activate it.
</p><p>
That's why I have become interested in a project sponsored by the
Mozilla Foundation known as TogetherJS. As the name implies,
TogetherJS is a JavaScript-based, real-time collaboration system. The
most impressive thing, in my opinion, is how much TogetherJS provides
out of the box, with little or no configuration. It allows you to
make your site more collaborative by adding some simple elements to
each page.
</p><p>
So in this article, I want to look into TogetherJS&mdash;what it does, how you
can add it to your own sites, and how you even can connect your
application to it, creating your own, custom collaborative experience.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x20da580.0x21d2828"></a>
What Is TogetherJS?</h2></div></div><p>
TogetherJS is a project sponsored by the Mozilla Foundation (best
known for the Firefox browser and the Thunderbird e-mail client).
Mozilla has been developing and releasing a growing number of
interesting open-source tools during the past few years, of which
TogetherJS is one of the most recent examples. (In recent months, for
instance, Mozilla also released Persona, which attempts to let you
sign in to multiple sites using a single identity, without tying it to
a for-profit company.) TogetherJS was released by &ldquo;Mozilla
Labs&rdquo;,
which, from the name and description, suggests this is where Mozilla 
experiments with new ideas and technologies.
</p><p>
On a technical level, TogetherJS is a client-server system. The
client is a JavaScript library&mdash;or more accurately, a set of
JavaScript libraries&mdash;loaded onto a Web page, which then communicates
back to a server. The server to which things are sent, known in
TogetherJS parlance as the &ldquo;hub&rdquo;, runs under node.js, the
JavaScript-powered server system that has become quite popular during
the past few years. The hub acts as a simple switchboard operator,
running WebSockets, a low-overhead protocol designed for real-time
communication. Thus, if there are ten people using TogetherJS, divided
into five pairs of collaborators, they can all be using the same
hub, but the hub will make sure to pass messages solely to the
appropriate collaborators.
</p><p>
Installing TogetherJS on a Web site is surprisingly easy. You
first need to load the TogetherJS library into your page. This is
done by adding the following line into your Web application:


<pre     class="programlisting">

&lt;script src="https://togetherjs.com/togetherjs-min.js"&gt;&lt;/script&gt;

</pre>
</p><p>
Of course, you also can host the JavaScript file on your own server,
either because you want to keep it private or internal, or if you are
modifying it, or if you simply prefer not to have it upgrade each time
Mozilla releases a new version.
</p><p>
That JavaScript file doesn't actually do much on its own. Rather, it
checks to see whether you want to download a minimized version of the code.
Based on that, it decides whether to download all of the code
in a single file or in separate ones. Regardless of how you download
TogetherJS, the above line ensures that the JavaScript component is
ready to work.
</p><p>
But of course, it's not enough to install the JavaScript. Someone
needs to activate and then use it, which means installing a button on
your Web site that will do so. Once again, because of the way
TogetherJS is constructed, it's pretty straightforward. You can
install the following:

<pre     class="programlisting">
&lt;button id="start-togetherjs" type="button"
        onclick="TogetherJS(this); 
    &#8618;return false"&gt;Start TogetherJS&lt;/button&gt;
</pre>
</p><p>
In other words, you create a button that, when clicked, invokes the
TogetherJS function. When users click on that button, they will be
added to TogetherJS. Now, this is actually pretty boring; if you're
running TogetherJS by yourself, it's not going to seem to be
doing very much. Once you click on the TogetherJS button, and after
you click through the first-time introduction, you'll immediately be
given a link, labeled &ldquo;invite a friend&rdquo;. In my particular case,
running this on port 8000 of my server, I get
http://lerner.co.il:8000/togetherjs.html#&amp;togetherjs=oTtEp6wmoF.
</p><p>
As you can see, the TogetherJS special-invitation URL combines the URL
of the page you own, along with a token that uniquely identifies
your session. This allows multiple sets of people to collaborate on
the same page, with each set existing in its own, isolated
environment.
</p><p>
For example, togetherjs.html (Listing 1) is a file that I put up on
my server. I opened two separate browsers onto that page, one via the
direct URL and the second by using the full URL shown above, with a
specific confirmation token. Once both browsers were pointing to the
site, and once both users had confirmed their interest in
collaborating and using TogetherJS, I found that either user could
modify the content of the &ldquo;textarea&rdquo; tag, and that no matter who was
typing, the changes were reflected immediately on the other person's
computer. In addition, each click of the mouse is displayed
graphically. And if one user goes to a different page on the site
(assuming that the TogetherJS library is on the other page as well),
TogetherJS will ask the other user if he or she wants to follow along.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x20da580.0x21d2eb0"></a></h2></div></div><div class="sidebar"><p class="title"><b>
Listing 1. togetherjs.html</b></p><pre     class="programlisting">
&lt;!DOCTYPE html&gt;
&lt;html&gt;
  &lt;head&gt;
    &lt;title&gt;Collaborate!&lt;/title&gt;
  &lt;/head&gt;
  &lt;body&gt;
    &lt;h1&gt;Collaborate!&lt;/h1&gt;
    &lt;textarea&gt;Hello out there!&lt;/textarea&gt;
    &lt;script src="https://togetherjs.com/togetherjs-min.js"&gt;
    &#8618;&lt;/script&gt;
    &lt;div id="togetherjs-div"&gt;
      &lt;button id="start-togetherjs" type="button"
              onclick="TogetherJS(this); return false"
              data-end-togetherjs-html="End TogetherJS"&gt;Start
               &#8618;TogetherJS&lt;/button&gt;
    &lt;/div&gt;
  &lt;/body&gt;
&lt;/html&gt;
</pre></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x20da580.0x21d30c0"></a>
Configuration and Customization</h2></div></div><p>
It's great and amazing that TogetherJS works so well, immediately upon
installing it. However, there also are ways you can configure
TogetherJS, so it'll reflect your needs. Because of the way
TogetherJS is loaded, it's recommended that you make these
configuration settings before TogetherJS has been loaded. For
example:


<pre     class="programlisting">

&lt;script&gt;
    var TogetherJSConfig_siteName = "Reuven's page";
&lt;/script&gt;
&lt;script src="https://togetherjs.com/togetherjs-min.js"&gt;&lt;/script&gt;

</pre>
</p><p>
All of the configuration variables begin with
<tt  >TogetherJSConfig_</tt> and
have names that are fairly descriptive. A full list is on the
TogetherJS site at
<a href="https://togetherjs.com/docs/#configuring-togetherjs" target="_self">https://togetherjs.com/docs/#configuring-togetherjs</a>, but you also
can look through the together.js code, which contains comments describing
what the configuration variables do.
</p><p>
For example, if you decide you want to run your own hub (that is, a
message-passing, WebSockets-based server), you must tell
TogetherJS to look in a different location, with
<tt  >TogetherJSConfig_hubBase</tt>.
</p><p>
Other useful configuration variables are:
</p><div class="itemizedlist"><ul type="disc"><li><p>
<tt  >TogetherJSConfig_useMinimizedCode</tt>: downloads the minimized
JavaScript files for the rest of TogetherJS.
</p></li><li><p>
<tt  >TogetherJSConfig_inviteFromRoom</tt>: allows you to think about
collaboration on a site-wide basis.
</p></li><li><p>
<tt  >TogetherJSConfig_youtube</tt>: when set, this means that if one
person views a YouTube video, everyone will, and they
will be synchronized.
</p></li></ul></div><p>
But, TogetherJS provides more than just the ability to configure and
use it. You also can extend it. The same message-passing system that
TogetherJS uses for itself is available to developers. Thus, you can 
send arbitrary messages, for arbitrary events, between all of the
people currently collaborating on this system.
</p><p>
In order to send an arbitrary JSON message, all of the parties
involved need to agree on the message &ldquo;type&rdquo;&mdash;that is, the
string that you will use to identify your message. All parties 
also need to register their interest in receiving messages of this
type and to define a callback function that will fire when the
message is sent. Although it makes sense to do this within the HTML or
JavaScript in your application, it's also possible to do it in your
favorite browser's JavaScript console.
</p><p>
First, you register interest in your object by telling TogetherJS that
whenever it receives a message of a certain type from a hub (using the
<tt  >TogetherJS.hub.on</tt> methods), it should fire a particular callback:

<pre     class="programlisting">
TogetherJS.hub.on("reuvenTest",
        function (msg) {
            console.log("message received: " + msg)
 }
);
</pre>
</p><p>
Now, it's true that because your message is an object, it will be
printed as &ldquo;[Object object]&rdquo; in the Web console, which is really too
bad. If you prefer, you can choose individual fields from the object,
but be sure that you know what fields you will be receiving.
</p><p>
To send a message, just invoke <tt  >TogetherJS.send</tt> along with a JSON
object that will be sent to all of the other TogetherJS subscribers on
this channel. There is no way to send a message to one particular
computer; in this way, the paradigm is similar to what you probably saw with
real-time Web updates with Pusher and PubNub last year.
</p><p>
To send a message, you use the following:

<pre     class="programlisting">
TogetherJS.send({type: "reuvenTest", foo: 
 &#8618;'foofoo', bar: 'barbar'});
</pre>
</p><p>
I should note that both of these methods return undefined to the
caller. Normally, this isn't a problem, but if you're working in the
console, you might not expect such a response.
</p><p>
Of course, the power of this communication channel is in deciding what
you want to communicate, and what should happen when communication
comes in. When a message arrives, do you want to change the way
something is displayed on the receivers' screens? Do you want
to display a message for the user?
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x20da580.0x25cbf70"></a>
Conclusion</h2></div></div><p>
TogetherJS is relatively new, and I am still in the early stages of
using it in my applications that require real-time collaboration.
That said, TogetherJS is an interesting application in and of itself,
and it was designed as a platform that will continue to grow and expand.
With TogetherJS, we are one additional step closer to using the Web
for new and different forms of collaboration.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x20da580.0x25cc078"></a></h2></div></div><div class="sidebar"><p class="title"><b>
Resources</b></p><p>
The home page for TogetherJS is <a href="http://togetherjs.com" target="_self">togetherjs.com</a>, but the GitHub
page is <a href="https://github.com/mozilla/togetherjs" target="_self">https://github.com/mozilla/togetherjs</a>. You can use
TogetherJS with any modern browser, which basically means that it does
not support Internet Explorer. I was able to get it to work with
Firefox, Chrome and Safari (on OS X) without any problems. Note:
TogetherJS explicitly states that it doesn't support Internet
Explorer very well, including the most recent versions, which means
that if you're working in a mixed environment, it might not be a good
choice.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x20da580.0x25cc338"></a></h2></div></div><div class="sidebar"><p class="title"><b></b></p><p>Send comments or feedback via <a href="http://www.linuxjournal.com/contact" target="_self">www.linuxjournal.com/contact</a> or to
<a href="mailto:info@linuxjournal.com">info@linuxjournal.com</a>.
</p></div></div></div>
<div class="authorblurb"><p>
Reuven M. Lerner, a longtime Web developer, consultant and trainer,
is completing his PhD in learning sciences at Northwestern University.
You can learn about his on-line programming courses, subscribe to his
newsletter or contact him at <a href="http://lerner.co.il" target="_self">lerner.co.il</a>.

</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../239/toc239.html">Issue Table of Contents</a>
    <a class="link3" href="../239/11642.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>