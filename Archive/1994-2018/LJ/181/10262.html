<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Fun with the iRobot Create
</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;Let your computer reach into the physical world with the iRobot Create.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x10ba580.0x11b1ac0"></a>
Fun with the iRobot Create
</h1></div><div><div class="author"><h3 class="author">
Zach
 
Banks
</h3></div><div class="issuemoyr">Issue #181, May 2009</div></div><div><p>
Let your computer reach into the physical world with the iRobot Create.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x10ba580.0x11b22a8"></a></h2></div></div><p>
Very little in the Linux universe interacts directly with the physical
world. Although you may have peripherals that allow you to work
with the computer, the computer has no way to interact with you. This is
easily solvable by creating a robot for it to control. iRobot, famous for
its Roombas, has created an educational robot called the iRobot Create,
based on the Roomba, that is incredibly easy to work with. The Create
provides a simple base to extend upon with very little effort. Some people even have
mounted an old laptop to the robot to allow mobility, but that is
overkill for most situations. It's not hard to create a link between
a Linux box and the Create, even though it lacks official support.
</p><p>
The easiest way to interact with the Create is through a serial link using
the cable that comes with the robot. For some computers, you may need
a USB-to-serial adapter; however, they are readily available for less than
$15. The connection will be a TTY serial, such as /dev/ttyS0,
or if you are using a USB adapter, the connection most likely will show
up as /dev/ttyUSB0.
</p><p>
In order to pass commands back and forth though the serial
cable, the easiest tool to use is a serial port terminal. There are
several versions of this type of software available. Here, I use
gtkterm, a GUI terminal, but if you prefer CLI tools, both screen and
minicom will work. After installing and launching gtkterm, you have
to set the correct port under Configuration&rarr;Port. The port will be
the device specified earlier, and if you are unsure which number to choose,
you may have to try them all. The speed should be set to 57600 (baud).
The other default settings (No parity, 8-bit, 1 stopbit and no flow control)
are fine. I also prefer to turn on Local echo, which also is under
Configuration and lets you see what you type.
</p><div       class="mediaobject"><a href="10262f1.large.jpg"><img src="10262f1.jpg"></a><div class="caption"><p>
Figure 1. Configuration Options for gtkterm
</p></div></div><p>
To test the configuration, plug in the Create to charge and
connect it to your computer. The terminal should start displaying lines
such as the following every second:

<pre     class="programlisting">
bat:   min 0  sec 11  mV 16699  mA 566  deg-C 21
</pre>
</p><p>
Unless you plan on mounting a computer to the robot itself, the serial
cable will prove cumbersome as soon as the robot begins to move. To
get around this, the robot needs to go wireless. Although 802.11
Wi-Fi has become ubiquitous on laptops, it is not common on
embedded systems like the Create. Another candidate
is Bluetooth, which also is becoming widespread; however, Bluetooth
modules generally are expensive, have hit-or-miss Linux support and
are very short-ranged. Recently, Maxstream's line of XBee radios have
been gaining popularity in projects like this. They are very similar
to Bluetooth modems and are better suited for this type of project.
</p><p>
All of the parts for this project can be purchased at SparkFun and are
listed in Table 1. In addition to these items, you also will need some
basic tools and supplies, such as a breadboard, wire and a soldering iron.
</p><div class="table"><a name="N0x10ba580.0x11b2880"></a><p class="title"><b>
Table 1. SparkFun BOM</b></p><table     summary="&#10;Table 1. SparkFun BOM10262t1.qrk" border="1"><colgroup><col><col><col><col></colgroup><thead><tr><th>
Part #</th><th>Description</th><th>Quantity</th><th>Price Each</th></tr></thead><tbody><tr><td>
WRL-08664</td><td>XBee Module</td><td>2</td><td>$24.95</td></tr><tr><td>
WRL-08687</td><td>USB XBee Explorer</td><td>1</td><td>$24.95</td></tr><tr><td>
BOB-08276</td><td>XBee Breakout Board</td><td>1</td><td>$2.95</td></tr><tr><td>
PRT-08272</td><td>XBee Socket</td><td>2</td><td>$1.00</td></tr><tr><td>
BOB-08745</td><td>Level Converter</td><td>1</td><td>$1.95</td></tr><tr><td>
PRT-00116</td><td>Male Header Pins</td><td>1</td><td>$2.50</td></tr><tr><td>
COM-00526</td><td>3.3V</td><td>Regulator</td><td>1</td><td>$1.95</td></tr><tr><td>
COM-08375</td><td>0.1 uF Filtering Capacitor</td><td>1</td><td>$0.25</td><td class="auto-generated">&nbsp;</td></tr><tr><td>
PRT-08287</td><td>Male DB-25 Connector</td><td>1</td><td>$0.95</td><td class="auto-generated">&nbsp;</td></tr></tbody></table></div><p>
First, you need to configure your two XBee modules. To start, plug
one of them in to the USB XBee explorer and connect it to your computer
via USB cable (the USB XBee explorer is simply a serial-to-USB
converter board that accepts an XBee module).
Using gtkterm again, set it up to listen on a USB port
(most likely /dev/ttyUSB0), and set the speed to 9600
baud. Type into the terminal <tt  >+++</tt>, and the module should
reply <tt  >OK</tt>. 
</p><p>
The module now is ready to be configured. Type
in <tt  >ATID3330,DH0,DL1,MY0,BD6,WR,CN</tt>, and after each
comma, the
module will reply with <tt  >OK</tt>. Remove this XBee, and insert the
other one. Again, type <tt  >+++</tt>, and wait for the
<tt  >OK</tt>
to enter into configuration mode. This time, however, configure it with
<tt  >ATID3330,DH0,DL0,MY1,BD6,WR,CN</tt>. Each module is configured
to be on network 0x3330 and to send data directly to the other at 57600
baud. One module is connected to the computer, and the other to the Create.
The modules are interchangeable&mdash;either one can be connected to the computer
or the Create.
</p><p>
Next, build the circuit to connect the XBee with the Create serially.
This circuit connects the 3.3-volt XBee to the 5-volt Create.
To start, solder the two sockets into the XBee breakout board.
The easiest way to do this is to place the
sockets on the XBee module itself, flip it over, and place the breakout
board on top.
</p><p>
After the sockets are soldered, remove the module and solder four wires to
VCC, DOUT, DIN and GND.
After that, solder four more wires to the male DB-25 connector on pins 1, 2,
8 and 21. The pins should be labeled, although the markings are faint.
Next, break off two six-pin lengths from the strip of male header pins,
and solder them to each side of the level converter.
Again, it is easiest if you use the breadboard
as a jig to hold the pins straight as you solder them.
Finally, assemble everything according to the schematic (Figure 2)
and/or the breadboard wiring diagram (Figure 3).
The completed breadboard is shown in Figures 4 and 5.
</p><div       class="mediaobject"><a href="10262f2.large.jpg"><img src="10262f2.jpg"></a><div class="caption"><p>
Figure 2. Schematic for the XBee/Create Interface
</p></div></div><div       class="mediaobject"><a href="10262f3.large.jpg"><img src="10262f3.jpg"></a><div class="caption"><p>
Figure 3. Breadboard Wiring Diagram for the XBee/Create Interface
</p></div></div><div       class="mediaobject"><a href="10262f4.large.jpg"><img src="10262f4.jpg"></a><div class="caption"><p>
Figure 4. Overview of Electronics Components
</p></div></div><div       class="mediaobject"><a href="10262f5.large.jpg"><img src="10262f5.jpg"></a><div class="caption"><p>
Figure 5. Overview of the Create with All Components Installed
</p></div></div><p>
Plug the DB-25 connector in to the Create's expansion port, and remove
the command module if present. With the other XBee plugged in to your
computer, set up gtkterm to communicate with it at 57600 baud. As before,
plug the Create in to charge, and with luck, you will see some output on
the terminal, and the RX light on the USB explorer should blink. If not,
check your connections and configuration.
</p><p>
Even if you did not decide to go wireless, you still can control the
Create in exactly the same way. The Create, and most Roombas, implement
the iRobot Open Interface protocol, or OI for short. On the computer
side, let's use Python to communicate with the Create using iRobot's
implementation of OI in Python. This allows you to work on a higher
level and not worry about opcodes and such. You will need pySerial
and openinterface.py (see Resources). There is a small bug in
openinterface.py that can make it difficult to work with on Linux. The simplest
way to solve this is to run this sed command in the same directory as the
file:

<pre     class="programlisting">
$ sed -ie "803s/ - 1//" openinterface.py
</pre>
</p><p>
Alternatively, you can remove <tt  >- 1</tt> manually from line 803.
</p><p>
The library is easy to use&mdash;for example, to drive
the Create forward at full speed, do this:


<pre     class="programlisting">
import openinterface as oi
PORT = "/dev/ttyUSB0"           # change to your serial port
bot  = oi.CreateBot(com_port=PORT,mode="full")

bot.drive_straight(500)         # drive forward, full speed
</pre>
</p><p>
In order to access sensor data, you need to request it.
If you use <tt  >bot.stream_sensors()</tt>,
the Create will update the
specified sensors in each argument automatically every 15 milliseconds. To stop,
execute <tt  >bot.stop_streaming_sensors()</tt>. Although you can
specify manually which sensors you want to stream, it generally is
easiest just to stream all of them.
</p><p>
Driving also is pretty simple. <tt  >bot.drive()</tt>
takes two arguments: speed and turning radius. Speed is an integer
between 500 and &ndash;500, specifying the average speed of the wheels in
millimeters per second, with negative values corresponding to going
backward. Turning radius is a number between 200 and &ndash;200, specifying the
radius of a turn in millimeters. Positive values turn left, and negative
values turn right. There also are special methods that can be used for
going straight and turning in place.
</p><p>
The following code uses sensor data to drive and maneuver around
obstacles:


<pre     class="programlisting">
bot.stream_sensors(6)                 # packet 6 -- all sensors

while True:                           # loop forever
    if bot.sensors["bump-left?"]:     # is it pressed?
        bot.drive(-500, 10)           # spin to maneuverer
        bot.wait(5)                   # spin for 5 cycles
    elif bot.sensors["bump-right?"]:  # other direction
        bot.drive(500, 10)
        bot.wait(5)
    else:
        bot.drive_straight(500)       # otherwise, go forward
        bot.wait()                    # prevents excess cycling
</pre>
</p><p>
You can access the Create's song-playing abilities very easily too,
and you can store songs in the 17 available
song slots.
Use <tt  >bot.define_song()</tt> to store a song.
The first argument is the song slot where the song will be stored, and
you also use this value later to play the song back.
The rest of the arguments are notes, represented
by tuples of pitch and length.
Length is measured in 64ths of a second.
Call <tt  >bot.play_song()</tt> to play the song.
I'm no musical genius, so hopefully you can write a better tune:


<pre     class="programlisting">
bot.define_song(1,            # index of song
                ("G1", 16),   # note tuples
                ("G2", 16),   # note, duration
                ("G3", 64),   # 64 = 1 second
                ("G9", 16))   # up to 100 notes
# ...snip...
bot.play_song(1)
</pre>
</p><p>
To control the Create wirelessly with a joystick and
Python, we can use pygame (the full details of the pygame joystick API
are beyond the scope of the article; check the documentation
for more information):



<pre     class="programlisting">
import pygame
from pygame import locals
pygame.init()
js = pygame.joystick.Joystick(0)     # create joystick
js.init()

import openinterface as oi
PORT = "/dev/ttyUSB0"                # change to your serial port
bot  = oi.CreateBot(com_port=PORT,mode="full")

while True:
    if js.getAxis(0) &gt; 0:
        turn = 1 - js.getAxis(0)
    else:
        turn = -(1 + js.getAxis(0))
    bot.drive(js.getAxis(1)*500, turn*200)
    bot.wait()
</pre>
</p><p>
This code allows you to use a joystick (autodetected) to have
primitive control over the Create. The x-axis value has to be manipulated
so that when in a neutral position, the robot moves straight and does not spin.
</p><p>
Where to go from here? That's up to you.
On the hardware side, you can attach additional hardware
to the Create and control it through its digital inputs and outputs
(see OI specifications for pin-outs). However, with just the base
and some software, there still are tons of possibilities.
For example, you could turn the Create into an alarm clock reminiscent of Clocky,
the clock that drives around the room forcing you to get out of bed to shut it off.
Or, if you are more mathematically inclined, you could use the the
&ldquo;distance&rdquo; and &ldquo;angle&rdquo; sensors to map out a room.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x10ba580.0x11ab948"></a></h2></div></div><div class="sidebar"><p class="title"><b>
Resources</b></p><p>
SparkFun Electronics: <a href="http://www.sparkfun.com" target="_self">www.sparkfun.com</a>
</p><p>
iRobot Open Interface Specification:
<a href="http://www.irobot.com/filelibrary/pdfs/hrd/create/Create%20Open%20Interface_v2.pdf" target="_self">www.irobot.com/filelibrary/pdfs/hrd/create/Create%20Open%20Interface_v2.pdf</a>
</p><p>
pySerial: <a href="http://pyserial.wiki.sourceforge.net/pySerial" target="_self">pyserial.wiki.sourceforge.net/pySerial</a>
</p><p>
openinterface.py: <a href="http://createforums.irobot.com/irobotcreate/attachments/irobotcreate/Create_Support/792/2/openinterface.py" target="_self">createforums.irobot.com/irobotcreate/attachments/irobotcreate/Create_Support/792/2/openinterface.py</a>
</p><p>
pygame: <a href="http://www.pygame.org" target="_self">www.pygame.org</a>
</p></div></div></div>
<div class="authorblurb"><p>
Zach Banks is an experimenter who is stuck between hardware and
software. He's glad to accept comments and questions at
<a href="mailto:zjbanks@gmail.com">zjbanks@gmail.com</a>.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../181/toc181.html">Issue Table of Contents</a>
    <a class="link3" href="../181/10262.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>