<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
WIX: a Distributed Internet Exchange</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;A city-wide Ethernet opens up a world of possibilities, from&#10;letting companies share data across sites cheaply to saving&#10;ISPs from crushing demand&#10;when a local site hosts a Webcast all the users want.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0xbc7580.0xcbeab0"></a>
WIX: a Distributed Internet Exchange</h1></div><div><div class="author"><h3 class="author">
Richard
 
Hulse
</h3></div><div class="issuemoyr">Issue #135, July 2005</div></div><div><p>
A city-wide Ethernet opens up a world of possibilities, from
letting companies share data across sites cheaply to saving
ISPs from crushing demand
when a local site hosts a Webcast all the users want.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcbf240"></a></h2></div></div><p>
Wellington, the capital city of New Zealand, has
one of the oldest and possibly largest distributed
Internet exchanges in the world. It is built on top of
the Citylink public LAN infrastructure. In this article, we look at how it all started and the part Linux
plays in its day-to-day operation.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcbf348"></a>
History</h2></div></div><p>
Back in the 1980s, Richard Naylor, then IT manager for the Wellington
City Council, was stuck with a common but difficult problem&mdash;an
over-utilized VAX cluster at one data centre and an under-utilized one at
another centre across town. He came up with an idea that was unique for
the time: run a fibre optic cable between the two council buildings and
share processing resources that way. The idea was so new that a jointer
had to be flown down from Auckland to do the splices on the now-ancient
slotted core cable.
</p><p>
Naylor set up a 10Mbps Ethernet connection using DECBridges, and the network
itself was running DECnet on a 10-base5 and a little 10-base2. Terminals
comprised most of the load at the time, as PCs didn't network. The
overall idea worked, and the system was upgraded to 10-baseT in 1989, with
IP being added.
</p><p>
In the early 1990s, Naylor's idea caught the attention
of then Mayor Fran Wilde, who was intrigued by what
Naylor and colleague Charles Bagnall had been up to
in what was called &ldquo;their spare time&rdquo;. Mayor Wilde
had attended a local secondary school production and
noticed that it was being streamed live on the
Internet by an off-duty Naylor.
</p><p>
After talking with Naylor and Bagnall, Wilde came to understand what was
possible. Their design and the use of fibre could be used to provide a
broadband infrastructure for the city, and that plan became a key part
of a 25-year strategy for Wellington City.
</p><p>
Soon after, 17 investors, including the council,
came up with $5,000 each, and three drums of fibre
optic cable were run from one end of Wellington
City to the other. The cable was run along overhead
trolley bus electric support cables during November and
December 1996. The primary aim was to provide an
infrastructure to enable greater growth within the
local business community.
</p><p>
In the first few years, Citylink expanded at a rate of 100% each
year&mdash;doubling the number of connected buildings. At one point, the
team connected 50 new buildings in ten weeks.
</p><p>
In 1997, Naylor left the
council and helped set up Citylink as a separate company.
The first customers were government departments and financial
businesses, as central government is located in Wellington. Later
customers included publishers and IT companies. ISPs were there from the start too,
with many using the fibre infrastructure as a way of providing genuine
broadband to city customers at a low cost. I should note here that Citylink
does not consider domestic 1Mb and 2Mb connections to be
broadband; it prefers to start at 10Mb. Citylink can provide 10Mb, 100Mb
or 1,000Mb connections anywhere on the fibre infrastructure.
</p><p>
Nearly ten years after the initial cable was positioned, around 50 kilometres (30
miles) of cable now exists within the central business district of
Wellington. More than 300 buildings are connected.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcbf710"></a>
The Infrastructure</h2></div></div><p>
The Citylink fibre network originally was interconnected with a bunch of
oddball switches and hubs from various vendors. Over time, these have
been phased out and replaced with Cisco switches, mainly 35xx and 29xx,
on a gigabit core.
</p><p>
Citylink now offers two major services, dark fibre and Ethernet.
Dark fibre services allow point-to-point connectivity between buildings.
Each customer has sole use of his or her own strand of fibre and can connect
whatever gear is required on either end. Dark fibre runs up to 1Gb/s at
present. The Ethernet services are the most widely used and allow
customers to connect to a city-wide &ldquo;shared Ethernet&rdquo;.
</p><p>
INL, a newspaper publisher, was the first Citylink customer. The company used
dark fibre to link its corporate office to its Wellington office,
and it used Ethernet to link back to the Wellington City Council offices. From
there, a microwave link to Victoria University of Wellington provided
access to the public Internet. At that point, Citylink was involved
in providing only basic layer 2, Ethernet infrastructure.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcbf920"></a>
Routing 101</h2></div></div><p>
The Internet exchange runs on top of the fibre Ethernet infrastructure.
Before we look at this in detail, let's briefly run through a few
routing basics. A router on a network receives packets of data, each
with its own destination address. The router checks its internal list of
addresses&mdash;the routing table&mdash;to see if there is a route or path
to that destination. If there is, the packet is sent to the specified address.
This might be the final destination, or it could be a gateway&mdash;another router that
repeats the process and sends the packet on once again.
</p><p>
A traditional Internet exchange has participants connecting to a single
location, and each participant has a router. One side of the router
is connected to all of the other routers by way of a common Ethernet backbone. The
other side is connected to the participant's own network infrastructure (Figure
1).
</p><div       class="mediaobject"><a href="8073f1.large.jpg"><img src="8073f1.jpg"></a><div class="caption"><p>
Figure 1. One set of route servers&mdash;IPv4 (Soekris 4801) on the left
and IPv6 (Soekris 4501) on the right.
</p></div></div><p>
Each participant has a list of IP addresses that represent the
networks it can access. Each router has its own IP address
on the common backbone. These addresses often are private to the outside
world and act as gateways to each participant's network.
</p><p>
As a point of interest, the first Citylink routers in general use were based
on standard PC components with LS/120 floppy or disk-on-chip boot mechanisms
running the Linux Router Project (LRP). These were deployed only for
customers using wireless access points.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcbfce8"></a>
Enter BGP</h2></div></div><p>
Border Gateway Protocol (BGP) is fundamental to the operation of the
Internet, because it automates the sharing of routes by a process called
advertising. Adjacent routers establish a BGP session and advertise
their networks to the other routers. It is a bit like one router saying
to another, &ldquo;Here is my IP address. If you have traffic with any of the
following destination addresses, send it to me.&rdquo; BGP doesn't stop
there, though. Routers also share information they have gathered from other
routers. They say, &ldquo;I also know how to get traffic to some other
networks. Send that to me as well.&rdquo;
</p><p>
Typical Internet exchanges are different from the rest of the Internet and use
Internal Gateway Protocol (IGP) instead. This protocol does not pass
on information to other routers&mdash;it only advertises routes within the
networks to which it is connected. The router says, &ldquo;You can send me traffic
for these addresses, but you can't pass that address information on to
any other routers.&rdquo;
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcbff50"></a>
The Citylink Exchange</h2></div></div><p>
In 1998, Citylink started work on deploying a BGP/4-based Internet exchange
on top of the public Ethernet. One of the key design criteria was a low
cost of entry. So the Citylink team took a step back and looked at the exchange
problem from a logical point of view: what were the core requirements of an exchange, and how could they
use the existing fibre infrastructure to create an environment
that would encourage as many people as possible to join? Exchanging
traffic via an exchange is called peering.
</p><p>
A key component of Citylink's approach involved placing routers at a
customer's point of connection to the fibre infrastructure rather than
in a central location. Not a lot of options were available for BGP/4-capable
routers, though&mdash;you pretty much bought a Cisco or a Cisco (Figure
2).
</p><div       class="mediaobject"><a href="8073f2.large.jpg"><img src="8073f2.jpg"></a><div class="caption"><p>
Figure 2. The Citylink fibre (yellow cables) is converted to copper
(blue) for distribution to clients.
</p></div></div><div       class="mediaobject"><a href="8073f3.large.jpg"><img src="8073f3.jpg"></a><div class="caption"><p>
Figure 3. A typical fibre switching point, as found in many PABX rooms
around Wellington.
</p></div></div><p>Because the exchange was distributed, Citylink needed a low-cost
mechanism to allow people to peer, and so they started using Zebra on
Linux as an alternative routing platform to Cisco.
</p><p>
Because of the limited space in clients' cabinets and the need to be
able to buy the same hardware over a reasonable period of time, Citylink
now has standardized on two systems. Boards from Soekris Engineering
(4501 and 4801) are used for routers up to 30Mb/s, while Nexcom P4 GigE
and VIA 100Mb boards are used for 100Mb/s connections and
upwards to 300&ndash;500Mb/s on a good day. The Linux Embedded Appliance
Firewall (LEAF) forms the basis of all software used on Citylink routing
hardware.
</p><p>
Customers can use the Citylink routers or whatever suits their needs
and budgets. A wide variety are in use&mdash;from Dlink and Xyzel at
the low end to Juniper and Cisco boxes at the high end. A lot
of people also use their own Linux and *BSD boxes. Using PC-based routers
does limit the options for network interfaces, but this is not an issue
for Citylink, which uses only Ethernet.
</p><p>
In addition to devolving hardware to client's premises, the routing tables
for the whole exchange are managed by way of route servers, the operation of
which I explain later in this article.
</p><p>
The new exchange was dubbed WIX, the Wellington Internet Exchange. There
is a fixed monthly charge for connection, and traffic over the fibre
network is free. Because the network often runs right past a potential
user's door, it is easy for anyone to connect and
peer. And this is exactly what has happened&mdash;even end users who could never peer
under a traditional model now can. For all exchange users, access
to the global Internet still necessitates the purchase of
&ldquo;transit&rdquo;&mdash;access to the global Internet routing table&mdash;from at least one ISP.
</p><p>
The open peering approach has made a huge impact on traffic
flows and latency. When the Internet first started in New Zealand,
the country's single exchange point, at Waikato University, was also the
international gateway for the whole country. Two businesses in Wellington
wanting to exchange data would send it to their respective ISPs, who sent
it upstream to Waikato. The path time for this typically ran 50&ndash;200ms. When
ISPs began to exchange data directly in Wellington, this rate
dropped to 20ms. End-user peering reduced this by another factor of ten,
to 2ms.
</p><p>
In addition to shorter and faster network paths, no charges are levied
for traffic sent over Citylink by way of the exchange. ISPs never see
the traffic, because the exchange directs it through the shortest path to the
requesting party.
</p><p>
A number of printing companies peer at WIX and exchange huge publishing
files at no cost. One local newspaper runs an FTP server on WIX to
which pre-press companies can upload files. Some graphics houses also
run media stores for their clients, and these can browsed at no cost,
as though they were part of the client's own LAN. These are only a few
of the ways that the fibre infrastructure and WIX have helped local
businesses to lower costs, expand and innovate.
</p><div       class="mediaobject"><a href="8073f4.large.jpg"><img src="8073f4.jpg"></a><div class="caption"><p>
Figure 4. Cables coming off overhead trolley bus supports to a junction point on a
building veranda. The ability to exchange huge files at no cost
helps local businesses save money and offer new services.
</p></div></div><p>
The distributed exchange environment has been likened to a market
square&mdash;anyone can trade his or her wares with no cost for
participation. Not everyone chooses to peer openly though, and the exchange supports all
types of participation. A number of ISPs exchange traffic only with
established customers and ignore any other traffic. Some simply use
WIX as a neutral point to exchange data with one other party.
</p><p>
About 130 entities are peering at WIX, with close to 1,000 using
the Citylink fibre for private purposes or public Internet connectivity.
Encouraging peering comes with a downside though&mdash;a lot of participants
means a lot of routing tables need to be managed.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcc09a0"></a>
The Many Uses of Linux</h2></div></div><p>
In order to make route changes simpler for the hundreds of WIX users,
Citylink has deployed two route servers. Rather than having to peer with
every router on WIX, the preference is to peer with only the route servers,
dramatically simplifying route table maintenance for everyone. Each
client router, then, has to maintain only two BGP sessions&mdash;one to each
of the two route servers rather than to hundreds of routers.
</p><p>
The route servers (Figure 1) don't carry any traffic at all. They
simply reflect routes from one peer to all of the rest. I was
surprised to find that the servers are based on the same small footprint
diskless 266MHz Pentium board made by Soekris Engineering that is used
for the routers. LEAF is installed on compact Flash for reliability and
fast booting. The Quagga Routing Software Suite is used to provide BGP
services, and the kernel handles packet routing.
</p><p>
Two routers are used for redundancy, for
IPv4, and a second set provides services for IPv6.
Citylink maintains its own route registry and uses
the Routing Policy Specification Language (RPSL)
to manage the IPv4 routers. A set of shell and Perl
scripts has been developed that use RTCONFIG to
construct configuration files for the Quagga software.
All this gives Citylink tight control over what peers can announce to
the servers and ensures that a replacement can be deployed quickly
if required. The whole process is managed with Revision Control
System (RCS) to allow backups to be made and to ensure
consistency.
</p><p>
Participants on WIX may advertise only those address spaces that are within
their own individual network boundaries. The route servers re-advertise
what they learn and filter out addresses that should never be routed,
which are called Bogons. Examples of these are the loopback address,
127.0.0.1/8; other addresses allocated for private networks, such as
172.16.0.0/12; and non-assigned addresses.
</p><p>
At present, the IPv6 routers are maintained manually. When RPSL
for IPv6 is standardised, however, and the amount of work required increases
sufficiently, scripts will be used.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcc0c08"></a>
Anycast but Not Anywhere</h2></div></div><p>
One interesting technique deployed on the WIX and its sister exchange,
APE, in Auckland, is anycast routing. A good example of anycast routing
is the recent addition of a mirror of a root nameserver at WIX. Because
of the way BGP and anycast works, a query to the root server goes to
the nearest mirror automatically. If an ISP peers at WIX, it can get
a 2ms ping time. International paths are over 200ms, so this a huge
improvement.
</p><p>
Local media companies also use anycasting to provide content on the
exchange at a low marginal cost to ISPs. Rather than
having to bring content requested by their customers across expensive
international circuits, the ISPs can get it locally.
</p><p>
Anycast also can be used to limit the distribution of the traffic to
only local networks. One example of this is <span   class="emphasis"><em>The Return of
the King</em></span> premiere parade, which was Webcast using anycast
routing from downtown Wellington. Over five hours, about 12 terabytes
of data was requested by New Zealand customers, and this content was
provided at no cost to ISPs. A mirror of the stream also was provided
from a server in the USA for international viewers. Another example is
the provision of software mirrors such as one for Debian, the
distribution used by Citylink.
</p><p>
One of Citylink's biggest innovations is the provision of wireless
Internet connections in caf&eacute;s and some business premises in
Wellington. The first access point was installed in June 2002, and the
service was launched officially in November of that year. Currently,
more than 200 access points are in operation (Figure 5).
</p><div       class="mediaobject"><a href="8073f5.large.jpg"><img src="8073f5.jpg"></a><div class="caption"><p>
Figure 5. A CafeNet access point. The antenna is the small white rod on the right
side of the box.
</p></div></div><p>
One good example of how this Wi-Fi technology can benefit the community is
the recent installation of a wireless access point at the Mary Potter
Hospice for terminally ill patients. Two laptops on mobile trolleys are
used to allow patients to stay in touch with their families or simply to
read material on-line in their own time.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xbc7580.0xcb7910"></a>
Summary</h2></div></div><p>
Citylink also operates the Auckland Peering Exchange (APE), which has
about 40 peering participants. A recent addition was the Palmerston North
Internet Exchange (PNIX), which, although it has only one participant
right now, serves as a place for content providers to mirror servers.
Other exchanges are planned for other parts of New Zealand in the near future.
</p><p>
Citylink has found that Linux readily is adaptable to whatever the
company needs it to do. Having &ldquo;intelligent&rdquo; routers running Linux has meant that
deeper firewalls can be deployed; it also has given staff access to better
debugging tools. For example, TCP Dump can be used to examine traffic
through a router in real time if required.
</p><p>
The use of Linux and other open-source software has been a key enabler in
creating an affordable public Ethernet and a low cost-of-entry distributed
Internet exchange. It will continue to allow the number of exchanges to
grow and to fuel innovation and collaboration in other centres around
New Zealand.
</p><p><span   class="bold"><b>Resources for this article:</b></span>
<a href="../135/8265.html" target="_self">/article/8265</a>.
</p></div></div>
<div class="authorblurb"><p>
Richard Hulse is a broadcaster based in Wellington, New Zealand. He
currently is working on a number of IT projects that involve using
Linux to bridge between disparate systems.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../135/toc135.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>