<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Setting Up E-mail</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;    This article gives step-by-step instructions to set up your e-mail&#10;    configuration properly and an overview of various pieces of e-mail&#10;    software.&#10;    "><meta name="keywords" content="mail, novice"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x2063580.0x215aab0"></a>Setting Up E-mail</h1></div><div><div class="author"><h3 class="author">Jonathan Walther</h3></div><div class="issuemoyr">Issue #46, February 1998</div></div><div><p>
    This article gives step-by-step instructions to set up your e-mail
    configuration properly and an overview of various pieces of e-mail
    software.
    </p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2063580.0x215b450"></a></h2></div></div><p>In my time on IRC (Internet Relay Chat),
I found that the number one problem newbies have, after setting up
PPP, is e-mail setup. Many people get their e-mail half-working and
leave it at that, for fear of breaking it and not knowing how to
fix it.
</p><p>Mail handling is split up between several types of programs,
instead of having everything handled by a single program (such as
Eudora). Trust me, it is conceptually easy, and once you understand
it, very quick and easy to set up. It also gives you a lot of
flexibility.</p><p>I've included three sidebars which you may wish to read
first; in particular, the Glossary for definitions of terms I will
be using. Although there are alternative programs, I'll discuss the
ones that I use.</p><p><a href="2516s1.html" target="_self">Glossary</a></p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2063580.0x215b6b8"></a>Prerequisites</h2></div></div><p>First, you need to get an e-mail account set up by your ISP
with mail delivered to their machine. Then, you need to know your
ISP's domain and your password on the mail server (usually the same
as the password you use when you start up PPP). For the examples in
this article, we will call the ISP domain foo.com, the user name
barney and the password f00bar.</p><p>To begin, you need the following programs or their
alternatives:</p><div class="itemizedlist"><ul type="disc"><li><p>pine [or elm]</p></li><li><p>either smail or sendmail</p></li><li><p>fetchpop [or fetchmail]</p></li><li><p>procmail</p></li></ul></div><p>To find out if these programs are installed on your system,
use the command <span   class="bold"><b>which</b></span>. If you type
<b  >which <i><tt>program</tt></i></b> at the
prompt, the pathname of that program, if it exists in your path,
will be returned to the screen. For example,
<span   class="bold"><b>which</b></span> might return the path
/usr/bin/<span   class="emphasis"><em>program</em></span>, letting you know that
<span   class="emphasis"><em>program</em></span> is in the /usr/bin/ directory. All of
the basic distributions (Slackware, Debian and Red Hat) usually
include all of these programs except fetchpop, so you should have
no problem finding and installing them.</p><p><span   class="bold"><b>fetchpop</b></span> sources can be
downloaded from http://snakepit.wasteland.org/fetchpop.tgz (special
thanks to TheAsp for hosting this prepatched version on his server
so downloading it from Sunsite is unnecessary).</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2063580.0x215be48"></a>Pine</h2></div></div><p>For this example, Pine is your MUA (mail user agent). You use
it to read and write mail. Start up pine by typing
<b  >pine</b> at the prompt. When you see the opening
screen, type <b  >s</b> to call up the setup menu, then
type <b  >c</b> to go to the configuration screen. Now do
the following steps.</p><div class="orderedlist"><ol type="1"><li><p>Press <b  >enter</b> and type in the
personal name you wish to be associated with your actual e-mail
address. Mixed case and spaces are allowed (e.g., Barney Fallon).
In this case, other people will see your address as Barney Fallon
(barney@foo.com).</p></li><li><p>Set smtp-server to localhost to ensure that mail
gets handed to your local MTA (mail transport agent), where you
don't have to worry about it. The MTA then sends it off the next
time you connect. (See Glossary and Generic Mail Flow
sidebars.)</p></li><li><p>Leave the other options set to the defaults for
now.</p></li></ol></div><p>To send mail from the prompt or in a script, type:</p><pre     class="programlisting">
pine person@address.com &lt; message.file
</pre></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2063580.0x215c3c8"></a>Smail/Sendmail</h2></div></div><p>Use smail or sendmail as the MTA (mail transport agent). You
use it to transport mail between machines. People have written 600
page books on setting up these programs. The horror stories are
numerous. For this simple application, in most cases, you don't
have to do any set up. If you use Slackware, Debian or Red Hat, the
default setups for smail and sendmail work fine right out of the
box.</p><p>Some installation scripts may ask you whether to use a
smarthost, which means it will hand mail to your ISP's mail server
so it can do the delivery. That decision is up to you. There's not
much difference. If you plan to receive mail on your machine, you
might want to look at the /etc/aliases file some day.</p><p>If your user name at your ISP is barney@foo.com and you wish
this name to show up in the From: header, use sendmail to handle it
by taking the following steps:</p><div class="orderedlist"><ol type="1"><li><p>Create a user named barney on your system.</p></li><li><p>Edit the /etc/sendmail.cf file line that begins
with the characters #DM by changing it to masquerade the Domain
(DM&mdash;Domain Masquerade), e.g., DMfoo.com. If your machine has a
hostname, but not a domain name (i.e., it is not networked except
via your ISP), you may also need to edit the line #Dj$w.Foo.COM to
remove the # and change Foo.COM to your ISP's domain name. Finally,
edit the DS line to name the Domain Smart mail host, if you wish
your ISP to actually forward all your mail.</p></li><li><p>Once the changes are made and saved, just execute
<b  >SIGHUP&lt;\!s&gt;sendmail</b>, so sendmail will
re-read the sendmail.cf file.</p></li></ol></div><p>Sometimes smail or sendmail will die. You will then get a
pine error message saying the SMTP connection is not available . If
this occurs, log in as root and type <b  >smail -bd</b>
or <b  >sendmail -bd</b>. If this type of failure happens
consistently, the first thing to check is your /etc/rc* directories
to be sure that your SMTP server is started at boot up.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2063580.0x215c948"></a>Checking the Mail</h2></div></div><p>Sendmail and smail include two very handy programs for mail
checking:</p><div class="itemizedlist"><ul type="disc"><li><p><span   class="bold"><b>mailq</b></span> lets you see
any mail that is in the queue (i.e., not sent). If you aren't
connected, you can use mailq to check the queue and to remove a
mail, if you decide not to send it.</p></li><li><p><span   class="bold"><b>runq</b></span> gives smail
and sendmail a &ldquo;kick in the pants&rdquo; to start sending out the mail
that's in the outgoing queue. This command is useful if your
sendmail or smail is set up to send the mail at some specified
interval, and you want to send it earlier. Many installations have
the default interval set to 60 minutes. Not all distributions
include runq. Another way to accomplish the same result is to type
<b  >sendmail&lt;\!s&gt;-q</b> at the prompt.</p></li></ul></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2063580.0x2554f60"></a>Fetchpop</h2></div></div><p>I chose fetchpop because I think it's the easiest program to
set up. Download the sources (since it comes with none of the major
distributions), compile it and install it as root. If you are
brave, you can download it from Sunsite and apply the patch
yourself, but the source at the URL given earlier has the patch
already applied, so it will work for everyone. Without the patch,
it will fail to connect to certain POP (Post Office Protocol)
servers, with no damage.</p><p>Now, run fetchpop without parameters. (Substitute your
personal information in the place of the example names used below.)
Fetchpop will prompt you for your POP server. Enter
<b  >foo.com</b>. Then, it will ask for your user name
and password. Enter <b  >barney</b>, then
<b  >f00bar</b>. Fetchpop will then write the information
to the ~/.fetchhost file. Then, to get your mail, type:</p><pre     class="programlisting">
fetchpop -arbp
</pre><p>In the testing stages, to reassure yourself that it works,
use only the <b  >-a</b> option. If you use the
<b  >-r</b> option, any messages you fetch are removed.
The <b  >-p</b> option causes fetchpop to filter the mail
through procmail. Without the <b  >-p</b> option, the
mail is dumped in your default mailbox (see Mailboxes sidebar),
/var/spool/mail/barney.
</p><p>For more information on fetchpop, read the man page&mdash;it
explains a lot of other details.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2063580.0x2555430"></a>Procmail</h2></div></div><p>Procmail is an MDA (mail delivery agent) and is used for
&ldquo;sorting&rdquo; e-mail. The standard method is for the MTA to pass mail
to procmail one message at a time, where it then checks its
configuration file and decides what to do based on what's in the
mail. Normally, it puts it in an appropriate mailbox. If you are a
concerned parent, you could use procmail to direct all mail
containing swear words to /dev/null. If you do a lot of hacking,
you can set procmail up so a special &ldquo;trigger&rdquo; e-mail would
encrypt your hard drive&mdash;a quick e-mail containing the code word
will lock the box up tight. Or suppose you receive an e-mail from
someone important; mail from a particular address could invoke a
script to beep you on your pager.</p><p>To ensure that your incoming mail is filtered through
procmail, create a file called ~/.forward containing the following
line:</p><pre     class="programlisting">
|exec /usr/bin/procmail
</pre><p>Then, change permissions on this file using the command:
<pre     class="programlisting">
chmod 644 ~/.forward
</pre>


Check the sendmail man page for the particulars on other uses of
the ~/.forward file.
</p><p>Edit ~/.procmailrc by adding the following lines at the
beginning:</p><pre     class="programlisting">
MAILDIR=$HOME/mail
DEFAULT=misc
</pre><p>The default misc folder is the mailbox that receives all mail
not put in another box. Generally, this will be personal mail.
</p><p>Let's put our first &ldquo;filter&rdquo; in the file. Here is your
basic &ldquo;recipe&rdquo; in all its glory:</p><pre     class="programlisting">
:0
* ^.*linux-kernel@vger.rutgers.edu
linux-kernel
</pre><p>Let's break it down line by line.
</p><p><b  >:0</b> indicates the start of a new recipe.
You have to use it whenever you put in a new rule for sorting
mail.</p><p>Each rule line must begin with an * (asterisk) followed by a
space. What does
<b  >^.*linux-kernel@vger.rutgers.edu</b> mean? The
<b  >^</b> (caret) means &ldquo;at the beginning of a line&rdquo;.
The <b  >.</b> (period) means &ldquo;match any character&rdquo;.
The * means match any number of the preceding character(s). So,
<b  >.*</b> means match any number of characters that
don't match the following characters. linux-kernel@vger.rutgers.edu
is the name of the Linux Kernel mailing list. Altogether, that rule
matches any line in the e-mail header that contains
linux-kernel@vger.rutgers.edu&mdash;if a match is found, it's a safe bet
the e-mail came from that mailing list. That rule has worked fine
for me for several months now.</p><p>Now, the final line, <b  >linux-kernel</b>, tells
procmail that if the rule above was matched, to store that piece of
mail in the mailbox named linux-kernel.</p><p>That was easy, eh? Let's do another example.</p><pre     class="programlisting">
:0
* ^Reply-To:.*mindanao-l@MINDANAO.COM
mindanao-list
</pre><p>Much like before, except to pick out mail from this mailing
list, I only need to look for lines that have the mindanao address
in the Reply-To: field of the header. If I put <b  >*
^.*mindanao-l@MINDANAO.COM</b>, I might find that personal
e-mail that were carbon copied to that mailing list would also get
sent to the mailing list mailbox instead of my private one.
</p><p>Here's one final example. Sometimes, two separate rules are
needed to sort all the mail from one mailing list. If I were more
knowledgeable about regular expressions, I could easily condense
these two rules into one. But I'm not, so here they are:</p><pre     class="programlisting">
:0
* ^To:.*wmaker@eosys.com
WindowMaker
:0
* ^Cc:.*wmaker@eosys.com
WindowMaker
</pre><p>Can you see what these rules do? They ensure that all mail,
having lines that begin with <b  >To:</b> or
<b  >Cc:</b> and contain wmaker@eosys.com elsewhere in
the line, is put into the WindowMaker mailbox. Look at the man
pages for <span   class="bold"><b>procmailrc</b></span> and
<span   class="bold"><b>procmailex</b></span> to get more
information.
</p><p>If you already have mail and want to filter it through
procmail for resorting, use the commands
<span   class="bold"><b>cat</b></span> and
<span   class="bold"><b>formail</b></span> as follows:</p><pre     class="programlisting">
cat mailbox | formail -s procmail
</pre><p>This command is handy if you discover mail has been sorted
into the wrong folder. Tighten up the &ldquo;rules&rdquo; in your
~/.procmailrc file (in the same manner as shown above) and run it
through again. For instance, if I find mail in my mailbox which
should have gone into the debian-list folder, I type:
<pre     class="programlisting">
mv misc temp; cat temp|formail -s procmail
</pre>


I can then check the misc file to see if I tightened the rules
enough to result in the proper sorting.
</p><p>To do thorough filtering, I recommend that you learn to use
regular expressions effectively. An excellent resource is the book
from O'Reilly &amp; Associates, <span   class="emphasis"><em>Mastering Regular
Expressions</em></span>, Jeffrey E. F. Friedl, 1997. The man page
for <span   class="bold"><b>egrep</b></span> can provide a quick
reference for regular expressions.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2063580.0x25562a0"></a>Conclusion</h2></div></div><p>You should now be able to send, receive, sort, read and reply
to e-mail on your very own Linux machine. From here, I would
recommend you read the EMAIL-HOWTO, the various man pages and
documentation for each program.</p><p>Once your setup is working, try experimenting with different
programs. There are several alternatives to procmail, e.g.,
<span   class="bold"><b>deliver</b></span> and
<span   class="bold"><b>mailagent</b></span>. Instead of fetchpop,
you could use the popular programs
<span   class="bold"><b>fetchmail</b></span> or
<span   class="bold"><b>popclient</b></span>. Many other MUAs, such
as <span   class="bold"><b>mail</b></span> and
<span   class="bold"><b>elm</b></span>, work quite well. As a
substitute for sendmail or smail, install
<span   class="bold"><b>qmail</b></span>, which is quite popular due
to its speed, reliability and simplicity compared to
sendmail.</p><p><a href="2516s2.html" target="_self">Generic Mail Flow</a></p><p><a href="2516s3.html" target="_self">Mailboxes</a></p><p><a href="2516s4.html" target="_self">Credits</a></p></div></div>
<div class="authorblurb"><p>
        <div       class="mediaobject"><img src="2516aa.jpg"></div>

      <span   class="bold"><b>Jonathan Walther</b></span>
      enjoys hanging out on MOOs and
      coding various little programs. Currently, he's looking for any
      Unix sysadmin/coding related work at an entry level, hopefully
      somewhere in western Canada where he lives. He just LOOOOOOVES
      getting e-mail at krooger@kurgo.ml.org. Look for SirDibos on IRC
      and the various MOOs.</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../046/toc046.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>