<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Ultimate Linux Box 2005</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;Some people wanted us to build a big powerful SMP system.&#10;Some people wanted us to build a silent machine that would&#10;be good for audio. So we did both.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0xc42580.0xd39ab0"></a>
Ultimate Linux Box 2005</h1></div><div><div class="authorgroup"><div class="author"><h3 class="author">
Justin
 
Thiessen
</h3></div><div class="author"><h3 class="author">
Matt
 
Fulvio
</h3></div><div class="author"><h3 class="author">
Philip
 
Pokorny
</h3></div><div class="author"><h3 class="author">
Trevor
 
Sherard
</h3></div><div class="author"><h3 class="author">
Don
 
Marti
</h3></div><div class="issuemoyr">Issue #136, August 2005</div></div></div><div><p>
Some people wanted us to build a big powerful SMP system.
Some people wanted us to build a silent machine that would
be good for audio. So we did both.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd3aa80"></a></h2></div></div><p>
Let's just call 2005 the year of power management.
Processor vendors made a big deal out of whitepapers about saving watts, and we heard a lot about
power management at LinuxWorld Conference and Expo
in February.
</p><p>
Did the industry start caring about global warming?
Do IT CEOs want to eat swordfish more often, so they
have to reduce the mercury emissions of power plants?
Not quite. Today's server systems are packing
more and hotter processors closer together, and
customers' air-conditioning systems aren't ready for
the strain. NASA had to install water cooling for
its 10,240-processor Columbia cluster, as we showed
in our January issue.
</p><p>
Every watt-hour you can save is heat that the customer
doesn't have to deal with&mdash;3.6kJ, or 3.4BTU to be
precise. With data centers full of blade servers,
and 1U systems sporting as many as four processors,
all that heat really adds up.
</p><p>
The Linux desktop greedily devours the scraps from
the multibillion dollar Linux server market, and
power consumption matters to us on the desktop too.
Fans are loud. If you have better power management
on your processors, they produce less heat, and
you can run fewer fans or run the fans you do have
more quietly. We took a different approach to fans,
as you'll see later on.
</p><p>
Finally, of course, power matters on the laptop
and on portable devices because of battery life.
We'll leave the specifics of tweaking for maximum
off-AC time to future articles.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd3ace8"></a>
Motherboard: the Heart of the System</h2></div></div><p>
We like Tyan motherboards, and companies that build
custom Linux systems do too. The four-Opteron
Tyan Thunder K8QS Pro came out just a little too
late to make it into last year's Ultimate Linux Box.
It's based on an AMD 8000 series chipset. When we say
&ldquo;chipset&rdquo;, we mean a slightly different combination
of hardware from an Intel-based system, though.
The AMD64 way is to have an onboard memory controller
per processor, give each processor its own bank of
memory and link them with HyperTransport. Your AMD64
&ldquo;SMP&rdquo; box is really a mini-NUMA, and the
&ldquo;chipset&rdquo;
doesn't include the memory controller.
</p><p>
Last year, we used a Celestica A8440 bare-bones
rackmount system as the basis for the Ultimate Linux
box. Although starting with pre-integrated chassis
and power supplies can be a great time saver, we
realized that last year's box was on the loud side.
This year, going back to our usual plan lets us pick
everything else just the way we want it.
</p><p>
The K8QS Pro has two PCI-X busses, A and B. B is
dedicated to two 133MHz-capable PCI-X slots, and A
offers two PCI-X slots maxing out at 66MHz and one
regular PCI slot. Onboard networking is two Broadcom
BCM5704C Gigabit Ethernet interfaces, also on bus A.
</p><p>
There are all the regular PC ports, of which we're
using the USB. SCSI and serial ATA are options, which
you might want to keep in mind if you're planning to
move this board into a more conventional server role
when you're building your next Ultimate Linux Box.
</p><p>
Into this mighty board we plugged four of the best
of the Opteron processors available at the time&mdash;the 846 HE, clocked at 2.0GHz and offering 1MB of
L2 cache. See the sidebar for what became available
while we were testing the system. We maxed out the
system's main memory at 32GB.
</p><p>
Unfortunately for case shoppers, this board is SSI
MEB size&mdash;13"x16" or 330.2x406.4mm. Not a problem
for us because we're using a custom case this year,
but the size does limit your case options.
</p><p>
When we're picking out a case for any custom-built
system, Ultimate or otherwise, we usually get one
that's quite a bit larger than what a big vendor would
use for a comparable system. Smaller cases require
less material and they're cheaper for vendors to ship,
but since we like to tweak things, we get a case with
more room to add devices and more room to work inside.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd3b108"></a>
Storage</h2></div></div><p>
In order to have a completely silent system, you need
to move storage outside the box. Options for doing
this have changed a lot since the days when you
had a choice between NFS and external SCSI enclosures
connected by a 3-meter cable.
</p><p>
Today, you can make your drives go away using USB,
FireWire, SCSI of course, Fibre Channel or the new
ATA over Ethernet, which we covered in the June 2005 issue.
A separate storage enclosure is no longer only an
enterprise server-room thing.
</p><p>
Another option is simply to boot over the network and
mount your storage via NFS. Since Penguin works with
enterprise server-room hardware, and Fibre Channel
does deliver impressive benchmark results, we went
with it; an nStor 4320F Fibre Channel RAID enclosure,
with Hitachi 18GB drives for the OS and larger Seagate
drives for more storage.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd3b2c0"></a></h2></div></div><div class="sidebar"><p class="title"><b>
Listing 1. Partition scheme as seen in /etc/fstab.
</b></p><pre     class="programlisting">
LABEL=/nstor-OS   /         ext3   defaults       1 1
LABEL=/cfboot     /boot     ext3   defaults       1 2
LABEL=/nstor-DATA /u1       ext2   defaults       1 2
none              /dev/pts  devpts gid=5,mode=620 0 0
none              /dev/shm  tmpfs  defaults       0 0
none              /proc     proc   defaults       0 0
none              /sys      sysfs  defaults       0 0
</pre></div><p>
Because we wanted the system to be self-contained and
not depend on another server to boot, we installed
a Sandisk 256MB CompactFlash card to boot from.
This device looks exactly like another ATA drive to the
system, so any PC motherboard will boot from it.
</p><p>
We considered using a USB thumbdrive, but that
would have required some initrd drive juggling and
GRUB wizardry. There are advantages to being able
to pull your boot device out of the system and store
it separately, but we didn't anticipate shipping the
system through airports with drives loaded with
encrypted confidential data.
</p><p>
If you plan to leave your silent Linux system on your
network, you'll be a little more flexible in booting,
and you can set up PXE booting. But if you want
to take your Ultimate Linux Box over to a friend's
house to play some music, you'll want to be able
to boot independently. The Penguin crew plans to
take this system to LinuxWorld Conference and Expo,
and when you're wrangling hardware for a tradeshow
one fewer thing to set up is good.
</p><p>
If you do build and install a silent Linux box,
you'll probably end up doing a mix of both: NFS for
user home directories, the company /usr/local/bin/
and other items that need to be in sync but aren't
performance-critical. You can save your machine's
own filesystems for big working files, like all the
audio data you'll get from this system's high-end
sound hardware.
</p><p>
Finally, to take even the keyboard clicking out
of the silent system, Penguin founder Sam Ockman
suggested a TouchStream LP keyboard, which works like
a touchpad and requires no moving parts. It's also
a pointing device and lets you map gestures to
interface actions.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd3b630"></a>
Audio</h2></div></div><p>
For the first time, we put professional audio hardware
into the Ultimate Linux Box. What better place for
a silent machine than the recording studio?
</p><p>
The RME Hammerfall HDSP9652 card we chose for this system is
capable of up to 52 channels, and we matched it with
an external box called the Multiface that brings out
8 1/4" jacks, as well as optical, coax and MIDI.
</p><p>
This card is as close as you can get to a &ldquo;studio in
a box&rdquo;, because it's built around an internal mixer
and allows you to route signals around inside the
card with low latencies and low load on the CPU.
Other features include the ability to &ldquo;punch in&rdquo; and
&ldquo;punch out&rdquo; like a conventional tape deck.
</p><p>
Best of all, RME has been supporting the Advanced
Linux Sound Architecture (ALSA) Project since 2000,
so Linux users aren't second-class citizens. RME's
site says, &ldquo;ALSA support for the Hammerfall breaks
the annoying chicken/egg principle&mdash;no professional
hardware/driver, no professional software.&rdquo;
</p><p>
Peter Todd covered the necessary tools for working
with the Hammerfall HDSP cards in our October 2003
issue.
</p><p>
For video, we used a relatively low-end card
(see the on-line Resources). We'd really like to start putting
interesting and innovative video on Ultimate Linux
Boxes, but there are still some issues with the
drivers (see sidebar).
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd3ba50"></a>
Thermal Management</h2></div></div><p>
So how do we keep this thing cool?
First of all, it's important not to start tweaking
with hardware combinations unless you know how to
measure the effects that your changes have on the
system's temperature. Don't change anything unless
you know how to measure the effect of the change.
</p><p>
The good news is that the processor and motherboard
vendors thoughtfully give us temperature sensors
right on the key parts. And we can keep track of
them using an all-important tool, lm_sensors.
</p><p>
We didn't have to measure drive temperature because
we moved the drives to a separate enclosure, but
smartmontools (see Resources) gives you an easy way
to do that.
</p><p>
We ordered up some parts from Zalman, which offers a
beautiful set of water-cooling hardware. The most
visible part is the Reserator 1, a combined water
reservoir and radiator that stands half a meter tall
and holds 2.5 liters of water. Besides the Reserator,
we also ordered one CPU waterblock per processor
and matching tubing.
</p><p>
Thermal estimates showed that we wouldn't need a full
Reserator per processor, so we used one Reserator
per two processors and one for the power supply.
</p><p>
The Reserator comes with a 5W pump, which would break
our beautiful silence, so it was time to convert
it to operate purely by convection. In its stock
configuration, the Reserator's inlet and outlet are
close to each other, so we installed a tube inside
each Reserator, running from the hot inlet to near
the top.
</p><div       class="mediaobject"><a href="8292f1.large.jpg"><img src="8292f1.jpg"></a><div class="caption"><p>
What's that in your cubicle, Justin? We tested convective
cooling with a scratch system and lm_sensors.
</p></div></div><p>
Did it work? The processor temperature climbed to
about 50&deg; C, then the tubes leading up from the
processors to the Reserators warmed enough to start
the convection. Temperature fell to 47&deg; or 48&deg;
C in normal use, and running full-out, the system
holds out below 50&deg; C.
</p><p>
Cooling the power supply was a little harder.
Zalman's beefiest fanless power supply is only 400W,
and a big four-way board needs more. We decided to use
the PC Power and Cooling Turbo-Cool 510 ATX.
</p><p>
We decided not to design and build a power supply for
the project, since it's important to apply power to
components in the right order, and we know PC Power
and Cooling solved that problem for us. The cooling
problem remained.
</p><p>
Enter the magic of metalworking. Phil brought the problem
to a machine shop called
Global Precision, and we had them do
three pieces of work. They machined down the
original fins of the power supply's heat sinks
to create flat areas for attaching waterblocks.
They made the waterblocks themselves&mdash;using
blue anodized aluminum to match the Zalman parts.
And they made two custom Y-connectors to split the
water flow between the two heat sinks.
</p><p>
We removed the fan control board from the power
supply. We didn't need it any more.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd32910"></a>
Case</h2></div></div><p>
Cases capable of accommodating and doing justice to
Ultimate Linux Boxes are rare. This year, only
one alternative would work: going full custom.
This year's case has acrylic windows to show off
the cooling system, integrated supports for the
three Reserators and a mounting place for the
RME Multiface.
</p><div       class="mediaobject"><a href="8292f2.large.jpg"><img src="8292f2.jpg"></a><div class="caption"><p>
Look, everybody, no leaks! Justin sets up for the
cover photo shoot (photo: Don Cameron).
</p></div></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd32bd0"></a>
Conclusion</h2></div></div><p>
Difficult as it might be for us to believe right now,
many real-world systems don't need both 52-channel
audio and Fibre Channel. But unusual combinations
of hardware are what enable creative projects, and
we're happy that Linux stays out of our way and lets
us hook up what we want.
</p><p>
When you start with what's possible and take out
what you don't need, you'll be confident that you
can build a machine for your needs. We hope that
whatever class of system you decide to build, you'll
get some ideas out of this year's Ultimate Linux Box.
</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd32d30"></a></h2></div></div><div class="sidebar"><p class="title"><b>
Ultimate Linux Box 2005 Parts List
</b></p><p>
Motherboard: Tyan Thunder K8QS Pro (S4882)
</p><p>
CPUs: 4 x AMD 846HE Opterons
</p><p>
RAM: 8 x 4GB Registered ECC Samsung DDR PC2700 CL 2.5 DIMMs
</p><p>
Power supply: 510W Custom harness PC Power and Cooling Turbo-Cool 510 ATX
(modified)
</p><p>
Case: Custom, designed by Matt Fulvio, constructed by Trevor Sherard
</p><p>
Fibre Channel: Qlogic 2342 dual-port, 133MHz, PCI-X, 2Gb Fibre Channel
adapter
</p><p>
Boot device: Sandisk 256MB CompactFlash card, DCFB-256-A10
</p><p>
Storage: nStor 4320F Fibre Channel RAID enclosure
</p><p>
Hard disks: 2 x 18Gb Hitachi DK32DJ-18FC 10KRPM Fibre Channel drives in
a RAID 1 array (OS install) and 6 x 73Gb Seagate ST373405FC Cheetah 73LP FC 10KRPM Fibre Channel drives in a RAID 10 array
</p><p>
Graphics card: PNY NVIDIA Quadro NVS 280 PCI
</p><p>
Displays: 2 x ViewSonic VX2000 20" 1600x1200 LCD displays
</p><p>
Audio card: RME HDSP9652 PCI audio card
</p><p>
Audio I/O: RME Multiface 36-channel 24-bit 96-kHz I/O box
</p><p>
Cooling system: 3 x Zalman Reserator 1s.
</p><p>
CPU waterblocks: 4 x Zalman ZM-WB2 Gold waterblocks
</p><p>
P/S Cooling HW: Custom-designed and machined by Global Precision.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd33410"></a></h2></div></div><div class="sidebar"><p class="title"><b>
Hardware of the Future, Lawyers Stuck in the Past
</b></p><p>
It never fails. New products that we'd like to try
in the Ultimate Linux Box come out right when we're
in the middle of building this year's.
</p><p>
Too late to make it through our thermal testing,
AMD introduced dual-core Opteron processors, which
let you build an eight-way system on an existing four-socket
motherboard with a BIOS upgrade. Today, that means
spending $10,000 on processors, but (all together
now) we expect prices to come down.
</p><p>
We're watching the progress of the LinuxBIOS Project
(see page XX) and are planning to get a supported motherboard
for next year. We know patience is a virtue, but
booting in mere seconds is cool for its own sake.
</p><p>
This year's system sounded so nice that we'd like to
do another quiet machine next year. That means we
have to pick a storage technology, and added to next
year's list of alternatives will be ATA over Ethernet,
as covered in Ed Cashin's article in the June 2005 issue.
</p><p>
Video is still a weak spot, not because of hardware
problems, but because of the vendors' lawyers.
Everybody doing 3-D is infringing everyone else's
patents, and burying the driver code behind
a proprietary EULA with a no-reverse-engineering
clause is only slowing the industry down. When the
normal kernel development process frequently breaks
the driver for commonly used hardware, that hardware
needs to get with the program.
</p><p>
Graphics vendors, please get together, cross-license
the patents for hardware, and come up with a license
for software and documentation that lets developers
release the new code that makes people want graphics
hardware in the first place. It'll help everyone in
the long run&mdash;NVIDIA maintains an entire parallel
software distribution system just because of its
licensing decision. Why not get that cost center
out of the budget?
</p><p>
Pessimists will say to be &ldquo;realistic&rdquo; and accept the
proprietary drivers. But realistically, the UNIX
vendors of the mid-1990s weren't about to support
Linux, either. Today, every UNIX vendor is out of
business or supporting Linux. I'll put reality up
against &ldquo;realistic&rdquo; any day.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0xc42580.0xd33888"></a></h2></div></div><div class="sidebar"><p class="title"><b>
Benchmark Results</b></p><p>
dbench with 100 simulated clients:

<pre     class="programlisting">
%dbench 100
Throughput 1234.57 MB/sec (NB=1543.21 MB/sec 12345.7 MBit/sec)
</pre>
</p><p>
Bonnie++ 1.03&mdash;a more accurate disk benchmark:
</p><div class="itemizedlist"><ul type="disc"><li><p>
Sequential output by character: 58,577Kb/s, 98% CPU
</p></li><li><p>
Sequential output by block: 281,032Kb/s, 50% CPU
</p></li><li><p>
Sequential output, rewrite: 52,603Kb/s, 18% CPU
</p></li><li><p>
Sequential input by character: 34,717Kb/s, 58% CPU
</p></li><li><p>
Sequential input by block: 90,097Kb/s, 11% CPU
</p></li><li><p>
Random seeks: 257.5/s
</p></li><li><p>
Sequential create: 5,924 files/s
</p></li><li><p>
Random create: 6,056 files/s
</p></li></ul></div><p>
Postmark benchmark&mdash;Postmark simulates the operations of a busy mail
server. For 20,000 base files and 100,000 transactions,
we obtained the following results.
</p><p>
Time:
</p><div class="itemizedlist"><ul type="disc"><li><p>
46 seconds total
</p></li><li><p>
40 seconds of transactions (2,500/s)
</p></li></ul></div><p>
Files:
</p><div class="itemizedlist"><ul type="disc"><li><p>
70,128 created (1,524/s);
Creation alone: 20,000 files (5,000/s);
Mixed with transactions: 50,128 files (1,253/s)
</p></li><li><p>
49,656 read (1,241/s)
</p></li><li><p>
50,199 appended (1,254/s)
</p></li><li><p>
70,128 deleted (1,524/s)
</p></li><li><p>
Deletion alone: 20,256 files (10,128/s);
mixed with transactions: 49,872 files (1,246/s)
</p></li></ul></div><p>
Data:
</p><div class="itemizedlist"><ul type="disc"><li><p>
303.46MB read (6.60MB/s)
</p></li><li><p>
436.18MB written (9.48MB/s)
</p></li></ul></div><p>
Kernel compile: 50s
</p></div><p><span   class="bold"><b>Resources for this article:</b></span>
<a href="../136/8330.html" target="_self">/article/8330</a>.
</p></div></div>
<div class="authorblurb"><p>
Justin Thiessen is a Linux Engineer at Penguin
Computing. As head of this year's Ultimate Linux
Box Project, he was responsible for system design,
construction and testing, and was involved in
component selection. When not busy with the Ultimate
Linux Box, he works on new product development and
improving Linux support for Penguin hardware by
contributing to the lm_sensors Project.
</p><p>
Matt Fulvio is a freelance industrial and
architectural designer in the Bay Area. He can be
found teaching mathematics at the San Francisco
Institute of Architecture or at <a href="http://www.mattfulvio.com" target="_self">www.mattfulvio.com</a>.
</p><p>
Philip Pokorny is the Director of Engineering for
Penguin Computing. He worked with the power supply
vendor and machine shop to get the power supply
modified for water cooling. When he wasn't doing
that, he was standing around watching and asking
silly questions like a typical pointy-haired-boss.
</p><p>
Trevor Sherard, the craftsman of the case for
the ULB, is a San Francisco Bay area freelance
sculptor and woodworker. He can be contacted at
<a href="http://www.woodentemple.com" target="_self">www.woodentemple.com</a>.
</p><p>
Don Marti is editor in chief of <i  >Linux Journal</i> and
wrote the text of the article.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../136/toc136.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>