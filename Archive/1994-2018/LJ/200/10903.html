<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
Work the Shell
</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;Maps? We don't need no stinking maps. With bash and a few&#10;command-line utilities, we can extract the textual driving instructions&#10;from an on-line map source and dispense with all those pesky GUI maps.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x16d1580.0x17c8ac0"></a>
Work the Shell
</h1></div><div><h3 class="subtitle"><i>
Generating Turn-by-Turn Driving Directions
</i></h3></div><div><div class="author"><h3 class="author">
Dave
 
Taylor
</h3></div><div class="issuemoyr">Issue #200, December 2010</div></div><div><p>
Maps? We don't need no stinking maps. With bash and a few
command-line utilities, we can extract the textual driving instructions
from an on-line map source and dispense with all those pesky GUI maps.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x16d1580.0x17c93b0"></a></h2></div></div><p>
I'm happy to report that this month, I'm answering a
reader's question about how to script something. Dunno what's up
with the rest of you readers, but apparently writing to me with your weird
and challenging shell-scripting puzzles isn't making the short list
right now. Reader Paul M. asks:
</p><div class="blockquote"><blockquote class="blockquote"><p>
Is there a way to screen-scrape Google Maps direction results? I'm after
the text (turn left at Ho-ho-kus Blvd), not the maps. When I look at a
saved results page, all I can see is CSS and JavaScript code. If I do a
manual copy and paste of the directions, however, the turn-by-turn
directions appear. Got any suggestions on how to grab
turn-by-turn driving directions automatically, Dave?
</p></blockquote></div><p>
Ah, those tricky programmers over at Google Maps make this
pretty darn difficult! Poke around at the source pages generated by
<a href="http://maps.google.com" target="_self">maps.google.com</a> looking for directions, and it's clear that
they're using a method=post or other advanced way to hide the starting
and ending points from the URL itself, along with some very fancy coding to
make the Web pages highly interactive.
So to heck with it!
</p><p>
After much digging around and looking at how the different mapping sites
work, I settled on Expedia.com as the best place to get driving directions
so that we'll be able to specify start and stop points via URL and
also understand the output. To get started, check out Expedia's interactive driving
directions in your Web browser at <a href="http://www.expedia.com/Directions" target="_self">www.expedia.com/Directions</a>.
</p><p>
On Expedia, enter a starting and ending address for directions, and
you'll find that it's all stored in a scary-complex URL like this:
<a href="http://www.expedia.com/pub/agent.dll?qscr=mrdr&amp;rtyp=0&amp;unit=0&amp;lats1=38.89872&amp;lons1=-77.036379&amp;alts1=5&amp;strt1=1600+Pennsylvania+Ave+NW&amp;city1=Washington&amp;stnm1=DC&amp;zipc1=20006&amp;regn1=0&amp;labl1=1600+Pennsylvania+Ave+NW%2C%0AWashington%2C+DC+20006&amp;lats2=28.393142483519902&amp;lons2=-81.57198620078931&amp;alts2=5&amp;strt2=N+World+Dr&amp;city2=Orlando&amp;stnm2=FL&amp;zipc2=32830&amp;regn2=0&amp;labl2=World+Dr%2C%0AOrlando%2C+FL+32830&amp;" target="_self">www.expedia.com/pub/agent.dll?qscr=mrdr&amp;rtyp=0&amp;unit=0&amp;lats1=38.89872&amp;lons1=-77.036379&amp;alts1=5&amp;strt1=1600+Pennsylvania+Ave+NW&amp;city1=Washington&amp;stnm1=DC&amp;zipc1=20006&amp;regn1=0&amp;labl1=1600+Pennsylvania+Ave+NW%2C%0AWashington%2C+DC+20006&amp;lats2=28.393142483519902&amp;lons2=-81.57198620078931&amp;alts2=5&amp;strt2=N+World+Dr&amp;city2=Orlando&amp;stnm2=FL&amp;zipc2=32830&amp;regn2=0&amp;labl2=World+Dr%2C%0AOrlando%2C+FL+32830&amp;</a>.
(Eagle-eyed readers will notice that I'm offering the Obama family
driving directions to Disney World.)
</p><p>
You can strip some of the superfluous information out of the URL and create
a simple command-line call to get the map and directions:


<pre     class="programlisting">
start="strt1=1600+Pennsylvania+Ave+NW&amp;city1=Washington&amp;stnm1=DC"
dest="strt2=N+World+Dr&amp;city2=Orlando&amp;stnm2=FL&amp;zipc2=32830"

curl --silent "http://www.expedia.com/pub/agent.dll?$start&amp;
 &#8618;$dest&amp;qscr=mrdr&amp;rtyp=0&amp;unit=0"
</pre>
</p><p>
You can see that Expedia wants an address unwrapped and split by street
address, city, state and zip code (though if it can figure out the location,
it appears you can skip the zip code, as shown in
<tt  >start</tt> above).
</p><p>
Now that we have that, let's use sed to extract just the table of
results, without the other superfluous information. This is done by manual
analysis of the source file and noting that it's all in a table that
starts with this HTML line:


<pre     class="programlisting">

&lt;TABLE BORDER=1 BORDERCOLOR=#E4E4E4 CELLSPACING=0 CELLPADDING=4&gt;

</pre>
</p><p>
Not surprisingly, the line we seek that denotes the end of the table is
&lt;/TABLE&gt;. Here's the code that lets you slice things as desired:

<pre     class="programlisting">

sed -n '/BORDERCOLOR=#E4E4E4/,/&lt;\/TABLE&gt;/p'

</pre>
</p><p>
Put them all together and save the output to a temp file.
After that, the next challenge is to turn that HTML table into something
you actually can read.
</p><p>
To do that, we're going to turn to a great open-source utility called
Lynx. You might already have Lynx on your system, but if you
don't, grab a copy of the Lynx text-based Web browser from
<a href="http://lynx.isc.org" target="_self">lynx.isc.org</a>. We'll use that to interpret and convert the HTML
markup to raw text.
</p><p>
Fortunately, Lynx excels at this kind of challenge, as
demonstrated by the working code:


<pre     class="programlisting">
curl --silent "http://www.expedia.com/pub/agent.dll?$start&amp;
 &#8618;$dest&amp;qscr=mrdr&amp;rtyp=0&amp;unit=0"| \
   sed -n '/BORDERCOLOR=#E4E4E4/,/&lt;\/TABLE&gt;/p' | \
   lynx -dump -stdin
</pre>
</p><p>
Yup, that's it. Specify a correct start and destination, make sure that
the script knows where to find Lynx on your system, and the
output will look like this:


<pre     class="programlisting">

Directions Distance Time
Start: Depart Start on Local road(s) (East) 0.1 &lt; 1min
    1: Turn RIGHT (South) onto E Executive Ave NW 0.1 0:01
    2: Turn LEFT (East) onto Alexander Hamilton Pl NW, then
       immediately turn RIGHT (South) onto 15th St NW 0.1 0:01
    3: Turn LEFT (East) onto Pennsylvania Ave NW, then immediately
       turn RIGHT (South) onto 14th St NW 0.3 0:02
    4: Keep STRAIGHT onto US-1 [14th St NW] 1.1 0:02
  ...
   22: Take Ramp (LEFT) onto Western Way (Disney World) 1.9 0:02
   23: Turn LEFT (North) onto Bear Island Rd 2.1 0:03
   24: Turn RIGHT (East) onto Floridian Way 0.3 0:01
   25: Keep STRAIGHT onto World Dr 0.4 0:01
  End: Arrive End &lt; 0.1 &lt; 1min
Total Route 881 mi 13 hrs  2 mins

</pre>
</p><p>
I'll leave it as an exercise to you, dear reader, to create a wrapper
that prompts people for starting and ending addresses and then uses the
curl invocation to Expedia and subsequent invocation of Lynx to display
turn-by-turn driving directions.
</p></div></div>
<div class="authorblurb"><p>
Dave Taylor has been hacking shell scripts for a really long time, 30
years. He's the author of the popular <span   class="emphasis"><em>Wicked Cool Shell
Scripts</em></span>
and can be found on Twitter as @DaveTaylor and more generally at
<a href="http://www.DaveTaylorOnline.com" target="_self">www.DaveTaylorOnline.com</a>.

</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../200/toc200.html">Issue Table of Contents</a>
    <a class="link3" href="../200/10903.html">Article</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>