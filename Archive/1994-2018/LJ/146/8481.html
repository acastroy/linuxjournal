<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>
An Introduction to Gambas</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;If you think Visual Basic is almost useful, here's a way to almost get it&#10;on Linux.&#10;"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x2844580.0x293bab0"></a>
An Introduction to Gambas</h1></div><div><div class="author"><h3 class="author">
Mark
 Alexander 
Bain
</h3></div><div class="issuemoyr">Issue #146, June 2006</div></div><div><p>
If you think Visual Basic is almost useful, here's a way to almost get it
on Linux.
</p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x2844580.0x293c298"></a></h2></div></div><p>
Have you ever wanted to use Visual Basic on Linux? Why? Well, you could
be like me and have spent many years programming in VB, but want to move
to Linux without having to learn a new language. It could be that you're
brand new to programming and need something you can learn quickly
and easily&mdash;and still be able to produce a good quality application.
</p><p>
Well, now you can&mdash;almost.
</p><p>
Gambas is short for Gambas is&mdash;almost&mdash;Basic, and it has been designed to
look at the good things
VB can do for Windows and then does them for Linux. Above all, Gambas
is easy to use&mdash;as this article shows. I explain
how to build a useful application in Gambas&mdash;a bug-tracking system
that stores its information in a MySQL database.
</p><p>
Installation is as simple. First go to the Gambas Web site, and check
the Distributions &amp; OS page&mdash;this is just to make sure there
are no known peculiarities with your flavour of Linux. Then, go to the
Download page and get the most current, stable version (1.09 at the
time of this writing). If you've done this type of thing before, simply carry on and get yourself
ready to use Gambas; if not, don't worry&mdash;we're nearly there.
</p><p>
Open a terminal and move to the directory where you've saved the bz2
file. If you're going to use 1.09, it will be called gambas-1.0.9.tar.bz2. Now
<tt  >bunzip2</tt> the file, and follow the installation instructions (unless
the distribution page has given you some additional parameters for your
distribution).
</p><p>
With that, you're ready to use Gambas. Type <tt  >gambas</tt>
on the command line, and the welcome screen appears (Figure 1).
</p><div       class="mediaobject"><img src="8481f1.jpg"><div class="caption"><p>
Figure 1. The Gambas Welcome Screen
</p></div></div><p>
The Gambas screen gives you access
to example applications&mdash;you'll find these very
useful if you are new to programming. In this case,
click on New Project. Gambas now displays
its project creation wizard, so follow the instructions
to create your first project. When asked create a
graphical project, set the name to bugTracker
(note that underscores are not allowed), and then set the
title to Bug Tracker. You also will be asked where
to store your project. I suggest you
create a new directory called Gambas in your home directory
and then use it for all future projects as well.
</p><p>
Next, we jump straight in to the creation of a new form. Right-click in the
project window, select New and then Form. Gambas puts you into
its form creation wizard. All you need to do now is give the form a
name&mdash;call it frmBugTracker. (Don't leave it as Form1. That's
<span   class="emphasis"><em>very</em></span>
bad practice).
</p><p>
Now, you can start adding the elements to the form&mdash;and, the first one to
add is a Close button. Why do this first? Quite simply, you always want
to be able to close a form, or an application, for that matter, cleanly
and easily, so get into this habit as quickly as possible. To create the
button, click on its icon in the toolbox (the icon is a box with OK
on it), and then use the left-mouse button to draw it onto the form. By
default, the button is called Button1, but exactly like the form, we
rename it. Click on the button, and press F4 to display the
Properties box. Change its name to btnClose and its text to Close.
</p><p>
The button won't do anything yet&mdash;we have to add some code to
it, which is really, really easy. If you double-click
on the button, Gambas takes you to the code window, and you'll
find an empty btnClose_Click subroutine. Modify it so that it says:

<pre     class="programlisting">
PUBLIC SUB btnClose_Click()

  ME.Close

END
</pre>
</p><div       class="mediaobject"><a href="8481f2.large.jpg"><img src="8481f2.jpg"></a><div class="caption"><p>
Figure 2. Designing a New Gambas Form
</p></div></div><p>
You should notice something as you type in the code&mdash;as soon as you put
in the period, a drop-down menu appears, giving you all of the
methods and parameters associated with the ME object&mdash;in this case,
ME refers to the form, so ME.Close means close this form.
</p><p>
Suppose you want to see the results of your hard work now. Go
to the Project window and click on the little green run button. And
there you are&mdash;your first Gambas application. You even can close the
form with your brand-new button.
</p><p>
Before building the application itself, we need to
think about what we want the bug tracker to do. Then,
we need to have a look at the data&mdash;how it is to be
arranged, and what is going to be stored.
</p><p>
The bug tracker will have to do the following:
</p><div class="itemizedlist"><ul type="disc"><li><p>
Have the details of new bugs entered.
</p></li><li><p>
Record who raised the bug.
</p></li><li><p>
Have a bug assigned to a programmer.
</p></li><li><p>
Update the status of the bug.
</p></li><li><p>
Record when the bug was raised.
</p></li><li><p>
Record the release for the bug fix.
</p></li><li><p>
Provide the ability to view new, working and complete bugs.
</p></li></ul></div><p>
The data required is therefore:
</p><div class="itemizedlist"><ul type="disc"><li><p>
Who raised the bug.
</p></li><li><p>
Who is fixing the bug.
</p></li><li><p>
Bug details.
</p></li><li><p>
Developer details: ID, first name, surname and user name.
</p></li><li><p>
Bug Details: ID, description, date created, ID of raiser, ID of
developer, status, release number and application details.
</p></li></ul></div><p>
From this, we can start building a database schema. Start by creating a
file (such as database_schema.sql) that we will use to create the database:

<pre     class="programlisting">
/*
First you must create the database. The listing
table includes only the user ids for "raised by"
and "coder".
*/
create database bugtracker;

create table bugtracker.listing (
id int auto_increment primary key,
details longtext,
application_id int,
release float,
raised_by_id int,
coder_id int,
status_id int,
created datetime,
priority int,
status int);

/*
The coder table is simple but includes the user name.
*/

create table bugtracker.coder (
id int auto_increment primary key,
surname varchar(50),
firstname varchar(50),
username varchar(50));
/*
Finally you can create reference tables for storing
application names and status titles.
*/
create table bugtracker.application (
id int auto_increment primary key,
name varchar(50));

create table bugtracker.status (
id int auto_increment primary key,
title varchar(50));

/*
With the tables created you can add a user account to
the database for the bugTracker application to log
on to.
*/
GRANT select,insert,delete,update ON bugtracker.*
TO bugtracker@localhost IDENTIFIED BY 'mypassword';

/*
Next you can start loading the data that will make
the application work. The key information is the coder data.
*/

insert into bugtracker.coder (username,surname,firstname)
values ('bainm','bain','mark');
/*
Finally add some dummy data so that you can see
the application working as soon as possible
*/
insert into bugtracker.application (name)
  values ('bugtracker');
insert into bugtracker.status (title)
  values ('new');
insert into bugtracker.status (title)
  values ('worked on');
insert into bugtracker.status (title)
  values ('rejected');
insert into bugtracker.status (title)
  values ('completed');
</pre>
</p><p>
Create the database by typing:

<pre     class="programlisting">

mysql -uroot -p&lt;root password&gt; mysql &lt; database_schema.sql

</pre>
</p><p>
So, with the database in place, it's time to go back
to Gambas to do some actual programming.
</p><p>
Now that we've built and loaded data into the database,
the first thing to do is to connect to it so we
can start communicating with it. Gambas makes this
very, very easy for us. It comes with components,
and all we have to do is tell the application to use
the appropriate component for connecting to databases.
We will have to do a little coding as well, but that
is easy too.
</p><p>
Go to the Project window, click on Project and then
Properties. The Properties screen appears&mdash;click on the Components tab, and then check gb.db
(Figure 3).
</p><div       class="mediaobject"><a href="8481f3.large.jpg"><img src="8481f3.jpg"></a><div class="caption"><p>
Figure 3. Enabling the Data Access Component
</p></div></div><p>
Gambas now can use the component to communicate
with the database. All we have to do is add a
little bit of code, and we do this in a
module, which is a file for storing code so that
it is usable by an application in general and not just
a single form. For instance, the Close function
we already created was only for the one form. We
want to create code that is accessible for any forms
that we create.
</p><p>
Right-click on the Project screen, click New and
then Module. Gambas shows the Module Creation
wizard. Just like the form and the button we made
earlier, don't leave the module name as Module1.
Call it something useful. In this case, call it
Data. Once you create it, you can start adding
code to it. Create the variables that will be used for
database access:

<pre     class="programlisting">
PRIVATE myDB AS NEW Connection PUBLIC tmpRec AS Result
</pre>
</p><p>
If you've used VB,
you'll be happy with the format. If you're new
to this, just take note that the PUBLIC statement
makes the variable global&mdash;accessible to the whole
application. If you don't want it to be available to
the whole application, define it as PRIVATE.
</p><p>
The next (public) function makes the connection:

<pre     class="programlisting">

PUBLIC FUNCTION connect2db() AS Boolean
  WITH myDB
    .Type = "mysql"
    .Host = "localhost"
    .Login = "bugtracker"
    .Password = "mypassword"
    .Name = "bugtracker"
  END WITH
  TRY myDB.Open
  IF ERROR THEN
    Message ("Cannot Open bugtracker:" &amp; Error.Text)
    RETURN FALSE
  END IF
  RETURN TRUE
END

PUBLIC FUNCTION Exec(sql AS String) AS Result
   RETURN myDB.Exec(sql)
END

</pre>
</p><p>
We can call these functions from any form that
we create. In this case, we call them from
frmBugTracker. Double-click on frmBugTracker in the
Project window, and then double-click anywhere on the
form itself. This takes you into the code window,
and you should see:

<pre     class="programlisting">
PUBLIC SUB Form_Open()

END
</pre>
</p><p>
Now we add code to tell the form to
connect to the database, and we also add a function
to carry out a simple security check:

<pre     class="programlisting">

PUBLIC SUB Form_Open()

  Data.connect2db

  IF (check_id() = FALSE) THEN
    message ("Unable to log on as " &amp; system.user)
    ME.close
  END IF
END

PRIVATE FUNCTION check_id () AS Boolean
   data.Exec("select id" &amp;
             " from coder" &amp;
             " where username='" &amp; system.user &amp; "'")
  IF (data.tmpRec.Available ) THEN
    RETURN TRUE
  ELSE
    RETURN FALSE
  END IF
END

</pre>
</p><p>
If you run the project now, little will have
changed, apart from the fact that it will take a
little longer to load&mdash;it now has to connect to the
database. However, the form will check the user's Linux
user ID against the list of coders on the database
using the function check_id. It displays a message
and then closes the form if the ID is missing.
</p><p>
Next (keeping it simple), we create a pair of
combo-boxes. One (cmdBugId) displays the list of
bug IDs assigned to the current user. The other
(cmdStatus) displays a list of the possible
statuses. We then add a subroute (loadCombos)
to fill in the details of the combo-boxes. Once you
have added the combo-boxes from the toolkit write
the required subroutines:
</p><p>
Add this to the Data module:

<pre     class="programlisting">
PUBLIC SUB loadCombo (combo AS ComboBox,
                      sql AS String)
  combo.Clear
  tmpRec = myDB.Exec(sql)
  FOR EACH tmpRec
    combo.Add (tmpRec[0])
  NEXT
END
</pre>
</p><p>
Add this to frmBugTracker:


<pre     class="programlisting">

PRIVATE SUB loadCombos ()

  data.loadCombo(cmbBugid,"select l.id" &amp;
             " from listing l, coder c" &amp;
             " where l.coder_id=c.id" &amp;
             " AND c.username='" &amp; system.User &amp; "'")

   data.loadCombo(cmbStatus,"select title from status")
END

</pre>
</p><p>
For the code to run, we must change Form_Open:

<pre     class="programlisting">

  IF (check_id() = FALSE) THEN
    message ("Unable to log on as " &amp; system.user)
    ME.close
  ELSE
    loadCombos
  END IF

</pre>
</p><p>
Now we can click on the combo-box to select the
required bug ID, and use this to run another
query in order to view the particular details. To do this, we need a text area (txtDetails)
and some text boxes (txtCreated and txtRaisedby,
txtPriority, txtApplication and txtVersion).
</p><p>
Double-click on cmbBugId, go into code edit mode,
and edit the code so that it reads:

<pre     class="programlisting">

PUBLIC SUB cmbBugid_Click()

 data.Exec ("SELECT l.priority,l.created, " &amp;
        "l.details,l.release," &amp;
        "s.title, c.username, a.name" &amp;
        " from listing l,coder" &amp;
        " c,status s,application a" &amp;
        " where l.id=" &amp; cmbBugid.Text &amp;
        " AND l.status=s.id" &amp;
        " AND l.raised_by_id=c.id"
        " and l.application_id = a.id")

  txtDetails.Text = data.tmpRec!details
  txtCreated.Text = data.tmpRec!created
  txtRaisedby.Text = data.tmpRec!username
  txtPriority.Text = data.tmpRec!priority
  txtApplication.Text = data.tmpRec!name
  txtVersion.Text =  data.tmpRec!release
  cmbStatus.Text = data.tmpRec!title
END

</pre>
</p><div       class="mediaobject"><img src="8481f4.jpg"><div class="caption"><p>
Figure 4. Viewing the Details of a Bug
</p></div></div><p>
The next stage is to be able to log a new bug. We
need to create a new form (frmAddBug), and we
add an extra button to frmBugChecker&mdash;calling it
btnAddBug and change the text to Add Bug. Don't
forget to add a Close button before doing anything
else. Next, add a text area (txtDetails), a text box
(txtPriority) and a combo-box (cmbApplication). You
also will need another button (btnSave):

<pre     class="programlisting">

PUBLIC SUB Form_Open()
  loadCombos
END

PRIVATE SUB loadCombos()
   data.loadCombo(cmbApplication,"select name from application")
END

</pre>
</p><p>
Our third form will view all bugs. Create a new form
(frmViewAll), and then go to frmBugManager, copy all of
the elements and paste them into frmViewAll. You
need to change the order of the objects so that
the status combo-box is at the top of the form. Also
add another text box (txtCoder). Finally, select the new
Add Bug button, change the name to btnAccept and
change the text to Accept.
</p><p>
For this form, we need some code to load cmbStatus first, because this
will drive the others:

<pre     class="programlisting">

PUBLIC SUB Form_Open()
  loadCombos
  cmbStatus_Click
END

PRIVATE SUB loadCombos()
   data.loadCombo(cmbStatus,
                  "select title from status")
END

PUBLIC SUB cmbStatus_Click()
  data.loadCombo(cmbBugid,"select l.id" &amp;
          " from listing l, status s" &amp;
          " where l.status = s.id" &amp;
          " and s.title = '" &amp; cmbStatus.Text &amp; "'")
  cmbBugid_Click
  IF (cmbStatus.Text =  "new") THEN
    btnAccept.Enabled = TRUE
  ELSE
    btnAccept.Enabled = FALSE
  END IF
END

PUBLIC SUB cmbBugid_Click()
  txtDetails.Text = ""
  txtCreated.Text = ""
  txtRaisedby.Text = ""
  txtCoder.Text= ""
  txtPriority.Text = ""
  txtApplication.Text = ""
  txtVersion.Text =  ""
  IF ( cmbBugid.Text &lt;&gt; "" ) THEN
    data.Exec ("SELECT l.priority,l.created," &amp;
      " l.details,l.release," &amp;
      " s.title, r.username," &amp;
      " c.username coder,a.name" &amp;
      " from listing l,coder" &amp;
      " r,status s,application a" &amp;
      " left join coder c on l.coder_id=c.id" &amp;
      " where l.id=" &amp; cmbBugid.Text &amp;
      " AND l.status=s.id" &amp;
      " AND l.raised_by_id=r.id" &amp;
      " and l.application_id = a.id")
    txtDetails.Text = data.tmpRec!details
    txtCreated.Text = data.tmpRec!created
    txtRaisedby.Text = data.tmpRec!username
    txtCoder.Text = data.tmpRec!coder
    txtPriority.Text = data.tmpRec!priority
    txtApplication.Text = data.tmpRec!name
    txtVersion.Text =  data.tmpRec!release
   END IF
END

PUBLIC SUB btnAccept_Click()
  data.runSQL("update listing" &amp;
        " set coder_id = " &amp; data.coder_id(system.User) &amp;
        ",status=2" &amp;
        " where id = " &amp; cmbBugid.Text)
  Form_Open
END

</pre>
</p><p>
The last thing you need is for status change
code in frmBugTracker:

<pre     class="programlisting">

PUBLIC SUB cmbStatus_Click()
  DIM version AS String
  version = txtVersion.Text
  IF (version="") THEN
    version = "Null"
  END IF

  data.runSQL(" update listing" &amp;
        " set status = " &amp; data.get_id("status","title", cmbStatus.Text) &amp;
        " ,release = " &amp; version &amp;
        " where id = " &amp; cmbBugid.Text)

END

</pre>
</p><p>
This has been a very brief look at Gambas, but
hopefully, it has shown just how easy it is to use to
create a real working application.
</p><div       class="mediaobject"><img src="8481f5.jpg"><div class="caption"><p>
Figure 5. The Final Application
</p></div></div><p><span   class="bold"><b>Resources for this article:</b></span>
<a href="../146/8951.html" target="_self">/article/8951</a>.
</p></div></div>
<div class="authorblurb"><p>
Mark Alexander Bain learned his trade working at Vodafone for nearly 20
years&mdash;using UNIX and Oracle. More recently, he has worked as a
lecturer at a University in the UK and as a freelance writer. You can
find his work at <a href="http://www.markbain-writer.co.uk" target="_self">www.markbain-writer.co.uk</a>.
</p></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../146/toc146.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>