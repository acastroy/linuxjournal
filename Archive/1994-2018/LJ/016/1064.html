<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"><html><head><META http-equiv="Content-Type" content="text/html; charset=ISO-8859-1"><title>Introduction to Lisp-Stat</title><link rel="stylesheet" href="../css/archive.css" type="text/css"><meta name="generator" content="DocBook XSL Stylesheets V1.57.0"><meta name="description" content="&#10;    If you do heavy-duty statistical computing and have been&#10;    looking for a powerful statistical package that runs&#10;    under Linux, Lisp-Stat may be just what you need.&#10;    "><meta name="keywords" content="statistics, programming"><link rel="stylesheet" href="../../css/archive.css" type="text/css"><script type="text/javascript" src="../../js/archive.js"></script><script type="text/javascript" src="../../js/highlight.js"></script></head><body onload="search_highlight();">
  <div class="headerdiv">
    <a href="../../index.html">
      <img class="topimg" src="../../images/CD_HeaderBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="tophrdiv">
  </div>
  
  <div id="top_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  <div class="article" lang="en"><div class="titlepage"><div><h1 class="title"><a name="N0x1ddb580.0x1ed2ab0"></a>Introduction to Lisp-Stat</h1></div><div><div class="author"><h3 class="author">Balasubramanian Narasimhan</h3></div><div class="issuemoyr">Issue #16, August 1995</div></div><div><p>
    If you do heavy-duty statistical computing and have been
    looking for a powerful statistical package that runs
    under Linux, Lisp-Stat may be just what you need.
    </p></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1ddb580.0x1ed3240"></a></h2></div></div><p>Although I installed Linux on a 80 Meg
partition on my Gateway 33Mhz PC over a year ago, I really did not
make serious use of Linux for my scientific work, mostly because I
lacked disk space. Recently, I bought a new 1-Gig drive and that
excuse went away. So I decided to install
<span   class="bold"><b>Lisp-Stat</b></span>, a program that I use
most for my statistical Computing.
</p><p>Written by Luke Tierney at the University of Minnesota,
Lisp-Stat is a powerful, interactive, object-oriented statistical
computing environment based on the the Xlisp dialect of Lisp. It
runs on under Microsoft Windows, Macs, and Unix based X11 systems
almost uniformly. It has good graphical facilities for both static
and dynamic graphics along with functions for common statistical
computations.</p><p>Furthermore, using the foreign function interface, one can
call C and Fortran programs from within Lisp-Stat. A byte-code
compiler is available to speed up your programs once you have
debugged them. Of course, one needn't use Lisp-Stat for statistical
computing alone; I routinely use for all kinds of things: as a
calculator, for figuring out grades of my students, as an engine
for hypertext illustrations as well as matrix manipulations.</p><p>In this article, I will introduce you to some of the
capabilities of Lisp-Stat. Although I use Lisp in this article, I
will not get into the details of Lisp programming unless it
impinges on our discussion. If you are new to Lisp, you might want
to read article on Scheme by Robert Sanders, <i  >Linux Journal</i>, March 1995, as Lisp and Scheme are closely
related. Some of the comments I make apply actually to Lisp, but it
serves no useful purpose to delineate what is the Lisp and what is
the Stat part. You need not know Lisp to use any of the examples or
to follow the article. If you get seriously interested in Lisp-Stat
you should probably get a copy of Tierney's book titled
<span   class="bold"><b>Lisp-Stat</b></span>, ISBN 0-471-50916-7,
published by John Wiley. Besides being the canonical reference for
Lisp-Stat, it provides a quick and practical introduction to
Lisp.</p><p><a href="1064f1.jpg" target="_self"><span   class="bold"><b>Figure 1: An
example of a Lisp-Stat session</b></span></a></p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1ddb580.0x1ed3660"></a>A Quick Tour</h2></div></div><p>Assuming that you have installed Lisp-Stat successfully, just
type <b  >xlispstat</b> to invoke the program. To quit
the program, just type <b  >(exit)</b>. Figure 1 shows a
simple session. Case does not matter and the
<b  >&gt;</b> you see in the figure is Lisp-Stat's
prompt. The data I have used is the number of requests a WWW server
honored during each of the <span   class="emphasis"><em>24</em></span> hours in a day.
The <b  >def</b> macro binds a variable name
<b  >requests</b> to the list of values.</p><p>As the example shows, calculation of summary statistics like
the mean and standard deviation are trivial. Since Lisp-Stat is
based on Lisp, you have all the power of Lisp for data
manipulation. A rich set of data types is available including
vectors, sequences, strings, matrices. In figure 1 the variable
<span   class="emphasis"><em>A</em></span> is defined to be a 3x3 matrix and
<span   class="emphasis"><em>B</em></span> is a list of three numbers. The example
solves <span   class="emphasis"><em>Ax=b</em></span> for <span   class="emphasis"><em>x</em></span> by
computing <span   class="emphasis"><em>A&lt;+&gt;-1&lt;+&gt;b</em></span> yielding the
solution <span   class="emphasis"><em>[2, -6, 1]</em></span>. Note that
<span   class="emphasis"><em>b</em></span> is a list while
<span   class="emphasis"><em>A&lt;+&gt;-1&lt;+&gt;</em></span> is a matrix, yet the
Lisp interpreter takes care of the types and in effect computes the
product of a matrix and a vector.</p><p>Many of Lisp-Stat's functions operate on sequences which may
be lists or vectors and they are <span   class="emphasis"><em>vectorized</em></span>,
meaning that these functions can be applied to arguments that are
lists and the result is a list of the results of applying the
function to each element of the list. Some other functions are
<span   class="emphasis"><em>vector reducing</em></span>, meaning that they can be
applied to a list of arguments but they return a single number. In
figure 1, the function <b  >mean</b> is an example of a
vector-reducing function; it treated the list of lists as a single
long list and returned the mean of the long list. On the other
hand, the function <b  >normal-cdf</b> is a vectorized
function and invoking it on a list of three numbers produces a list
of three answers. Of course, if we do wish mean to behave in a
vectorized fashion, the statement <b  >(mapcar #'mean (list
(normal-rand 10) (normal-rand 20)))</b> will do it.</p><p><a href="1064f2.html" target="_self"><span   class="bold"><b>Figure 2: A
histogram and a Line Plot</b></span></a></p><p>A picture is worth a thousand words, particularly in
statistics. Lisp-Stat boasts excellent graphical tools. The
graphical system is based on an object-oriented paradigm. Functions
that create graphical windows or plots return an object as the
result. The returned object is just another data type much like a
number or a list and it can be used in appropriate
computations.</p><p>Commonly used graphical functions are
<b  >histogram</b> for constructing histograms,
<b  >plot-points</b> for plotting
<span   class="emphasis"><em>(x,y)</em></span> pairs, <b  >plot-lines</b> for
joining <span   class="emphasis"><em>(x,y)</em></span> pairs by means of lines,
<b  >plot-function</b> for plotting a function of one
variable, <b  >spin-function</b> for plotting a function
of two variables, and <b  >spin-plot</b> for 3-d
plots.</p><p>All the <b  >spin</b> functions provide controls
for yawing, pitching and rolling in the graph they create. Figure 2
shows a plot of the number of requests versus each of the
<span   class="emphasis"><em>24</em></span> hours. The plots were produced using the
following lines of code.</p><pre     class="programlisting">
(histogram requests)
(def time (iseq 24))
(plot-lines time requests)
(send * :add-points time requests)
(send ** :point-symbol (iseq 24) 'diamond)
</pre><p>Just drawing the lines alone is less than satisfactory since
the exact location of the points is lost. So, after constructing
the plot, we send a &ldquo;message&rdquo; to the plot using the
<b  >send</b> function asking the object to add-points to
the graph resulting in the graph shown. The <b  >*</b> in
the send function refers to the result of the previous command,
i.e., the plot object. The <b  >**</b> refers to the
result of the command before the previous one. In the example, I
have asked that the plotting symbol be a diamond instead of the
default circle. The user has a choice of quite a few plotting
symbols.</p><p>In each plot there is a menu button that has further useful
options. One can select or deselect points with the mouse,
highlight certain points, save the plot as a postscript file etc. I
will only discuss a single feature, that of
<span   class="emphasis"><em>linking</em></span>. Linked plots are a way of sharing
information between plots. Consider for example, figure 2, where we
have a plot of <b  >requests</b> versus
<b  >time</b> as well as a histogram of
<b  >requests</b>.</p><p>If you enable linking by choosing the <b  >Link
View</b> item in the menu in each plot, selecting a vertical
bar in the histogram by dragging the mouse with the button pressed
causes the corresponding points in the line plot to be highlighted.
You might have to peer at the figure to see that the point where
the highest peak occurs is highlighted since it corresponds to the
highlighted histogram bar. Linking is extremely useful in viewing
multidimensional data since one can get a better idea of how the
same group of points can be projected in different views.</p><p>Online documentation for Lisp-Stat is available via the
functions <b  >help</b>, <b  >help*</b> and
<b  >apropos</b>. For help on the <b  >mean</b>
function, type <b  >(help 'mean)</b>. The use of the
quote is essential, otherwise the interpreter would assume that
mean is a variable and try to evaluate it. However, in many
situations, one does not know what the function is named.</p><p>For example, is the function that multiples two matrices
<b  >mat-mult</b> or <b  >matrix-multiply</b>?
Typing <b  >(apropos 'mult)</b> will print a list of all
symbols that have the word &ldquo;mult&rdquo; in them. This might help you
narrow down the search. On the other hand, if you know that the
function you are looking for contains the word
<b  >matrix</b> in it, <b  >(help* 'matrix)</b>
will return help on all symbols that contain the word
<b  >matrix</b>. The help facility as it exists now is
less than optimal and several people are developing a more
elaborate help system.</p><p>I usually read the newsgroup sci.stat.math and almost always
there is someone out there who wants to know how to calculate an
<span   class="emphasis"><em>F</em></span>-probability or how to generate a normal
random variable. Lisp-Stat has distribution functions and
generators for all of the commonly used distributions. For example
<b  >(normal-cdf 1.645)</b> will give you the probability
to the left of <span   class="emphasis"><em>1.645</em></span> which is about
<span   class="emphasis"><em>0.95</em></span>. The statement<b  >(def x
(normal-rand 100))</b> will define x to be a list of
<span   class="emphasis"><em>100</em></span> standard normal variates. Similar
functions exist for Students-<span   class="emphasis"><em>T</em></span>, Gamma, Beta,
Chi-squared and <span   class="emphasis"><em>F</em></span> distributions as
<b  >(help* 'cdf)</b> or <b  >(help* 'rand)</b>
will show.</p><p>Lisp-Stat has many functions for input and output. For
dealing with files, I've rarely needed to go beyond using the two
functions <b  >read-data-file</b> and
<b  >read-data-columns</b>. The statement
<b  >(read-data-file "foo.dat")</b> returns the whole
file contents as one long list, while <b  >(read-data-columns
"foo.dat")</b> returns a list of columns of the file. One can
specify the number of columns in the data file as a second argument
to <b  >read-data-columns</b>. Otherwise, it guesses the
number of columns based on the first line. The function
<b  >format</b>, which is similar to C's
<b  >sprintf()</b>, is a versatile function for formatted
printing.</p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1ddb580.0x1ecbbd0"></a>Programming in Lisp-Stat</h2></div></div><p>Lisp-Stat's graphical system and regression models are
implemented using a prototype-based object system. This is
different from the class-based object system used by languages like
C++ or the approach used by Common Lisp Object System (CLOS).
Briefly speaking, there is a root prototype object from which
instances of all other objects are created. Objects can have slots
to hold information and they respond to
<span   class="emphasis"><em>messages</em></span> which are dispatched to the object
using the <b  >send</b> function. Messages are typically
keywords, words that begin with a
colon&ndash;<b  >:add-points</b> in figure 2 is an
example.</p><p>The code that actually implements the action is called a
<span   class="emphasis"><em>method</em></span> for the message. The macros
<b  >defproto</b> and <b  >defmeth</b> make the
process of constructing objects and writing methods easier.
Lisp-Stat would be less interesting if all it provided were objects
for building statistical models. The windowing system provides
objects for building user interfaces like menus, dialogs, slider
controls etc. So one can construct nice dialogs to go with the
computations.</p><p><a href="1064f3.jpg" target="_self"><span   class="bold"><b>Figure 3: A 2-D
Plot with a Least Squares Line
Superimposed</b></span></a></p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1ddb580.0x1ecc048"></a>A Simple Animation</h2></div></div><p>Figure 3 shows an example of dynamic animation using a slider
dialog. The function <span   class="emphasis"><em>sin2pi x/n</em></span> is plotted.
The slider allows the user to see the plot change as
<span   class="emphasis"><em>n</em></span> is changed. The code to perform this is
below.</p><pre     class="programlisting">
(setf n 1)
(defun f (x) (sin (/ (* 2 pi x) n)))
(def sine-plot (plot-function #'f -5 5))
(defun change-n (x)
  (setf n x)
  (send sine-plot :clear :draw nil)
  (send sine-plot :add-function #'f -5 5))
(sequence-slider-dialog (iseq 1 20) :action #'change-n)
</pre><p>The function <b  >sequence-slider-dialog</b>
creates a slider. Initially, the global variable
<span   class="emphasis"><em>n</em></span> is <span   class="emphasis"><em>1</em></span>. Every time the
user moves the slider-stop using the mouse, the function
<b  >change-n</b> gets called with the value of
<span   class="emphasis"><em>n</em></span> corresponding to the slider-stop. In our
example, <span   class="emphasis"><em>n</em></span> can be any integer from
<span   class="emphasis"><em>1</em></span> to <span   class="emphasis"><em>20</em></span>. The function
<b  >change-n</b> sets the value of
<span   class="emphasis"><em>n</em></span> and redraws the plot.</p><p><a href="1064f4.jpg" target="_self"><span   class="bold"><b>Figure 4: A 2-D
plot with a Least Squares Line
Superimposed</b></span></a></p></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1ddb580.0x1ecc728"></a>An object-oriented Programming Example</h2></div></div><p>In order to keep the discussion tolerable, I chose a simple
example that is probably not too useful. For serious programming,
one needs to know about the built-in prototypes and functions of
Lisp-Stat discussed in Tierney's book. I shall introduce what I
need as I go along.</p><p>We will create an object that accepts a list of
<span   class="emphasis"><em>(x,y)</em></span> values and draws a plot with the
least-squares line superimposed on it. We will also require that
the equation of the least-squares line be displayed in the plot. We
begin by defining a new prototype. It is only natural that our
prototype be a descendent of the built-in prototype
<b  >scatterplot-proto</b> which &ldquo;knows&rdquo; all about
drawing 2D plots.</p><pre     class="programlisting">
(defproto least-squares-plot-proto '(intercept slope) ()
          scatterplot-proto)
</pre><p>Notice that our prototype has two slots for holding the
intercept and the slope of the least squares line. We will need to
access the values in these slots later, so it is best to define two
simple methods using the <b  >defmeth</b> macro that
return the slot values.</p><pre     class="programlisting">
(defmeth least-squares-plot-proto :slope ()
 "Returns the slope of the least squares line."
  (slot-value 'slope))
(defmeth least-squares-plot-proto :intercept ()
 "Returns the intercept of the least squares line."
  (slot-value 'intercept))
</pre><p>We have provided a documentation string for the methods; the
documentation can be retrieved by means of a command such as
<b  >(send least-squares-plot-proto :help
:slope)</b>.</p><p>In order to use our prototype, we must define a
<b  >:isnew</b> method that initializes an instance of
the prototype. Our <b  >:isnew</b> method must calculate
the least-squares line and store the slope and intercept. It should
exploit its lineage as a descendant of
<b  >scatterplot-proto</b> by invoking the inherited
methods to do the plotting tasks. Some space must be created in the
margin to display the equation for the least-squares line.</p><p>Finally, the <span   class="emphasis"><em>x,y</em></span> points must be plotted,
the axes labeled, and the window redrawn to reflect the changes.
Here is the method.</p><pre     class="programlisting">
(defmeth least-squares-plot-proto :isnew (x y &amp;key (title "LS Plot"))
  (let* ((m (regression-model x y :print nil))
         (beta (send m :coef-estimates)))
    (setf (slot-value 'intercept) (select beta 0))
    (setf (slot-value 'slope) (select beta 1)))
  (call-next-method 2 :title title)
  (send self :margin 0 (+ (send self :text-ascent)
                          (send self :text-descent)) 0 0)
  (send self :add-points x y)
  (send self :variable-label 0 "X")
  (send self :variable-label 1 "Y")
  (send self :redraw))
</pre><p>We have used the <b  >regression-model</b> function
to compute the least-squares line. The
<b  >call-next-method</b> function calls the
<b  >:isnew</b> inherited method of
<b  >scatterplot-proto</b>&ndash;this is what
actually creates a plot-window. The argument <span   class="emphasis"><em>2</em></span>
just refers to the number of variables that will be plotted. At
this point, the plot-window is actually blank. Using information
about the font in use, a margin area is created. Then the points
are plotted. In the body of a method the variable
<b  >self</b> is bound to the object receiving the
message. The method concludes by giving some meaningful names to
the variables and redrawing the window.</p><p>All the above code will do is plot the points. How can we
ensure that least-squares line and its equation are also displayed?
We use the fact that any window is actually drawn using a
<b  >:redraw</b> message. By writing a new
<b  >:redraw</b> message, we can ensure the results we
want. In actuality, the <b  >:redraw</b> message itself
is executed via three other messages
<b  >:redraw-background</b>,
<b  >:redraw-content</b> and
<b  >:redraw-overlays</b>. We really only need to write a
<b  >:redraw-content</b> method since only the content of
the plot is affected. So here we go.</p><pre     class="programlisting">
(defmeth least-squares-plot-proto :redraw-content ()
  (call-next-method)  ; Let the scatterplot do its things.
  (send self :adjust-to-data :draw nil) ; make sure scale is ok.
  (let* ((limits (send self :range 0))
         (intercept (send self :intercept))
         (slope (send self :slope))
         (info-str (format nil "y = ~5,3f + ~5,3f x" intercept slope)))
    (send self :draw-string info-str
          10 (+ (send self :text-ascent) (send self :text-descent)))
          ; Display the equation in the margin.
    (send self :add-function ; Draw the LS line.
          #'(lambda (x) (+ intercept (* slope x)))
          (car limits)
          (cadr limits) :draw nil)))
</pre><p>Notice that the keyword argument <b  >:draw</b> is
<b  >nil</b> to avoid infinite loops in the redrawing
process. If <b  >:draw</b> is not nil, the
<b  >:redraw</b> method gets invoked again. The line is
actually drawn using the <b  >:add-function</b> method of
<b  >scatterplot-proto</b>. We need not worry about
drawing the points since that is the responsibility of
<b  >scatterplot-proto</b> once we have added the points
in the <b  >:isnew</b> method.</p><p>Figure 4 shows the results of using this code with the
following program.</p><pre     class="programlisting">
(def x (normal-rand 20))
(def y (+ 5 (* 2 x) (normal-rand 20)))
(def m (send least-squares-plot-proto :new x y))
</pre></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1ddb580.0x1ecd6f8"></a>Final Remarks</h2></div></div><p>Compiling a Lisp-Stat program is straightforward. The
statement <b  >(compile-file "foo")</b> in Lisp-Stat will
compile the file foo into foo.fsl. When you load the file foo
later, the compiled file is loaded if it exists and is newer than
the uncompiled file. Debugging can be accomplished via the
<b  >debug</b>, <b  >baktrace</b> and
<b  >trace</b> functions. A stepper is also available to
step through lines of code.</p><p>There are many interesting dynamic animations can be
constructed in Lisp-Stat. This article has only scratched the
surface. Lisp-Stat continues to evolve and
<span   class="bold"><b>Xlisp</b></span> itself continues to move
closer and closer to Common Lisp due to the efforts of many,
particularly Tom Almy and Luke Tierney. The available body of
applications and software for Lisp-Stat is also growing; see the
sidebar &ldquo;Getting Lisp-Stat&rdquo; for more information.</p><div class="blockquote"><blockquote class="blockquote"><p>Balasubramanian Narasimhan teaches Statistics at
Penn State Erie, The Behrend College. His interests include
classical western music, Seminole football and the history of
India. He may be reached at
<a href="mailto:naras@euler.bd.psu.edu">naras@euler.bd.psu.edu</a></p></blockquote></div></div><div class="simplesect" lang="en"><div class="titlepage"><div><h2 class="title"><a name="N0x1ddb580.0x21e0d98"></a>Getting Lisp-Stat</h2></div></div><p>Lisp-Stat is freely available on the net. The primary
distribution site is ftp.stat.umn.edu. Look under pub/xlispstat for
xlispstat-3-44.tar.gz. The file is about 1.2 Megabytes, which means
that it fits nicely on a 3.5-inch disk. It compiles out of the box
on Linux, but to use the foreign-function interface, you must first
install the GNU <span   class="bold"><b>dld</b></span> library,
available from tsx-11.mit.edu under pub/linux/binaries/libs as
dld-3.2.5.bin.tar.gz. For those who don't want the adventure of
building from scratch, you can obtain a binary from
euler.bd.psu.edu under pub/lj/xlispstat. Follow the instructions in
the README file. The file xlispstat-3.44-bin.tar.gz is the whole
binary.</p><p>There is a mailing list for Xlisp-Stat users. To join the
mailing list send a message with your e-mail address saying that
you want to subscribe to
<a href="mailto:stat-lisp-news-request@stat.umn.edu">stat-lisp-news-request@stat.umn.edu</a>.</p><p>The Usenet newsgroup comp.lang.lisp.x is devoted to XLisp,
however it is a low-volume newsgroup averaging 2-3 articles a
day.</p><p>The site ftp.stat.ucla.edu has a good amount of Lisp and
Lisp-Stat related stuff. For a look at some hypertext applications,
look at the sites
<a href="http://euler.bd.psu.edu" target="_self">euler.bd.psu.edu</a>
and
<a href="http://www.stat.ucla.edu" target="_self">www.stat.ucla.edu</a>.</p></div></div>

  <div class="toclinks">
    <a class="link1" href="../tocindex.html">Archive Index</a>
    <a class="link2" href="../016/toc016.html">Issue Table of Contents</a>
  </div>
  <div class="bottomhrdiv">
  </div>
  
  <div id="bottom_search">
  <table class="page_search" summary="">
    <tr>
      <td valign="top" align="left">
        <p class="small_shutdown"><a href="/.exit">Shutdown Archive web server</a></p>
      </td>
      <td valign="top" align="right">
        <form method="get" action="/zoom/search.cgi">
          <input type="hidden" name="zoom_sort" value="0" />
          <input type="hidden" name="zoom_xml" value="0" />
          <input type="hidden" name="zoom_per_page" value="10" />
          <input type="hidden" name="zoom_and" value="1" />
          Search: <input type="text" name="zoom_query" size="20" value="" class="zoom_searchbox" />
          <input type="submit" value="Submit" />
        </form>
      </td>
    </tr>
  </table>
  </div>
  
  <div class="footerdiv">
    <a href="../../index.html">
      <img class="bottomimg" src="../../images/CD_FooterBanner.png" alt="LJ Archive"/>
    </a>
  </div>
  
  <div class="copyright">
    Copyright &copy; 1994 - 2018 <cite>Linux Journal</cite>.  All rights reserved.
  </div>
  </body></html>